/*!
 * Atomi Ajax Player
 * Author: Le Hong Dang <dangle@atomisystems.com>
 * Company: Atomi Systems, Inc.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2013/07/23
 */
var States={RUNNING:1,PAUSED:2,WAITING:3,BUSY:4,INITIAL:5,STOP:6,BUFFERING:7};var CtrlKind={NOTE:0,ACTION:1,IMAGE:2,AUDIO:3,VIDEO:4,ANSWER:5,TOGGLE:6,QUIZ:7,TEXTINPUT:8,COMBO:9,BUTTON:10,INPUT:11,FEEDBACK:12,CURSOR:90,ZOOM:91};var CtrlFlags={LOOP:1<<29,NOT_WAIT:1<<28,FOCUSABLE:1<<22};var CtrlShowState={SHOWING:1,SHOW:2,HIDING:3,HIDE:4};var NoteType={BALLOON:0,HINTBOX:1,CAPTION:2,HILIGHT:3,ANSWER:5};var PassCondition={PERCENT:0,POINTS:1,ANSWERS:2};var ReportMethod={NONE:0,EMAIL:1,HTTP:2};var ReportFormat={PLAIN:0,CSV:1,XML:2,JSON:3,HTML:4};var ZIndexBase={SlideBgrOld:1,SlideCtrlsOld:2,SlideBgrNew:3,SlidePrjCtrls:4,SlideCtrlsNew:5,ClickEffects:6,ClosedCaption:7,Dragging:2500,SlideList:3000,Overlay:3000,Dialog:4000,TopLevel:5000};var EvtType={CLICK:3,MOUSE_ENTER:6,MOUSE_LEAVE:7,KEY_DOWN:10,TEXT:12,CORRECT:23,WRONG:24,COMPLETE:25,INCOMPLETE:26,TIMEOUT:27,CHECK:21};var ActType={WAIT:1,CONTINUE:2,END:3,SLIDE_ID:5,SLIDE_IDX:6,NEXT:7,PREV:8,EMAIL:12,WEB:13,SCRIPT:14,SHOW:15,HIDE:16,SUBMIT:19,CLEAR_INPUT:20,SKIP:21};var AtpType={LAST:-1,ALL:-2,ALL_BUT_LAST:-3,OTHERS:-4};var EvtMode={PARTIAL_SCORE:1,PARTIAL_ACTION:2,SURVEY:4,NO_REPORT:8,NO_ASSESSMENT:16,INDEPENDENT:32};var Judge={NEUTRAL:1,CORRECT:2,WRONG:3,PARTIAL_CORRECT:4,INCOMPLETE:5,UNEXPECTED:6};jQuery.extend(jQuery.fx.step,{rlCss:function(c){var b=c.end.css(c.pos);if(c.elem.style){for(var a in b){c.elem.style[a]=b[a]}}}});jQuery.extend(jQuery.easing,{easeInOutQuad:function(e,f,a,h,g){if(e<0.5){return 2*h*e*e+a}return -h*(2*e*(e-2)+1)+a}});(function(a){a.PreLoad=function(c){var d=new b();d.Init(c);return d};a.PreLoad.defaults={imgs:[],parallel:10,progress:null,complete:null};function b(){var k,h,c,f,g,e;this.Init=function(l){if(!l){return}g=a.extend({},a.PreLoad.defaults,l);k=g.imgs;if(!k.length){if(g.complete){g.complete()}return}e=false;c=h=0;f=new Array(g.parallel);for(var m=0;m<g.parallel;++m){j(m)}};this.Cancel=function(){e=true;for(var l=0;l<f.length;++l){if(f[l]){a(f[l]).unbind("load").unbind("error").attr("src","")}}g.progress=g.complete=null};function j(l){if(e){return}if(c>=k.length){return}f[l]=new Image();a(f[l]).load(function(){a(this).unbind("load").unbind("error");d(l)}).error(function(){a(this).unbind("load").unbind("error");d(l)}).attr("src",k[c++])}function d(l){++h;if(h>=k.length){if(g.complete){g.complete()}}else{if(g.progress){g.progress(h,k.length)}window.setTimeout(function(){j(l)},0)}}}})(jQuery);String.prototype.format=function(){var d=this;for(var b=0,a=arguments.length;b<a;++b){var c=new RegExp("\\{"+(b)+"\\}","gm");d=d.replace(c,arguments[b])}return d};String.prototype.quoteHTML=function(){var a=this;a=a.replace(/&/g,"&amp;").replace(/\s(?=\s)/g,"&nbsp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />");return a};function ScaleFont(a,d){var c=$('<div><div style="'+a.css+'">'+a.html+"</div></div>");$("*",c).each(function(){if(this.style&&this.style.fontSize){var f=this.style.fontSize;var e=f.match(/\D+$/);e=e&&e[0];if(!e||e.search(/inherit|%|em/i)>-1){return}var h=parseFloat(f);if(!isNaN(h)){h*=d;this.style.fontSize=h+e}else{var g=$(this);g.css("font-size",parseFloat(g.css("font-size"))*d)}}});c=$(c.html());var b=c.attr("style");if(b){a.css=b.replace(/"/g,"&quot;")}else{a.css=""}a.html=c.html()}function IsInside(e,d,c,b,a,f){return((a>=d)&&(a<d+c)&&(f>=e)&&(f<e+b))}Log.NoLog=true;function Log(b,a){if(Log.NoLog){return}if(a===undefined){a=true}if(a&&window.status.length<200){window.status+=b}else{window.status=b}window.console&&window.console.log(b)}function RandomPermutation(e){var d=[];var c,a,b;for(c=0;c<e;++c){d[c]=c}for(c=e-1;c>0;--c){a=Math.round(c*Math.random());b=d[a];d[a]=d[c];d[c]=b}return d}function LimitValue(c,b,a){if(c<b){return b}else{if(c>a){return a}else{if(isNaN(c)){return b}}}return c}
/*!
 * Atomi Ajax Player - Player's Core Scripts
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2014/05/12
 *
 */
var bSuppressSCORMException=true;var mediaStats=g_arrSlides[g_arrSlides.length-1].media_stats;var silverlightVer="2.0";var flashPlayerVer="9.0.31.0";$(document).ready(function(){$.facebox.settings.loadingImage="player/images/loader.gif",$.facebox.settings.closeImage="player/images/closelabel.gif",$(window).unload(OnUnload);if(bSendToLMS){scormInitialize()}BrowserInfo.Init();MediaManager.Init();if(mediaStats.bRequireMediaPlayer){if((MediaManager.ePlayerType==MediaPlayerTypes.SILVERLIGHT&&MediaManager.hasSilverlight==false)||(MediaManager.ePlayerType==MediaPlayerTypes.FLASH&&MediaManager.hasFlashPlayer==false)){$(document).bind("reveal.facebox",function(){$(document).unbind("reveal.facebox");$.facebox.showClose(true)});var c=function(){$(document).unbind("close.facebox",c);Prez.Init()};$(document).bind("close.facebox",c);if(MediaManager.ePlayerType==MediaPlayerTypes.SILVERLIGHT){var a=new Object();a.version=silverlightVer;$.facebox("<p>"+Lang.NeedSilverlight+"</p>"+Silverlight.buildPromptHTML(a))}else{var b=Lang.NeedFlash;b=b.replace("Adobe Flash Player 9",'<a href="http://get.adobe.com/flashplayer">Adobe Flash Player 9</a>');$.facebox("<p>"+b+"</p>")}return}}Prez.Init()});function OnUnload(){if(bSendToLMS){scormTerminate()}}var Prez={INTERVAL:100,PreLoader:null,slideUI:null,prjSlide:null,prjSldUI:null,Scale:1,muted:false,volume:80,nBufferingCount:0,Session:{PMode:PlayModes.TUT,User:"",Elapsed:0,savedTime:0,SlideIndex:0,state:States.INITIAL,savedStates:[],RestoreData:{slides:[],index:0}},complete:false,Init:function(){if(TemplateParams.IniVolume!==undefined){this.volume=LimitValue(TemplateParams.IniVolume,0,100);if(this.volume==0){this.muted=true;this.volume=80}}if(!this.prjSlide){var b=this.GetSlides();for(var a=0,c=b.length;a<c;++a){b[a].idx=a}this.prjSlide=b.pop();if(Options.test_max_time){Options.test_max_time*=60000}}UI.Init();this.PreLoad()},Start:function(d,c,a){this.SessionStop();if(d==undefined){d=this.GetInitialPlayMode()}this.ClearAllResults();this.Session.PMode=d;if(this.prjSldUI){this.prjSldUI.CleanUp();this.prjSldUI=null}if(this.slideUI){this.slideUI.CleanUp();this.slideUI=null}this.SessionStart();this.complete=false;if(bSendToLMS){scormStartLesson()}if(c!==undefined){this.Session.RestoreData.index=c}if(this.Session.RestoreData.index===null||this.Session.RestoreData.index===undefined){this.Session.RestoreData.index=0}var b=this.GetSlideCompletions();if(UI.SlideList){UI.SlideList.MarkComplete(b);UI.SlideList.MarkComplete(false,this.Session.RestoreData.index)}if(UI.SlideNotes){UI.SlideNotes.MarkComplete(b);UI.SlideNotes.MarkComplete(false,this.Session.RestoreData.index)}this.prjSldUI=new SlideUI(this.prjSlide);if(this.GetSlideCount()<=0){UI.ShowMsg(Lang.NoSlide,true,true);return}MediaManager.InitPlayers(function(){this.ShowSlide(this.GetSlideAt(this.Session.RestoreData.index),a?a:0,false)},this)},SessionStart:function(){UI.OnPrezStart();InitHandlers();this.InitBGTask();this.Session.state=States.RUNNING;this.Session.savedStates.length=0;this.Session.Elapsed=0;this.Session.savedTime=(new Date).getTime();this.Session.SlideIndex=0},SessionStop:function(){RemoveHandlers();this.Session.User="";this.Session.Elapsed=0;this.Session.SlideIndex=0;this.Session.savedStates.length=0;this.Session.state=States.RUNNING;this.ClearAllResults();this.StopBGTask();UI.CleanUp()},Restart:function(b,a){if(!b){b=0}this.ClearAllResults();this.Session.RestoreData.index=b;if(bSendToLMS){scormStoreSuspendData(Prez.Session.RestoreData,true)}this.Start(Prez.Session.PMode,b,a)},IsRunning:function(){return this.Session.state==States.RUNNING},GetState:function(){return this.Session.state},Run:function(a){this.Session.savedStates.length=0;this.Session.state=States.RUNNING;this.nBufferingCount=0;this.UpdateBufferingUI();EffectMan.UpdatePrezStateChanged();if(this.prjSldUI){this.prjSldUI.UpdatePrezStateChanged()
}if(a){if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}}if(UI.Toolbar){UI.Toolbar.SetPause(false)}},Pause:function(a){if(this.Session.state==a){return false}switch(a){case States.WAITING:if(this.Session.state!=States.RUNNING){return false}break;case States.PAUSED:case States.BUFFERING:break;default:return false}this.Session.savedStates.push(this.Session.state);this.Session.state=a;this.UpdateBufferingUI();EffectMan.UpdatePrezStateChanged();if(this.prjSldUI){this.prjSldUI.UpdatePrezStateChanged()}if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}if(UI.Toolbar){UI.Toolbar.SetPause(this.Session.state!=States.RUNNING)}return true},Resume:function(){if(this.Session.state!=States.WAITING&&this.Session.state!=States.PAUSED&&this.Session.state!=States.BUFFERING){return}this.Session.state=this.Session.savedStates.pop();if(this.Session.state===undefined){this.Session.state=States.RUNNING}this.UpdateBufferingUI();EffectMan.UpdatePrezStateChanged();if(this.prjSldUI){this.prjSldUI.UpdatePrezStateChanged()}if(this.slideUI){this.slideUI.UpdatePrezStateChanged()}if(UI.Toolbar){UI.Toolbar.SetPause(this.Session.state!=States.RUNNING)}},GiveAwayResumeToken:function(){if(this.prjSldUI&&this.prjSldUI.AcceptResumeToken()){return true}if(this.slideUI&&this.slideUI.AcceptResumeToken()){return true}return false},IncBufferingCount:function(){Log("Prez.IncBufferingCount: to "+(this.nBufferingCount+1));if(this.nBufferingCount==0){this.Pause(States.BUFFERING)}this.nBufferingCount++},DecBufferingCount:function(){if(this.nBufferingCount==0){Log("Prez.DecBufferingCount: Invalid counter");return}Log("Prez.DecBufferingCount: to"+(this.nBufferingCount-1));this.nBufferingCount--;if(this.nBufferingCount==0){if(BrowserInfo.fixDelayedPlaying){if(!this.GiveAwayResumeToken()){this.Resume()}}else{this.Resume()}}},UpdateBufferingUI:function(){if(this.Session.state!=States.BUFFERING){$(this).stopTime("tm_Buffering");$("#BufferingImg").remove();return}else{$(this).oneTime(500,"tm_Buffering",function(){if($("#BufferingImg").length>0){return}var b=$("#StageDiv");b.append('<img id="BufferingImg" src="player/images/loader.gif"/ style="z-index:100001;">');var c=$("#BufferingImg");var a=(b.width()-c.width())/2;var d=(b.height()-c.height())/2;c.css({position:"absolute",top:d+"px",left:a+"px"})})}},TogglePause:function(){if(this.complete||this.Session.state==States.BUFFERING){return}if(this.Session.state!=States.RUNNING){this.Run(true)}else{this.Pause(States.PAUSED)}},GetSlides:function(){return g_arrSlides},GetSlideCount:function(){return this.GetSlides().length},GetSlideAt:function(a){return this.GetSlides()[a]||null},GetSlide:function(a){var c=this.GetSlides();for(var b=0;b<c.length;++b){if(c[b].id==a){return c[b]}}return null},ShowSlide:function(a,d,b){Log("--------Show Slide----"+(a?a.idx:-1));if(this.complete){this.Restart(a?a.idx:0,d);return}if(b&&this.slideUI&&this.slideUI.slide!=a){if(UI.SlideList){UI.SlideList.MarkComplete(true,this.slideUI.GetIndex())}if(UI.SlideNotes){UI.SlideNotes.MarkComplete(true,this.slideUI.GetIndex())}this.slideUI.GetSubmitedDataObject()}if(!a){if(!this.slideUI||(this.slideUI.GetIndex()==this.GetSlideCount()-1)){if(this.prjSlide&&UI.Toolbar){UI.Toolbar.SetSliderPosition(this.prjSlide.duration)}this.OnPrezEnd(false)}return}this.Run(false);d=d||0;if(!this.slideUI){this.slideUI=new SlideUI(a)}else{if(this.slideUI.slide!==a){this.slideUI.CleanUp();this.slideUI=new SlideUI(a)}}this.slideUI.LoadSubmitedData();this.slideUI.Show(d,function(){});if(UI.Toolbar){UI.Toolbar.SetSliderTip(a.idx+1)}if(UI.SlideList){UI.SlideList.SetCurrentSlide(a.idx)}if(UI.SlideNotes){UI.SlideNotes.SetCurrentSlide(a.idx)}if(this.prjSldUI){var c=a.startTime+d;if(Prez.prjSldUI.ts<0||Math.abs(c-Prez.prjSldUI.ts)>Prez.INTERVAL){Prez.prjSldUI.Show(c)}if(UI.Toolbar){UI.Toolbar.SetSliderPosition(this.prjSldUI.ts)}}Prez.Session.RestoreData.index=this.Session.SlideIndex;if(bSendToLMS){scormStoreSuspendData(Prez.Session.RestoreData,true)}},ShowSlideByIndex:function(a,b){this.ShowSlide(this.GetSlideAt(a),0,b)},ShowSlideByID:function(a,b){this.ShowSlide(this.GetSlide(a),0,b)},HandleSlideLoadingError:function(a){a+="\n"+Lang.ConfirmNextSlide;if(confirm(a)){}},saved:{slide:null,slideTs:0},ShouldDoNextAction:function(){var a=true;if(!this.slideUI||(this.saved.slide!=this.slideUI.slide||this.saved.slideTs>this.slideUI.ts)){a=false;this.saved.slide=null;this.saved.slideTs=0}return a},GetSlideImgUrls:function(j,k,d,e){var c=j.ctrls,l=j.idx;function g(p){switch(p.kind){case CtrlKind.TOGGLE:case CtrlKind.COMBO:if(p.image&&$.inArray(p.image,d)<0){e.push("data/res_"+p.image+".png");d.push(p.image)}break;case CtrlKind.AUDIO:break;case CtrlKind.VIDEO:e.push("data/vstart_img_"+l+"."+p.id+".jpg");e.push("data/vend_img_"+l+"."+p.id+".jpg");break;case CtrlKind.ANSWER:if(p.act){g(p.act)}if(p.note){g(p.note)}break;case CtrlKind.QUIZ:var m=p.ctrls,o;for(var o=0,n=m.length;o<n;++o){g(m[o])}break;default:e.push("data/img_"+l+"."+p.id+".png");break}}if(k){e.push("data/slide_"+l+"."+Options.image_format)}for(var f=0,b=c.length;f<b;++f){g(c[f])}if(j.cursor){var a=j.cursor.cursors;for(var f=0,b=a.length;f<b;++f){if(a[f].img){e.push("data/"+a[f].img)}if(a[f].click_eff){var h="data/"+a[f].click_eff.file;if($.inArray(h,e)<0){e.push(h)}}}}},PreLoad:function(){if(this.PreLoader){this.PreLoader.Cancel();this.PreLoader=null}var k=UI.ViewPort();var f=Math.min(k.width(),$(window).innerWidth());var o=Math.min(k.height(),$(window).innerHeight());var l=f-20,m=24,a,c;if(l>400){l=400}a=Math.floor((f-l)/2);c=Math.floor((o-m)/2);$("#PreLoadDiv").remove();k.append('<div id="PreLoadDiv"></div>');$("#PreLoadDiv").css({position:"absolute",width:l+"px",top:c+"px",left:a+"px"}).progressbar().children().html("&nbsp;Loading... 0%");var h=[],g=[],b=this.GetSlides();h=["player/images/aplogo.png","player/images/blank.gif","player/images/loader.gif","player/images/play.png","player/images/b.png","player/images/bl.png","player/images/icons.png","player/images/br.png","player/images/tl.png","player/images/tr.png","player/images/closelabel.gif"];APToolbar.GetImages(h);h.push("data/"+Params.CC.bgimg);this.GetSlideImgUrls(this.prjSlide,false,g,h);for(var j=0,e=b.length;j<e;++j){this.GetSlideImgUrls(b[j],true,g,h)}var d=h.length;if(!d){this.Start();return}var p={imgs:h,progress:function(r,n){var q=Math.floor((100*r)/n);$("#PreLoadDiv").progressbar("value",q).children().html("&nbsp;Loading... "+q+"%")},complete:function(){$(Prez).stopTime("startprez");$("#PreLoadDiv").progressbar("value",100).children().html("&nbsp;Loading... 100%");window.setTimeout(function(){$("#PreLoadDiv").progressbar("destroy").remove();if(Prez.Session.state==States.INITIAL){Prez.Start()}},100)}};$(this).oneTime(2*60*1000,"startprez",function(){if(Prez.Session.state==States.INITIAL){$("#PreLoadDiv").progressbar("destroy").remove();Prez.Start()}});this.PreLoader=$.PreLoad(p)},InitBGTask:function(){$(this).everyTime(this.INTERVAL,"BGTask",Prez.OnTimerTick)},StopBGTask:function(){$(this).stopTime("BGTask")},GetInitialPlayMode:function(){if(g_nInitialMode!=undefined){return g_nInitialMode}else{return PlayModes.TUT}},SwitchMode:function(a){if(a!=undefined){Prez.Session.PMode=a}UI.OnPrezStart(true);this.LoadSlideByIndex(Prez.Session.SlideIndex)},ToggleClosedCaption:function(){ClosedCaptionUI.ToggleShow()},Close:function(a){if((a)&&(confirm(Lang.ConfirmQuit)==false)){return}window.close()},GoFirst:function(){this.ShowSlideByIndex(0,false)},GoNext:function(){if(this.Session.SlideIndex<this.GetSlideCount()-1){this.ShowSlideByIndex(this.Session.SlideIndex+1,false)}},GoPrev:function(){if(this.Session.SlideIndex>=1){this.ShowSlideByIndex(this.Session.SlideIndex-1,false)}},GoLast:function(){if(this.Session.SlideIndex!=this.GetSlideCount()-1){this.ShowSlideByIndex(this.GetSlideCount()-1,false)}},IsMuted:function(){return this.muted},Mute:function(a){if(a===undefined){a=true}this.muted=a;if(this.slideUI){this.slideUI.Mute(a)}if(this.prjSldUI){this.prjSldUI.Mute(a)}if(UI.Toolbar){UI.Toolbar.SetMute(a)
}},SetVolume:function(a){a=LimitValue(a,0,100);this.volume=a;this.muted=false;if(this.slideUI){this.slideUI.SetVolume(a)}if(this.prjSldUI){this.prjSldUI.SetVolume(a)}if(UI.Toolbar){UI.Toolbar.SetVolumeValue(a);UI.Toolbar.SetMute(false)}},GetVolume:function(a){if(a&&this.muted){return 0}return this.volume},GetSlideCompletions:function(){var a={};var c=this.Session.RestoreData.slides;if(c&&c.length){for(var b=0,d=c.length;b<d;++b){if(c[b]){a[b]=true}}}return a},GetResult:function(){var b=true;switch(Options.pass_condition){case PassCondition.PERCENT:case PassCondition.POINTS:var c=Prez.GetPoints();if(Options.pass_condition==PassCondition.POINTS){b=(c>=Options.pass_value)}else{var a=Prez.GetMaxPoints();if(a>0){b=(parseInt(c*100/a)>=Options.pass_value)}}break;case PassCondition.ANSWERS:b=(Prez.GetTakenInteractionCount(Judge.CORRECT)>=Options.pass_value);break}return b},GetPoints:function(){var e=0;var d=Prez.Session.RestoreData.slides;if(!d){return 0}var g=d.length;for(var c=0;c<g;++c){var f=d[c];if(!f){continue}for(var b in f){var a=f[b];if(!a||!a.p){continue}e+=a.p}}return e},GetMaxPoints:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];d+=Prez.GetCtrlMaxPoints(f,true)}}return d},GetCtrlMaxPoints:function(b,a){if(!b){return 0}if(a==true){if(b.evt&&(b.evt.mod&EvtMode.SURVEY)){return 0}}if(b.kind==CtrlKind.INPUT){if(b.type==InputUI.KEY){return Prez.GetEvtMaxPoints(b.evt,EvtType.KEY_DOWN)}else{if(b.type==InputUI.MOUSE){return Prez.GetEvtMaxPoints(b.evt,EvtType.CLICK)}else{return 0}}}else{if(b.kind==CtrlKind.TEXTINPUT){return Prez.GetEvtMaxPoints(b.evt,EvtType.TEXT)}else{if(b.kind==CtrlKind.QUIZ){return Prez.GetQuizMaxPoint(b)}}}return 0},GetQuizMaxPoint:function(b){var g=!(b.evt.mod&EvtMode.SURVEY);if(!g){return 0}var h=((b.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE);var k=0,e;var c=b.ctrls,a=c.length,d,j,f,l;switch(b.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:if(h){for(d=0;d<a;++d){j=c[d];if(!j||j.kind!=CtrlKind.ANSWER||!j.act||!j.act.evt){continue}l=j.act.evt[EvtType.CHECK];if(!l||!l.all){continue}e=l.all.pt||0;if(b.type==QuizUI.Type.MULTI_RESPONSE){if(j.act.checked){k=k+e}}else{if(e>k){k=e}}}}else{k=b.evt.pt}break;case QuizUI.Type.SEQUENCE_DRAGDROP:k=b.evt.pt;break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(d=0;d<a;++d){j=c[d];if(j&&j.kind==CtrlKind.TEXTINPUT){k=Prez.GetCtrlMaxPoints(j);break}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:if(h){for(d=0;d<a;++d){j=c[d];if(!j||j.kind!=CtrlKind.ANSWER||!j.act){continue}k+=Prez.GetCtrlMaxPoints(j.act)}}else{k=b.evt.pt}break}return k},GetEvtMaxPoints:function(c,h,d){if(!c){return 0}if(d==true){if(c&&(c.mod&EvtMode.SURVEY)){return 0}}var b=0;if(c.mod&EvtMode.PARTIAL_SCORE){var a=c[h],f;if(a){for(var e=0,g=a.length;e<g;++e){f=a[e].pt;if(f>b){b=f}}}}else{b=c.pt||0}return b},GetRequirements:function(){switch(Options.pass_condition){case PassCondition.PERCENT:return Lang.RequirePercent.format(Options.pass_value);case PassCondition.POINTS:return Lang.RequirePoints.format(Options.pass_value);case PassCondition.ANSWERS:return Lang.RequireAnswers.format(Options.pass_value)}return Lang.RequireNone},ClearAllResults:function(){Prez.Session.RestoreData.slides=[]},GetInteractionCount:function(){var d,h,b,a,f,g,e,c;d=0;h=Prez.GetSlideCount();for(e=0;e<h;++e){b=Prez.GetSlideAt(e);if(!b){continue}a=b.ctrls;g=a.length||0;for(c=0;c<g;++c){f=a[c];if(!f){continue}if(f.kind==CtrlKind.INPUT){if(f.type!=InputUI.MOUSE_HOVER){d++}}else{if(f.kind==CtrlKind.TEXTINPUT||f.kind==CtrlKind.QUIZ){d++}}}}return d},GetTakenInteractionCount:function(b){var d=0;var f=Prez.Session.RestoreData.slides;if(!f){return 0}var h=f.length;for(var e=0;e<h;++e){var g=f[e];if(!g){continue}for(var c in g){var a=g[c];if(!a||!a.j){continue}if(b==undefined||a.j==b){d++}}}return d},GetTakenSlideCount:function(){var a=0;var c=Prez.Session.RestoreData.slides;if(!c){return 0}var e=c.length;for(var b=0;b<e;++b){var d=c[b];if(d){a++}}return a},GetSlideDuration:function(b){var a=Prez.GetSlideAt(b);if(a){return a.duration?a.duration:-1}return -1},GetDefaultAction:function(){var d=Prez.GetSlideActions();for(var b=0;b<d.length;b++){alert("Nothing here");var c=d[b];for(var a=0;a<c.values.length;a++){if(c.values[a].a!=""){return c.values[a].a}}}return"next:1"},GetSlideActions:function(b){if(b==undefined){b=Prez.Session.SlideIndex}var a=Prez.GetSlideAt(b);if(a!=null){return a.Actions}return null},OnTimerTick:function(){var b=(new Date).getTime();var a=b-Prez.Session.savedTime;switch(Prez.Session.state){case States.RUNNING:case States.WAITING:Prez.Session.Elapsed+=a;Prez.Session.savedTime=b;if(Prez.Session.Elapsed>=Options.test_max_time&&Options.test_max_time&&Prez.Session.PMode==PlayModes.TEST){Prez.StopBGTask();alert(Lang.MaxPrezTimeReached);Prez.OnPrezEnd(true);return}if(Prez.Session.state==States.WAITING){return}break;default:Prez.Session.savedTime=b;return}if(Prez.slideUI){if(Prez.prjSldUI){Prez.prjSldUI.Tick(a);if(UI.Toolbar){UI.Toolbar.SetSliderPosition(Prez.prjSldUI.ts)}}Prez.slideUI.Tick(a);if(Prez.Session.state==States.RUNNING&&Prez.slideUI.IsEnd()){Prez.ShowSlide(Prez.GetSlideAt(Prez.slideUI.GetIndex()+1),0,true)}}},OnPrezEnd:function(a){Prez.complete=true;Prez.StopBGTask();Prez.Pause(States.PAUSED);if(Prez.prjSldUI){Prez.prjSldUI.CleanUp();Prez.prjSldUI=null}if(Prez.slideUI){Prez.slideUI.CleanUp();Prez.slideUI=null}if(bSendToLMS){scormEndLesson(a)}switch(Prez.Session.PMode){case PlayModes.DEMO:if(Options.ConfirmRestart){if(confirm(Lang.EndDemoMsg+Lang.ConfirmRestart)==true){Prez.Restart()}else{Prez.Close(false)}}break;case PlayModes.TUT:if(Options.ConfirmRestart){if(confirm(Lang.EndTutorialMsg+Lang.ConfirmRestart)==true){Prez.Restart()}else{Prez.Close(false)}}break;case PlayModes.PRAC:case PlayModes.TEST:if(Options.ShowReport){Prez.ShowReport()}else{if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){Prez.SendReport()}}break}},ShowReport:function(){ReportUI.Show()},SendReport:function(){var b=Prez.GetReportData(Options.report_format);if(b===null){return}switch(Options.report_method){case ReportMethod.EMAIL:if(!Options.report_value){Options.report_value=""}var d="mailto:"+encodeURIComponent(Options.report_value)+"?subject="+encodeURIComponent(Lang.Report)+"&body="+encodeURIComponent(b);try{var f=window.open(d,"_blank");if(f){f.close()}}catch(c){var a=Lang.CouldnotSendReport+Options.report_value;if(c instanceof Error){a+="<br>"+c.name+": "+c.message}else{if(c.toString){a+="<br>"+c.toString()}}a+=Lang.DisablePopupBlocker+"<b><a href='"+d+"' target='_blank'>"+Lang.SendReport+"</a></b>";UI.ShowMsg(a,true,false);return false}Prez.Close(false);break;case ReportMethod.HTTP:try{var e={type:"POST",url:Options.report_value,data:"report="+b,timeout:60000,success:function(){UI.ShowMsg(Lang.SuccessSendReport,true,true)},error:function(g,j,h){if(h){throw h}else{throw new Error(Lang.CouldnotSendReport+Options.report_value+(j?(": "+j):""))}}};UI.ShowMsg(Lang.SendingReport,false,false);$.ajax(e)}catch(c){var a;if(c instanceof Error){a=c.name+": "+c.message}else{if(c.toString){a=c.toString()}else{a=Lang.CouldnotSendReport+Options.report_value}}UI.ShowMsg(a,true,false);return false}break;default:Prez.Close(false);break}},GetReportData:function(l){var e,a,g,p;var n="";var c="\n";var k="\t";var f=": ";var h=new Date();var j=Prez.GetPoints();var b=Prez.GetMaxPoints();var m=$.cookie("userid")||"";while(m==""){m=prompt(Lang.EnterUserID,"")}if(m===null){return null}var o=Math.ceil(Prez.Session.Elapsed/1000);$.cookie("userid",m);switch(l){case ReportFormat.PLAIN:c="\n";f=": ";n=Lang.Presentation+f+PrezInfo.Name+c;n+=Lang.Description+f+PrezInfo.Description+c;n+=Lang.Date1+f+h.toUTCString()+c;n+=Lang.UserID+f+m+c;n+=Lang.TotalTime+f+Math.floor(o/3600)+" h : "+Math.floor((o%3600)/60)+" m : "+(o%60)+" s"+c;n+=Lang.TotalSlides+f+Prez.GetSlideCount()+c;n+=Lang.TakenSlides+f+Prez.GetTakenSlideCount()+c;
n+=Lang.TotalInteractions+f+Prez.GetInteractionCount()+c;n+=Lang.TakenInteractions+f+Prez.GetTakenInteractionCount()+c;n+=Lang.CorrectCount+f+Prez.GetTakenInteractionCount(Judge.CORRECT)+c;n+=Lang.Points+f+j+" / "+b+c;n+=Lang.Percentage+f+parseInt(j*100/b)+"%"+c;n+=Lang.Result+f+(Prez.GetResult()?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+c;n+=c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+=(e+1)+". ";n+=Lang.Slide+f+(parseInt(p.slideidx)+1)+", ";n+="ID"+f+p.reportid+", ";n+=Lang.Attempts+f+p.attempts+", ";n+=Lang.Points+f+p.points+", ";n+=Lang.MaxPoints+f+p.maxPoints+", ";n+=Lang.Result+f+p.judge+", ";n+=Lang.InteractionType+f+p.type+", ";n+=Lang.Answer+f+p.answers+c}break;case ReportFormat.CSV:c="\n";f=",";n='"'+Lang.Presentation+'"'+f;n+='"'+Lang.Description+'"'+f;n+='"'+Lang.Date1+'"'+f;n+='"'+Lang.UserID+'"'+f;n+='"'+Lang.TotalTime+'"'+f;n+='"'+Lang.TotalSlides+'"'+f;n+='"'+Lang.TakenSlides+'"'+f;n+='"'+Lang.TotalInteractions+'"'+f;n+='"'+Lang.TakenInteractions+'"'+f;n+='"'+Lang.CorrectCount+'"'+f;n+='"'+Lang.Points+'"'+f;n+='"'+Lang.MaxPoints+'"'+f;n+='"'+Lang.Percentage+'"'+f;n+='"'+Lang.Result+'"'+c;n+='"'+PrezInfo.Name+'"'+f;n+='"'+PrezInfo.Description+'"'+f;n+='"'+h.toUTCString()+'"'+f;n+='"'+m+'"'+f;n+='"'+o+'"'+f;n+='"'+Prez.GetSlideCount()+'"'+f;n+='"'+Prez.GetTakenSlideCount()+'"'+f;n+='"'+Prez.GetInteractionCount()+'"'+f;n+='"'+Prez.GetTakenInteractionCount()+'"'+f;n+='"'+Prez.GetTakenInteractionCount(Judge.CORRECT)+'"'+f;n+='"'+j+'"'+f;n+='"'+b+'"'+f;n+='"'+parseInt(j*100/b)+'"'+f;n+='"'+(Prez.GetResult()?Lang.Passed:Lang.Failed)+'"'+c;n+=c;n+='"#"'+f;n+='"'+Lang.Slide+'"'+f;n+='"ID"'+f;n+='"'+Lang.Attempts+'"'+f;n+='"'+Lang.Points+'"'+f;n+='"'+Lang.MaxPoints+'"'+f;n+='"'+Lang.Result+'"'+f;n+='"'+Lang.InteractionType+'"'+f;n+='"'+Lang.Answer+'"'+c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+='"'+(e+1)+'"'+f;n+='"'+(parseInt(p.slideidx)+1)+'"'+f;n+='"'+p.reportid+'"'+f;n+='"'+p.attempts+'"'+f;n+='"'+p.points+'"'+f;n+='"'+p.maxPoints+'"'+f;n+='"'+p.judge+'"'+f;n+='"'+p.type+'"'+f;n+='"'+p.answers+'"'+c}break;case ReportFormat.XML:n='<?xml version="1.0" encoding="UTF-8"?>'+c;n+="<Content>"+c;n+=k+"<Report>"+c;n+=k+k+"<Name>"+PrezInfo.Name+"</Name>"+c;n+=k+k+"<Description>"+PrezInfo.Description+"</Description>"+c;n+=k+k+"<Date>"+h.toUTCString()+"</Date>"+c;n+=k+k+"<UserID>"+m+"</UserID>"+c;n+=k+k+"<TotalTime>"+o+"</TotalTime>"+c;n+=k+k+"<SlideCount>"+Prez.GetSlideCount()+"</SlideCount>"+c;n+=k+k+"<TakenSlide>"+Prez.GetTakenSlideCount()+"</TakenSlide>"+c;n+=k+k+"<TotalInteraction>"+Prez.GetInteractionCount()+"</TotalInteraction>"+c;n+=k+k+"<TakenInteraction>"+Prez.GetTakenInteractionCount()+"</TakenInteraction>"+c;n+=k+k+"<Correct>"+Prez.GetTakenInteractionCount(Judge.CORRECT)+"</Correct>"+c;n+=k+k+"<Points>"+j+"</Points>"+c;n+=k+k+"<MaxPoints>"+b+"</MaxPoints>"+c;n+=k+k+"<Percent>"+parseInt(j*100/b)+"</Percent>"+c;n+=k+k+"<Result>"+Prez.GetResult()+"</Result>"+c;n+=k+k+"<Details>"+c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+=k+k+k+"<Interaction>"+c;n+=k+k+k+k+"<SlideIndex>"+(parseInt(p.slideidx)+1)+"</SlideIndex>"+c;n+=k+k+k+k+"<ReportID>"+p.reportid+"</ReportID>"+c;n+=k+k+k+k+"<Attempts>"+p.attempts+"</Attempts>"+c;n+=k+k+k+k+"<Points>"+p.points+"</Points>"+c;n+=k+k+k+k+"<MaxPoints>"+p.maxPoints+"</MaxPoints>"+c;n+=k+k+k+k+"<Result>"+p.judge+"</Result>"+c;n+=k+k+k+k+"<Type>"+p.type+"</Type>"+c;n+=k+k+k+k+"<Answers>"+p.answers+"</Answers>"+c;n+=k+k+k+"</Interaction>"+c}n+=k+k+"</Details>"+c;n+=k+"</Report>"+c;n+="</Content>"+c;break;case ReportFormat.JSON:n="{"+c;n+=k+'"Name":"'+PrezInfo.Name+'",'+c;n+=k+'"Description":"'+PrezInfo.Description+'",'+c;n+=k+'"Date":"'+h.toUTCString()+'",'+c;n+=k+'"UserID":"'+m+'",'+c;n+=k+'"TotalTime":"'+o+'",'+c;n+=k+'"SlideCount":'+Prez.GetSlideCount()+","+c;n+=k+'"TakenSlide":'+Prez.GetTakenSlideCount()+","+c;n+=k+'"TotalInteraction":'+Prez.GetInteractionCount()+","+c;n+=k+'"TakenInteraction":'+Prez.GetTakenInteractionCount()+","+c;n+=k+'"Correct":'+Prez.GetTakenInteractionCount(Judge.CORRECT)+","+c;n+=k+'"Points":'+j+","+c;n+=k+'"MaxPoints":'+b+","+c;n+=k+'"Percent":"'+parseInt(j*100/b)+'",'+c;n+=k+'"Result":'+Prez.GetResult()+","+c;n+=k+'"Details":['+c;g=ReportUI.GetReportResult();a=g.length;for(e=0;e<a;++e){p=g[e];n+=k+k+"{"+c;n+=k+k+k+'"SlideIndex":'+(parseInt(p.slideidx)+1)+","+c;n+=k+k+k+'"ReportID":"'+p.reportid+'",'+c;n+=k+k+k+'"Attempts":'+p.attempts+","+c;n+=k+k+k+'"Points":'+p.points+","+c;n+=k+k+k+'"MaxPoints":'+p.maxPoints+","+c;n+=k+k+k+'"Result":"'+p.judge+'",'+c;n+=k+k+k+'"Type":"'+p.type+'",'+c;n+=k+k+k+'"Answers":"'+p.answers+'"'+c;if(e==a-1){n+=k+k+"}"+c}else{n+=k+k+"},"+c}}n+=k+"]"+c;n+="}";break}return n},GetImage:function(a){return"data/img_"+this.Session.SlideIndex+"."+a+".png"},GetSlideImage:function(a){return"data/slide_"+a+"."+Options.image_format},GetResource:function(b,a){return"data/res_"+b+"."+a},Zoom:function(d){if(d==this.Scale){return}if(ZoomUI.Scale!=1){var c=$(ZoomUI.GetElement());var a=c.position();c.css({top:a.top*d/Prez.Scale,left:a.left*d/Prez.Scale})}this.Scale=d;d*=ZoomUI.Scale;var b,e;if(this.prjSldUI){this.prjSldUI.ZoomClickEffect(d);b=Prez.prjSldUI.allCtrlUIs;for(e in b){b[e].Zoom(d)}}if(this.slideUI){b=this.slideUI.allCtrlUIs;for(e in b){b[e].Zoom(d)}}ClosedCaptionUI.Zoom()},GetMediaUI:function(b){var a=this.slideUI?this.slideUI.GetMediaUI(b):null;if(!a&&this.prjSldUI){a=this.prjSldUI.GetMediaUI(b)}return a}};EvtMan.StopEvent=function(b){b=$.event.fix(b||window.event||{});b.preventDefault();b.stopPropagation();try{b.originalEvent.keyCode=0}catch(a){}return false};EvtMan.DoActions=function(d,c){var e=d.length;if(e>0){var a=-1;function b(){if(++a<e){var f=d[a];if(c&&(f.type==ActType.CONTINUE||d.type==ActType.SKIP)){c.IgnoreWaiting(true)}EvtMan.DoAction(f,b)}}b()}};EvtMan.DoAction=function(action,fnCb){var ctrlUI;switch(action.type){case ActType.WAIT:Prez.Pause(States.WAITING);break;case ActType.SKIP:case ActType.CONTINUE:Prez.Resume();break;case ActType.END:Prez.OnPrezEnd(false);return;case ActType.SUBMIT:if(!action.dat||action.dat<=0){Prez.slideUI.Submit()}else{ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI&&ctrlUI.Submit){ctrlUI.Submit()}}break;case ActType.CLEAR_INPUT:if(!action.dat||action.dat<=0){Prez.slideUI.ClearUserInput(true)}else{ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI&&ctrlUI.ClearUserInput){ctrlUI.ClearUserInput(true)}}break;case ActType.SHOW:ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI&&ctrlUI.ctrl.duration!=0){if(ctrlUI.ctrl.duration<0){ctrlUI.ctrl.duration=3000}if(fnCb){ctrlUI.SetOnHideCallback(fnCb)}ctrlUI.Show({value:CtrlShowState.SHOWING,ts:0,ctrlTs:0},true);return}break;case ActType.HIDE:ctrlUI=Prez.slideUI.GetCtrlUI(action.dat,true);if(ctrlUI){ctrlUI.Hide(true)}break;case ActType.EMAIL:try{if(!action.dat.fullMail){if(!action.dat.to){action.dat.to=""}var strMail="mailto:"+encodeURIComponent(action.dat.to)+"?";if(action.dat.subject){strMail+="subject="+encodeURIComponent(action.dat.subject)+"&"}if(action.dat.cc){strMail+="cc="+encodeURIComponent(action.dat.cc)+"&"}if(action.dat.bcc){strMail+="bcc="+encodeURIComponent(action.dat.bcc)+"&"}if(action.dat.body){strMail+="body="+encodeURIComponent(action.dat.body)+"&"}action.dat.fullMail=strMail}var win=window.open(action.dat.fullMail,"_blank");if(win){win.close()}}catch(ex){var strErr=Lang.CouldnotSendMail+action.dat.to;if(ex instanceof Error){strErr+="<br><br>"+ex.name+": "+ex.message}else{if(ex.toString){strErr+="<br><br>"+ex.toString()}}UI.ShowMsg(strErr)}break;case ActType.WEB:try{if(!action.dat.specs){action.dat.specs=""}var nwin=window.open(action.dat.url,encodeURIComponent(action.dat.name),action.dat.specs);if(!nwin){var strMsg=Lang.CouldnotOpenWeb+action.dat.url+Lang.DisablePopupBlocker;strMsg+='<b><a href="'+action.dat.url+'" target="'+action.dat.name+'">'+action.dat.url+"</a></b>";UI.ShowMsg(strMsg)}else{nwin.focus()}}catch(ex){var strErr=Lang.CouldnotOpenWeb+action.dat.url;
if(ex instanceof Error){strErr+="<br><br>"+ex.name+": "+ex.message}else{if(ex.toString){strErr+="<br><br>"+ex.toString()}}UI.ShowMsg(strErr)}break;case ActType.SCRIPT:try{eval(action.dat)}catch(ex){var strErr=Lang.CouldnotRunAction+action.dat;if(ex instanceof Error){strErr+="<br><br>"+ex.name+": "+ex.message}else{if(ex.toString){strErr+="<br><br>"+ex.toString()}}UI.ShowMsg(strErr)}break;case ActType.SLIDE_ID:Prez.ShowSlideByID(action.dat,true);return;case ActType.SLIDE_IDX:Prez.ShowSlideByIndex(action.dat,true);return;case ActType.NEXT:Prez.ShowSlideByIndex(Prez.Session.SlideIndex+parseInt(action.dat),true);return;case ActType.PREV:var newIndex=Prez.Session.SlideIndex-parseInt(action.dat);if(newIndex>=0){Prez.ShowSlideByIndex(newIndex,true)}return}if(fnCb){fnCb()}};EvtMan.SubmitCode={AUTO:-1,MANUAL:-2};function EvtMan(a){this.evt=a;this.curAtp=0}EvtMan.prototype={constructor:EvtMan,IsEnabled:function(){return !this.timeout&&(this.evt.atp<0||this.evt.atp>this.curAtp||this.evt.atp===undefined)},IsLastAttempt:function(){return(this.evt.atp==this.curAtp)&&(this.curAtp>0)},SetTimeExpired:function(){this.timeout=true},Update:function(){this.timeout=false},GetResponse:function(p,a,j,b,g){var d={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(!b){b=this}if(g===undefined){g=true}var h=!(b.evt.mod&EvtMode.SURVEY);var l=this.evt[p];var o=p==EvtType.TEXT&&a=="";var f=false;switch(p){case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:if(h){if(!l||!l.length){if(p!=EvtType.TEXT||a==""){d.jud=Judge.CORRECT;d.pt=this.evt.pt;if(g){d.acts=b.GetActions(EvtType.CORRECT)}}else{d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}else{for(var e=0,c=l.length;e<c;++e){var k=InputUI.CheckEvtValue(p,a,l[e].val,j);if(k==Judge.PARTIAL_CORRECT&&p==EvtType.TEXT){if(this.evt.submit!=EvtMan.SubmitCode.AUTO){k=Judge.WRONG}}if(k!=Judge.WRONG){d.jud=k;if(k==Judge.CORRECT){if(this.evt.mod&EvtMode.PARTIAL_SCORE){d.pt=l[e].pt}else{d.pt=this.evt.pt}if(this.evt.mod&EvtMode.PARTIAL_ACTION){d.acts=l[e].acts}if(g){d.acts=d.acts.concat(b.GetActions(EvtType.CORRECT))}break}}}if(d.jud==Judge.UNEXPECTED||(o&&d.jud==Judge.PARTIAL_CORRECT)){if(o){var m=b.GetActions(EvtType.INCOMPLETE);f=(m.length>0);if(g){d.acts=m}}if(f){d.jud=Judge.INCOMPLETE}else{if(d.jud==Judge.UNEXPECTED){d.jud=Judge.WRONG;if(g){d.acts=b.GetActions(EvtType.WRONG)}}}}}}else{if(o){var m=b.GetActions(EvtType.INCOMPLETE);f=(m.length>0);if(g){d.acts=m}}if(f){d.jud=Judge.INCOMPLETE}else{d.jud=Judge.NEUTRAL;if(g){d.acts=b.GetActions(EvtType.COMPLETE)}}}break}return d},GetFirstEventValue:function(c){var b=0,a=this.evt[c];switch(c){case EvtType.TEXT:b="";case EvtType.KEY_DOWN:case EvtType.CLICK:if(a&&a.length){b=a[0].val}break}return b},GetPoints:function(e,c){if(e===undefined){return this.evt.pt||0}var a=this.evt[e];if(!a){return 0}if(c===undefined){return(a.all&&a.all.pt)||0}switch(e){case EvtType.TEXT:case EvtType.CLICK:case EvtType.KEY_DOWN:for(var b=0,d=a.length;b<d;++b){if(a[b].val==c){return a[b].pt||0}}return 0;default:return(a[c]&&a[c].pt)||0}},GetMaxPoints:function(f){if(this.evt.ptMax!==undefined){return this.evt.ptMax}var b=0;if(this.evt.mod&EvtMode.PARTIAL_SCORE){var a=this.evt[f],d;if(a){for(var c=0,e=a.length;c<e;++c){d=a[c].pt;if(d>b){b=d}}}}else{b=this.evt.pt||0}return(this.evt.ptMax=b)},GetActions:function(g,d){var b=this.evt[g];if(!b){return[]}if(d===undefined&&g!=EvtType.WRONG){return(b.all&&b.all.acts)||[]}switch(g){case EvtType.WRONG:var e=[];if(d===undefined){d=this.curAtp+1}var c=d==this.evt.atp;if(b[d]){e=b[d].acts}if(d>0){if(b[AtpType.ALL]){e=e.concat(b[AtpType.ALL].acts)}if(!c&&b[AtpType.ALL_BUT_LAST]){e=e.concat(b[AtpType.ALL_BUT_LAST].acts)}if(c&&b[AtpType.LAST]){e=e.concat(b[AtpType.LAST].acts)}if(e.length==0&&b[AtpType.OTHERS]){e=b[AtpType.OTHERS].acts}}return e||[];case EvtType.TEXT:case EvtType.KEY_DOWN:case EvtType.CLICK:for(var a=0,f=b.length;a<f;++a){if(b[a].val===d){return b[a].acts||[]}}return[];default:return(b[d]&&b[d].acts)||[]}},CleanUp:function(){}};SlideUI.currentLayerIdx=1;SlideUI.ClearLayer=function(c,b){var a=UI.GetSlideLayerID(c);$("#"+a+" > :not(.ap-ctrl-media,.ap-wmk)").remove();$("#"+a+" > .ap-ctrl-media").hide();if(b){$("#"+a+"_bg").remove()}};SlideUI.GetOtherLayerIndex=function(a){if(a==1){return 2}return 1};SlideUI.projSldID="sld_prj";function SlideUI(g){this.slide=g;this.isPrjSld=g==Prez.prjSlide;if(this.isPrjSld){this.layerIdx=3;this.id=SlideUI.projSldID;if(BrowserInfo.canPlayMultiSounds&&g.clkSounds&&g.clkSounds.length){this.clkSoundId=this.GetDOMCtrlID("clkSound");this.clkSounds=g.clkSounds;this.clkSoundPlayer=null;this.clkSoundPaused=false;this.bIncBuffCount=false;this.lastDOMId=this.clkSoundId}this.clkEffectId="fg_clickEffect";this.clkEffectCurRect={x:0,y:0,w:1,h:1};var k=mediaStats.nMaxProjSlideAudio+mediaStats.nMaxSlideAudio;if(k>0){this.lastDOMId=MediaManager.GetPlayerContainerId(k-1,this.id,true)}$("#"+this.clkEffectId).remove();var d='<div id="'+this.clkEffectId+'" style="position:absolute;left:0px;top:0px;width:1px;height:1px;display:none;overflow:hidden;z-index:'+ZIndexBase.ClickEffects+';"><img id="'+this.clkEffectId+'_bg" src="'+UI.BlankImgUrl()+'" alt="'+Lang.ClickEffect+'" style="position:absolute;top:0px;left:0px;"/></div>';UI.$Slides.append(d);$("#"+this.id).remove();var h="";h+='<div class="slide" id="'+this.id+'" style="z-index:'+ZIndexBase.SlidePrjCtrls+';">';if(this.clkSoundId){h+=MediaManager.CreatePlayerElements2(this.clkSoundId,true)}for(f=0;f<mediaStats.nMaxProjSlideAudio+mediaStats.nMaxSlideAudio;++f){h+=MediaManager.CreatePlayerElements(f,this.id,true)}for(f=0;f<mediaStats.nMaxProjSlideVideo;++f){h+=MediaManager.CreatePlayerElements(f,this.id,false)}h+="</div>";UI.$Slides.append(h)}else{this.layerIdx=SlideUI.GetOtherLayerIndex(SlideUI.currentLayerIdx);SlideUI.currentLayerIdx=this.layerIdx;this.id=UI.GetSlideLayerID(this.layerIdx);SlideUI.ClearLayer(this.layerIdx);this.wmkid="appwmk"+this.layerIdx}this.bgId=this.id+"_bg";$("#"+this.bgId).remove();if(!this.isPrjSld){UI.$Slides.append('<img id="'+this.bgId+'" style="display:none;" class="bgimg" src="'+Prez.GetSlideImage(this.slide.idx)+'" alt="'+(this.slide.acctext||"")+'" width="100%" height="100%" />')}this.ts=-1;this.ctrlUIs=[];this.allCtrlUIs={};this.inputUIs=[];this.triggeredUIs=[];this.zoomUI=null;this.CCaption=null;this.nVideoPlayerIndex=0;this.nSoundPlayerIndex=(this.isPrjSld?0:mediaStats.nMaxProjSlideAudio);var l=g.ineff;if(l&&!l.inited){EffectMan.InitEffect(l,{t:0,l:0,w:UI.slideW,h:UI.slideH});l.inited=true}var e=g.ctrls;var f,a=e.length;for(f=0;f<a;++f){var c=this.CreateControl(e[f]);if(c){c.Attach(this);if(!c.IsTriggeredByEvent()){this.ctrlUIs.push(c)}}}if(g.cursor){g.cursor.kind=CtrlKind.CURSOR;var j=this.CreateControl(g.cursor);if(j){j.Attach(this);this.ctrlUIs.push(j)}}if(g.ccaption&&(Params.CC.modes&Prez.Session.PMode)){this.CCaption=new SlideCCaptionUI(g.ccaption,this)}if(g.zoomAreas){this.zoomUI=new ZoomUI(g.zoomAreas,this)}for(var b in this.allCtrlUIs){this.allCtrlUIs[b].OnAttached()}}SlideUI.prototype={constructor:SlideUI,GetDOM:function(){return $("#"+this.id)},GetIndex:function(){return this.slide.idx},GetAudioPlayerId:function(){var a=MediaManager.GetPlayerContainerId(this.nSoundPlayerIndex,SlideUI.projSldID,true);this.nSoundPlayerIndex++;return a},GetVideoPlayerId:function(){var a=MediaManager.GetPlayerContainerId(this.nVideoPlayerIndex,this.id,false);this.nVideoPlayerIndex++;return a},CreateControl:function(b,a){if(!b){return null}var d=true;if(!a||b.startTime<0){d=(b.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(!d&&b.kind!=CtrlKind.BUTTON&&b.kind!=CtrlKind.INPUT){return null}var c=null;switch(b.kind){case CtrlKind.TEXTINPUT:c=new TxtInputUI(b,this);break;case CtrlKind.TOGGLE:c=new ToggleUI(b,this);break;case CtrlKind.BUTTON:b.type=InputUI.MOUSE;b.flags=CtrlFlags.FOCUSABLE;case CtrlKind.INPUT:c=new InputUI(b,this);break;case CtrlKind.ANSWER:c=new AnswerUI(b,this);break;case CtrlKind.QUIZ:c=new QuizUI(b,this);break;case CtrlKind.AUDIO:case CtrlKind.VIDEO:c=new MediaUI(b,this);
break;case CtrlKind.CURSOR:c=new CursorUI(b,this);break;case CtrlKind.FEEDBACK:c=new FeedbackUI(b,this);break;default:c=new CtrlUI(b,this);break}if(c){if(a){c.SetParent(a)}this.allCtrlUIs[c.id]=c}return c},GetDOMCtrlID:function(a){return"ctrl_"+this.layerIdx+"_"+a},GetCtrlUI:function(a,b){if(b){a=this.GetDOMCtrlID(a)}return this.allCtrlUIs[a]},GetMediaUI:function(a){if(a==this.clkSoundId){return this}return this.allCtrlUIs[a]},_IncBufCount:function(){if(!this.bIncBuffCount){this.bIncBuffCount=true;Prez.IncBufferingCount()}},_DecBufCount:function(){if(this.bIncBuffCount){this.bIncBuffCount=false;Prez.DecBufferingCount()}},CreateClickSoundPlayer:function(){if(!this.clkSoundId){return}var b="";for(i=0,nCount=this.clkSounds.length-1;i<nCount;++i){b+="data/res_"+this.clkSounds[i]+"."+MediaManager.strAudioExt+","}b+="data/res_"+this.clkSounds[i]+"."+MediaManager.strAudioExt;var a={context:this,ready:function(){this._OnPlayerReady()},end:function(){},statechanged:function(){this._OnPlayerStateChanged()}};$("#"+this.clkSoundId).show();this.clkSoundPlayer=MediaManager.CreatePlayer({files:b,mode:"audio"},this.clkSoundId,a)},PlayClickSound:function(a){if(!BrowserInfo.canPlayMultiSounds){return}if(!this.clkSoundPlayer){this.CreateClickSoundPlayer()}if(this.clkSoundPlayer){$(this).stopTime("playclicksound");$(this).oneTime(1,"playclicksound",function(){this.needPlayClickSound=true;var b=$.inArray(a,this.clkSounds);if(b>=0){this.clkSoundPlayer.LoadItem(b);var d=this.clkSoundPlayer.GetState();Log("PlayClickSound Player State: "+d);if(d==MediaStates.NOT_READY||d==MediaStates.OPENING||d==MediaStates.BUFFERING||d==MediaStates.CLOSED){}else{if(d!=MediaStates.ERROR){var c=Prez.GetState();if(c!=States.PAUSED&&c!=States.BUFFERING){this.clkSoundPlayer.Play(true)}this.needPlayClickSound=false}}}})}},_OnPlayerReady:function(){return;if(this.clkSoundPlayer&&BrowserInfo.canPlayMultiSounds){$("#"+this.clkSoundPlayer.GetId()).attr("tabindex","-1");this.clkSoundPlayer.SetVolume(Prez.GetVolume(true));var a=this.clkSoundPlayer.GetState();Log("Mouse Click Sound _OnPlayerReady | State: "+a);if(a==MediaStates.NOT_READY||a==MediaStates.OPENING||a==MediaStates.BUFFERING||a==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerStateChanged:function(){if(!this.needPlayClickSound){return}if(!BrowserInfo.canPlayMultiSounds){return}if(!this.clkSoundPlayer){return}var b=this.clkSoundPlayer.GetState();if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=Prez.GetState();if(a!=States.PAUSED&&a!=States.BUFFERING){this.clkSoundPlayer.Play(true)}this.needPlayClickSound=false}},PlayClickEffect:function(a,g,f,d,b,e,h){$(this).stopTime("click_effect");var c=$("#"+this.clkEffectId);var j=$("#"+this.clkEffectId+"_bg");a-=f/2;g-=d/2;this.clkEffectCurRect={x:a,y:g,w:f,h:d};var k=Prez.Scale*ZoomUI.Scale;c.css({left:a*k+"px",top:g*k+"px",width:f*k+"px",height:d*k+"px"});j.attr("src","data/"+b).css({left:"0%",top:"0%",width:100*h+"%",height:"100%"});c.show();$(this).everyTime(e,"click_effect",function(l){j.css("left",-(l*100)+"%");if(l>=h){c.hide()}},h)},ZoomClickEffect:function(b){var a=this.clkEffectCurRect;$("#"+this.clkEffectId).css({left:a.x*b+"px",top:a.y*b+"px",width:a.w*b+"px",height:a.h*b+"px"})},Mute:function(a){for(var b in this.allCtrlUIs){this.allCtrlUIs[b].Mute(a)}if(this.clkSoundPlayer){this.clkSoundPlayer.SetVolume(a?0:Prez.GetVolume())}},SetVolume:function(a){for(var b in this.allCtrlUIs){this.allCtrlUIs[b].SetVolume(a)}if(this.clkSoundPlayer){this.clkSoundPlayer.SetVolume(a)}},Raise:function(){if(!this.isPrjSld){var a=UI.GetSlideLayerID(SlideUI.GetOtherLayerIndex(this.layerIdx));$("#"+a+"_bg").css("z-index",ZIndexBase.SlideBgrOld);$("#"+a).css("z-index",ZIndexBase.SlideCtrlsOld);$("#"+this.bgId).css("z-index",ZIndexBase.SlideBgrNew);$("#"+this.id).css("z-index",ZIndexBase.SlideCtrlsNew)}},Show:function(c,f){if(!this.isPrjSld){Prez.Session.SlideIndex=this.slide.idx}this.inputUIs.length=0;this.triggeredUIs.length=0;this.ts=c||0;var d=$("#"+this.id),b=$("#"+this.bgId),e=this;if(this.slide.ineff&&this.ts<this.slide.ineff.duration){if(this.isPrjSld){EffectMan.Stop(d[0],false)}else{EffectMan.Stop(b[0],false);EffectMan.Stop(d[0],false);this.Raise()}this._Update();b.show();d.show();var a={exitEffect:false,secondStream:false,startTime:this.ts};if(!this.isPrjSld){EffectMan.Start(b[0],this.slide.ineff,a)}a.callback=function(){e._OnShow();if(f){f.call(this)}};EffectMan.Start(d[0],this.slide.ineff,a)}else{if(!this.isPrjSld){EffectMan.Stop(b[0],true,false);this.Raise();b.show()}EffectMan.Stop(d[0],true,false);d.show();this._Update();this._OnShow();if(f&&d[0]){f.call(d[0])}}},_Update:function(){if(this.zoomUI){this.zoomUI.Update()}else{if(!this.isPrjSld){ZoomUI.Reset()}}for(var a in this.allCtrlUIs){this.allCtrlUIs[a].Update()}if(this.CCaption){this.CCaption.Update()}else{if(!this.isPrjSld){ClosedCaptionUI.ClearCaption()}}},_OnShow:function(){if(!this.isPrjSld){$(this).oneTime(500,"removeprev",function(){SlideUI.ClearLayer(SlideUI.GetOtherLayerIndex(SlideUI.currentLayerIdx),true)})}if(!this.isPrjSld){if(this.slide.wm){$("#"+this.wmkid).show()}else{$("#"+this.wmkid).hide()}}if(!this.isPrjSld){CanvasNav.Focus(false)}},UpdatePrezStateChanged:function(){var d=Prez.GetState();var b,a,c;c=this.triggeredUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezStateChanged()}c=this.ctrlUIs;for(b=0,a=c.length;b<a;++b){c[b].UpdatePrezStateChanged()}if(this.CCaption){this.CCaption.UpdatePrezStateChanged()}},Tick:function(a){this.ts+=a;if(this.zoomUI){this.zoomUI.Tick()}var b=this.ctrlUIs.length;for(var c=0;c<b;++c){this.ctrlUIs[c].Tick()}if(this.CCaption){this.CCaption.Tick()}},IsEnd:function(){return this.slide.duration<=this.ts},CleanUp:function(){$(this).stopTime();if(!this.isPrjSld){EffectMan.Stop($("#"+this.bgId)[0],true,false)}else{$(this).stopTime("click_effect");$("#"+this.clkEffectId).remove()}EffectMan.Stop($("#"+this.id)[0],true,false);if(this.zoomUI){this.zoomUI.CleanUp()}for(var a in this.allCtrlUIs){this.allCtrlUIs[a].CleanUp()}if(this.CCaption){this.CCaption.CleanUp()}if(this.clkSoundPlayer){this.clkSoundPlayer.CleanUp();this.clkSoundPlayer=null;this.clkSounds=null;$("#"+this.clkSoundId).hide()}this.ctrlUIs.length=0;this.allCtrlUIs={};this.inputUIs.length=0;this.triggeredUIs.length=0;this.CCaption=null;this.zoomUI=null},Submit:function(){var c,b,a=this.ctrlUIs.length;for(b=0;b<a;++b){c=this.ctrlUIs[b];if(c.showState!=CtrlShowState.HIDE&&c.Submit&&c.evtMan&&c.ctrl.evt.submit!=EvtMan.SubmitCode.AUTO){c.Submit()}}},ClearUserInput:function(a){var d,c,b=this.ctrlUIs.length;for(c=0;c<b;++c){d=this.ctrlUIs[c];if(d.showState!=CtrlShowState.HIDE&&d.ClearUserInput){d.ClearUserInput(a)}}},AddInputUI:function(a){if($.inArray(a,this.inputUIs)==-1){this.inputUIs.push(a)}},RemoveInputUI:function(b){var a=$.inArray(b,this.inputUIs);if(a>-1){this.inputUIs.splice(a,1)}},AddTriggeredUI:function(a){if($.inArray(a,this.triggeredUIs)==-1){this.triggeredUIs.push(a)}},RemoveTriggeredUI:function(b){var a=$.inArray(b,this.triggeredUIs);if(a>-1){this.triggeredUIs.splice(b,1)}},LoadSubmitedData:function(){var c=Prez.Session.RestoreData.slides;if(!c){return}var d=c[this.slide.idx];if(!d){return}var a=this.ctrlUIs.length;for(var b=0;b<a;++b){this.ctrlUIs[b].LoadSubmitedData(d)}},GetSubmitedDataObject:function(){var a=Prez.Session.RestoreData.slides;if(!a){a=[];Prez.Session.RestoreData.slides=a}var b=a[this.slide.idx];if(!b){b={};a[this.slide.idx]=b}return b},AcceptResumeToken:function(){for(var b in this.allCtrlUIs){var a=this.allCtrlUIs[b];if(a.AcceptResumeToken&&a.AcceptResumeToken()){return true}}return false}};CtrlUI.GenCSSRect=function(a,b){return"top:"+(b*a.t)+"px;left:"+(b*a.l)+"px;width:"+(b*a.w)+"px;height:"+(b*a.h)+"px;"};function CtrlUI(d,a){this.ctrl=d;this.parentUI=null;this.slideUI=a;this.id=a.GetDOMCtrlID(d.id);this.inputId=this.id;this.ignoreWaiting=false;if(d.fshtml!==undefined){d.html=d.fshtml;d.css=d.fscss;if(Options.zoom_percent!=100){ScaleFont(d,Options.zoom_percent/100)
}d.fshtml=undefined;d.fscss=undefined}this.showState=CtrlShowState.HIDE;if(d.evt){this.evtMan=new EvtMan(d.evt)}var e=(d.kind==CtrlKind.QUIZ||d.kind==CtrlKind.ANSWER);var c=d.ineff;if(c){if(!c.inited){EffectMan.InitEffect(c,d.rect,e);c.inited=true}this.endIn=c.duration;if(d.startTime>0){this.endIn+=d.startTime}}c=d.outeff;if(c){if(!c.inited){EffectMan.InitEffect(c,d.rect,e);c.inited=true}if(d.duration<0&&d.startTime<0){d.duration=3000}if(d.duration<0||((d.flags&CtrlFlags.LOOP)&&d.duration>0)){this.startOut=a.slide.duration-c.duration}else{this.startOut=d.duration-c.duration;if(d.startTime>0){this.startOut+=d.startTime}}}this.role="alert";this.bIncBuffCount=false;if(d.audio&&d.kind!=CtrlKind.AUDIO){var b=(d.kind==CtrlKind.BUTTON||(d.kind==CtrlKind.INPUT&&d.type==InputUI.MOUSE));if(!b){this.playerId=a.GetAudioPlayerId()}}}$.extend(CtrlUI.prototype,{constructor:CtrlUI,GetParent:function(){return this.parentUI},SetParent:function(a){this.parentUI=a},GetTopLevel:function(){var b=this,a=this.parentUI;while(a){b=a;a=a.parentUI}return b},IsTopLevel:function(){return !this.parentUI},IsEnabled:function(a){if(this.cleaned){return false}if(!a&&(Prez.Session.state==States.PAUSED||Prez.Session.state==States.BUFFERING)){return false}if(Prez.Session.PMode&PlayModes.DEMO){return false}if(this.evtMan&&(this.evtMan.evt.mod&EvtMode.INDEPENDENT)){return this.evtMan.IsEnabled()}var b=this.GetTopLevel();if(b.evtMan){return b.evtMan.IsEnabled()}return false},IsShown:function(){return(this.showState!=CtrlShowState.HIDE)&&!this.cleaned},IsTriggeredByEvent:function(){return this.ctrl.startTime<0},GetSlide:function(){return this.slideUI},GetEventMan:function(){return this.evtMan},GetDOM:function(){return $("#"+this.id)},GetLabelHTML:function(b){if(!this.ctrl.html){return""}if(b===undefined||b==1){return'<div id="'+this.id+'_lb" class="label" style="'+CtrlUI.GenCSSRect(this.ctrl.tr,1)+this.ctrl.css+'">'+this.ctrl.html+"</div>"}var a={html:this.ctrl.html,css:this.ctrl.css};ScaleFont(a,b);return'<div id="'+this.id+'_lb" class="label" style="'+CtrlUI.GenCSSRect(this.ctrl.tr,b)+a.css+'">'+a.html+"</div>"},GetHTML:function(){var c,a="";if(this.ctrl.acctext){a=this.ctrl.acctext}if(UI.IEBLOW){c='<img id="'+this.id+'_bg" class="bgimg" src="'+UI.BlankImgUrl()+'" alt="'+a+'" role="presentation" width="100%" height="100%" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src=\''+this.GetImg()+"');\" />"}else{c='<img id="'+this.id+'_bg" class="bgimg" src="'+this.GetImg()+'" alt="'+a+'" role="presentation" width="100%" height="100%" />'}var b="";if(this.id==this.inputId){b=this.GetARIAAttrs()}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,Prez.Scale)+'" aria-hidden="true" '+b+">"+c+this.GetLabelHTML(Prez.Scale)+this.GetInputHTML()+"</div>"},GetInputHTML:function(){return""},GetARIAAttrs:function(){var a="";if(this.role){a+=' role="'+this.role+'"'}if(this.ctrl.acctext){a+=' aria-label="'+this.ctrl.acctext+'"'}return a},Zoom:function(d){var a=$("#"+this.id)[0];if(!a){return}var b=a.style,c=this.ctrl.rect;if((this.showState!=CtrlShowState.SHOWING||(this.ctrl.ineff.type!=Effect.Type.FLY&&this.ctrl.ineff.type!=Effect.Type.PEEK))&&(this.showState!=CtrlShowState.HIDING||(this.ctrl.outeff.type!=Effect.Type.FLY&&this.ctrl.outeff.type!=Effect.Type.PEEK))){b.top=(d*c.t)+"px";b.left=(d*c.l)+"px"}b.width=(d*c.w)+"px";b.height=(d*c.h)+"px";if(this.ctrl.html){$("#"+this.id+"_lb").replaceWith(this.GetLabelHTML(d))}},GetIniProps:function(){return{left:this.ctrl.rect.l,top:this.ctrl.rect.t}},Attach:function(a){if(a.lastDOMId===undefined){$("#"+a.id).prepend(this.GetHTML())}else{$("#"+a.lastDOMId).after(this.GetHTML())}a.lastDOMId=this.id},InitAudioPlayer:function(){if(this.ctrl.audio&&this.ctrl.kind!=CtrlKind.AUDIO&&this.ctrl.kind!=CtrlKind.BUTTON&&(this.ctrl.kind!=CtrlKind.INPUT||this.ctrl.type!=InputUI.MOUSE)){var b={context:this,ready:function(){this._OnPlayerReady()},end:function(){this._OnPlayerEnded()},statechanged:function(){this._OnPlayerStateChanged()}};var a={file:"data/res_"+this.ctrl.audio+"."+MediaManager.strAudioExt,mode:"audio"};$("#"+this.playerId).show();this.sound=MediaManager.CreatePlayer(a,this.playerId,b)}},OnAttached:function(){this.iniProps=this.GetIniProps();if(!this.parentUI&&this.ctrl.startTime>=0){if(this.ctrl.duration<0||((this.ctrl.flags&CtrlFlags.LOOP)&&this.ctrl.duration>0)){if(this.startOut!==undefined){this.endTime=this.slideUI.slide.duration}else{this.endTime=-1}}else{this.endTime=this.ctrl.startTime+this.ctrl.duration;if(this.endTime>=this.slideUI.slide.duration-100&&this.startOut===undefined){this.endTime=-1}}}if(!this.evtMan){return}if(!BrowserInfo.iDevice&&!BrowserInfo.android){var a=$("#"+this.inputId),d=this;var b=this.evtMan.GetActions(EvtType.MOUSE_ENTER);if(b.length){a.mouseenter(function(){if(d.IsEnabled()){EvtMan.DoActions(b)}})}var c=this.evtMan.GetActions(EvtType.MOUSE_LEAVE);if(c.length){a.mouseleave(function(){if(d.IsEnabled()){EvtMan.DoActions(c)}})}}},GetShowState:function(a,b){var c=this.ctrl.startTime;b.ctrlTs=a-c;if(a<c){b.value=CtrlShowState.HIDE}else{if(this.endIn&&a<this.endIn){b.value=CtrlShowState.SHOWING;b.ts=b.ctrlTs}else{if(this.startOut!==undefined){if(a<this.startOut){b.value=CtrlShowState.SHOW}else{if(a<this.endTime){b.value=CtrlShowState.HIDING;b.ts=a-this.startOut}else{b.value=CtrlShowState.HIDE}}}else{if(this.endTime<0||a<this.endTime){b.value=CtrlShowState.SHOW}else{b.value=CtrlShowState.HIDE}}}}},Show:function(a,e){var b=false;if((this.showState==CtrlShowState.HIDE||e)&&a.value!=CtrlShowState.HIDE){if(this.ctrl.startTime<0){this.slideUI.AddTriggeredUI(this)}$(this).stopTime("hide");if(e&&this.ctrl.duration>=0){var f=this.ctrl.duration;if(this.ctrl.outeff){f-=this.ctrl.outeff.duration}$(this).oneTime(f,"hide",function(){this.Hide(true)})}$(this).stopTime("timelimit");if(this.evtMan&&!this.parentUI&&this.IsEnabled(true)){var h=this.ctrl.evt.timeLimit;if(h!==undefined&&h>=0){$(this).oneTime(h,"timelimit",function(){this._Timeout()})}}b=true}this.showState=a.value;var j=this,c=$("#"+this.id);var d=c[0];var g={secondStream:this.ctrl.startTime<0,startTime:a.ts};switch(a.value){case CtrlShowState.SHOWING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.iniProps);c.show().attr("aria-hidden","false");g.exitEffect=false;g.callback=function(){j.showState=CtrlShowState.SHOW};EffectMan.Start(d,this.ctrl.ineff,g);break;case CtrlShowState.HIDING:EffectMan.Stop(d,false);EffectMan.Reset(d,this.iniProps);c.show().attr("aria-hidden","false");g.exitEffect=true;g.callback=function(){j._OnHideComplete()};EffectMan.Start(d,this.ctrl.outeff,g);break;case CtrlShowState.HIDE:EffectMan.Stop(d,false);this._OnHideComplete();break;default:EffectMan.Stop(d,false);EffectMan.Reset(d,this.iniProps);c.show().attr("aria-hidden","false");break}if(b){this._OnShowStart(a.ctrlTs)}},_IncBufCount:function(){if(!this.bIncBuffCount){this.bIncBuffCount=true;Prez.IncBufferingCount()}},_DecBufCount:function(){if(this.bIncBuffCount){this.bIncBuffCount=false;Prez.DecBufferingCount()}},_OnShowStart:function(d){$("#"+this.id).attr("aria-hidden","false");if(!this.sound){this.InitAudioPlayer()}if(this.sound){var c=this.sound.GetState();Log(this.id+": _OnShowStart Player State 1: "+c);if(c==MediaStates.BUFFERING||c==MediaStates.PAUSED||c==MediaStates.PLAYING||c==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.sound.Play(false,a)}c=this.sound.GetState();Log(this.id+": _OnShowStart Player State 2: "+c);if(c==MediaStates.NOT_READY||c==MediaStates.OPENING||c==MediaStates.BUFFERING||c==MediaStates.CLOSED){this.soundPaused=true;this._IncBufCount()}else{if(c!=MediaStates.ERROR){var b=Prez.GetState();if(b==States.PAUSED||b==States.BUFFERING){this.sound.Play(false);this.soundPaused=true}else{this.sound.Play(true)}this.soundPaused=false}}}},Hide:function(a){$(this).stopTime("hide");if(a&&this.startOut!==undefined&&this.showState!=CtrlShowState.HIDE){if(this.showState==CtrlShowState.HIDING){EffectMan.Resume($("#"+this.id)[0])
}else{this.Show({value:CtrlShowState.HIDING,ts:0,ctrlTs:this.startOut},false)}}else{this.Show({value:CtrlShowState.HIDE},false)}},_OnHideComplete:function(){$("#"+this.id).hide().attr("aria-hidden","true");this.showState=CtrlShowState.HIDE;if(this.sound&&this.ctrl.meddur>this.ctrl.duration){var a=this.sound.GetState();if(a==MediaStates.BUFFERING||a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.sound.Play(false)}this.sound.SetPlayerReady(false)}$(this).stopTime("showstart").stopTime("hide").stopTime("timelimit");if(this.ctrl.startTime<0){this.slideUI.RemoveTriggeredUI(this)}var b=this;if(this.onHide){window.setTimeout(function(){if(b.onHide){b.onHideTmp=b.onHide;delete b.onHide;b.onHideTmp();delete b.onHideTmp}},1)}},SetOnHideCallback:function(b){if(!b){return}var a=this.onHide;this.onHide=function(){if(a){a.call(this)}b.call(this)}},UpdatePrezStateChanged:function(){var a=Prez.GetState();if(a==States.RUNNING||a==States.WAITING){$(this).resumeTime("timelimit");$(this).resumeTime("hide");if(this.soundPaused&&this.sound&&this.showState!=CtrlShowState.HIDE){var b=this.sound.GetState();if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){this.sound.Play(true)}else{Log(this.id+": Resume a non ready player, state: "+b)}}this.soundPaused=false}if(a==States.PAUSED||a==States.BUFFERING){$(this).pauseTime("timelimit");$(this).pauseTime("hide");if(this.sound&&this.showState!=CtrlShowState.HIDE){var b=this.sound.GetState();if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.BUFFERING){this.sound.Play(false)}else{Log(this.id+": Pause a non ready player, state: "+b)}}this.soundPaused=true}},_Timeout:function(){$(this).stopTime("timelimit");if(this.showState!=CtrlShowState.HIDE&&this.IsEnabled()&&this.evtMan){this.evtMan.SetTimeExpired();EvtMan.DoActions(this.evtMan.GetActions(EvtType.TIMEOUT))}},Update:function(){if(this.onHide){delete this.onHide}if(this.evtMan){this.evtMan.Update()}delete this.doingLastAttempt;this.ignoreWaiting=false;this.soundPaused=false;if(this.sound){this.sound.Play(false)}var b={},a=this.slideUI.ts;if(this.ctrl.startTime<0){b.value=CtrlShowState.HIDE}else{if(this.parentUI){b.value=CtrlShowState.SHOW;b.ctrlTs=a-this.ctrl.startTime}else{this.GetShowState(a,b)}}this.showState=CtrlShowState.HIDE;this.Show(b);if(b.value!=CtrlShowState.HIDE){this._WaitIfNeed(true,a)}},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOWING:this._WaitIfNeed(false,a);break;case CtrlShowState.SHOW:if(!this._WaitIfNeed(false,a)){this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}}break;case CtrlShowState.HIDE:this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b);this._WaitIfNeed(false,a)}break}},IgnoreWaiting:function(a){this.ignoreWaiting=a},_WaitIfNeed:function(c,b){if(this.evtMan&&!this.ignoreWaiting&&!this.parentUI&&(this.IsEnabled()||this.doingLastAttempt)){var a=this.ctrl.evt.startWait;if(a>=0){a+=this.ctrl.startTime;if(a<=b){if(!c||a==b){this.ignoreWaiting=true;Prez.Pause(States.WAITING);return true}else{if(c){this.ignoreWaiting=true}}}}}return false},CleanUp:function(){$(this).stopTime();$("#"+this.id).stop(true);EffectMan.Stop($("#"+this.id)[0],true,false);if(this.onHide){delete this.onHide}if(this.sound){this.sound.CleanUp();this.sound=null;$("#"+this.playerId).hide()}$("#"+this.inputId).unbind();if(this.evtMan){this.evtMan.CleanUp()}this.cleaned=true},Submit:function(){},LoadSubmitedData:function(){},GetSubmitedDataObject:function(){var b=this.slideUI.GetSubmitedDataObject();var a=b[this.ctrl.id];if(!a){a={};b[this.ctrl.id]=a}return a},GetImg:function(){return"data/img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".png"},_OnPlayerReady:function(){if(this.sound){this.sound.SetVolume(Prez.GetVolume(true));if(this.showState==CtrlShowState.HIDE){return}var b=this.sound.GetState();Log(this.id+": _OnPlayerReady Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.sound.Play(false,a)}b=this.sound.GetState();Log(this.id+": _OnPlayerReady Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerEnded:function(){},_OnPlayerStateChanged:function(){if(this.showState==CtrlShowState.HIDE||!this.sound){return}var a=this.sound.GetState();if(!this.bIncBuffCount){if(a==MediaStates.OPENING||a==MediaStates.BUFFERING){this._IncBufCount()}}else{if(a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.ERROR||a==MediaStates.STOPPED){this._DecBufCount()}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime;if(a<0){a=0}}return a},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.sound){this.sound.SetVolume(a)}},IsFocusable:function(){return false},Focus:function(){return false},MouseEnter:function(){$("#"+this.inputId).mouseenter()},MouseLeave:function(){$("#"+this.inputId).mouseleave()}});InputUI.MOUSE=1;InputUI.KEY=2;InputUI.MOUSE_HOVER=3;InputUI.GetCombinedCode=function(c,d,a,e){switch(c){case Key.CTRL:d=true;c=0;break;case Key.SHIFT:a=true;c=0;break;case Key.ALT:e=true;c=0;break}var b=0;if(d){b|=Key.MOD_CTRL}if(a){b|=Key.MOD_SHIFT}if(e){b|=Key.MOD_ALT}return((b<<24)|c)};InputUI.GetEvtValue=function(a){return InputUI.GetCombinedCode(a.apWhich,a.ctrlKey,a.shiftKey,a.altKey)};InputUI.CheckEvtValue=function(h,b,g,a){if(h==EvtType.TEXT){if(!a){b=b.toLowerCase();g=g.toLowerCase()}if(b==g){return Judge.CORRECT}if(g.substr(0,b.length)==b&&b.length<g.length){return Judge.PARTIAL_CORRECT}return Judge.WRONG}if(b==g){return Judge.CORRECT}var c=b&16777215,e=g&16777215,d=b>>24,f=g>>24;if(h==EvtType.KEY_DOWN){if((c==0||c==e)&&(d&f)==d){return Judge.PARTIAL_CORRECT}}else{if(c==0&&(d&f)==d){return Judge.PARTIAL_CORRECT}}return Judge.WRONG};function InputUI(b,a){CtrlUI.call(this,b,a);this.inputId=this.id+"_inp";this.bgId=this.id+"_bg";if(this.ctrl.html){this.labelId=this.id+"_lb"}this.showShape=true;if(this.IsTopLevel()||this.IsTriggeredByEvent()){this.showShape=(this.ctrl.showMode&Prez.Session.PMode)==Prez.Session.PMode}if(this.ctrl.flags&CtrlFlags.FOCUSABLE){this.role="button"}}$.extend(InputUI.prototype,CtrlUI.prototype,{constructor:InputUI,GetInputHTML:function(){var a='<div id="'+this.inputId+'" class="evtreceiver" onclick="void(0)" '+this.GetARIAAttrs();if(this.ctrl.flags&CtrlFlags.FOCUSABLE){a+=' tabindex="-1"></div>'}else{a+="></div>"}return a},OnAttached:function(){var b=$("#"+this.inputId);if(this.showShape){b.css("cursor","pointer")}else{$("#"+this.bgId).css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}var a=this;if(this.ctrl.flags&CtrlFlags.FOCUSABLE){if(this.ctrl.type==InputUI.MOUSE){b.bind("keydown",function(c){if(!a.IsEnabled()){return}if(c.apWhich===undefined){c.apWhich=Key.ToMozKey(c.which)}if(c.apWhich==Key.SPACE||c.apWhich==Key.ENTER){$(document).trigger("feedback",[c]);a.Submit(EvtType.CLICK,a.evtMan.GetFirstEventValue(EvtType.CLICK));return EvtMan.StopEvent(c)}})}b.bind("mousedown.focus",function(){if(a.IsFocusable()){a.Focus()}});b.focus(function(){if(Options.HilightFocus){$("#"+a.id).addClass("focused")}CanvasNav.OnCtrlFocused(a)}).blur(function(){if(Options.HilightFocus){$("#"+a.id).removeClass("focused")}})}if(this.ctrl.type==InputUI.MOUSE&&this.ctrl.audio){b.bind("mousedown.sound",function(c){if(a.IsEnabled()&&a.showState!=CtrlShowState.HIDE&&Prez.prjSldUI){Prez.prjSldUI.PlayClickSound(a.ctrl.audio)}})}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Options.FlashABSpeed>0&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){this._Flashing()})}if(this.IsEnabled(true)){if(this.ctrl.type!=InputUI.MOUSE_HOVER){this.slideUI.AddInputUI(this)
}}if(!CanvasNav.GetFocusedCtrl()&&this.IsFocusable()){this.Focus()}else{CanvasNav.Focus(false)}},_OnHideComplete:function(){$(this).stopTime("flashing");this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},UpdatePrezStateChanged:function(){var a=Prez.GetState();if(a==States.PAUSED||a==States.BUFFERING){$(this).stopTime("flashing");if(this.showShape){$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}}if(a==States.RUNNING||a==States.WAITING){if(this.showState!=CtrlShowState.HIDE&&Options.FlashABSpeed&&this.IsTopLevel()&&this.ctrl.type!=InputUI.MOUSE_HOVER){var b=this;$(this).stopTime("flashing");$(this).everyTime(Options.FlashABSpeed,"flashing",function(){b._Flashing()})}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},_Flashing:function(){if(!this.showShape){return}var a=$("#"+this.bgId);if(a.css("visibility")=="hidden"){a.css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}}else{a.css("visibility","hidden");if(this.labelId){$("#"+this.labelId).css("visibility","hidden")}}},Submit:function(g,f,c){if(!c){c=this.GetResponse(g,f)}if(c.jud!=Judge.UNEXPECTED&&c.jud!=Judge.PARTIAL_CORRECT){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}if(this.ctrl.kind==CtrlKind.INPUT&&this.ctrl.type!=InputUI.MOUSE_HOVER){var b=this.GetSubmitedDataObject();b.v=f;b.a=this.evtMan.curAtp;b.p=c.pt;b.j=c.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,c.jud,c.pt,g,f)}catch(d){if(!bSuppressSCORMException){alert(d.toString())}}}}var a=EvtMan.DoActions(c.acts,this);if(c.jud==Judge.WRONG&&(Prez.Session.PMode&(PlayModes.PRAC|PlayModes.TUT))){this.ShowShape()}CtrlUI.prototype.Submit.call(this);return a}},GetResponse:function(d,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled()||this.ctrl.type==InputUI.MOUSE_HOVER){return a}if(d==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}var c=this.ctrl.type==InputUI.KEY?EvtType.KEY_DOWN:EvtType.CLICK;if(d==EvtType.CLICK&&Mouse.fromTouchEvent){d=c;b=this.evtMan.GetFirstEventValue(d)}if(d==c){a=this.evtMan.GetResponse(d,b)}else{if(d==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){if(b&16777215){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}else{a=this.evtMan.GetResponse(EvtType.CLICK,b)}}}}return a},IsFocusable:function(){return(this.ctrl.flags&CtrlFlags.FOCUSABLE)&&(this.showState!=CtrlShowState.HIDE)&&this.IsEnabled(true)},Focus:function(){$("#"+this.inputId).focus();this.slideUI.GetDOM().scrollLeft(0).scrollTop(0);return true},ShowShape:function(){this.showShape=true;$("#"+this.bgId).css("visibility","visible");if(this.labelId){$("#"+this.labelId).css("visibility","visible")}$("#"+this.inputId).css("cursor","pointer")},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.evtMan.curAtp=a.a},CleanUp:function(){$(this).stopTime("flashing");if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)}});TxtInputUI.PASSWORD=1;TxtInputUI.MULTILINE=2;TxtInputUI.RETAIN=4;TxtInputUI.CASESENS=8;TxtInputUI.LASTCHARTIME=500;function TxtInputUI(b,a){CtrlUI.call(this,b,a);this.inputId=this.id+"_inp";this.textboxId=this.id+"_txtbox";this.labelId=this.id+"_lb";this.inputRc={t:b.tr.t+b.rect.t,l:b.tr.l+b.rect.l,w:b.tr.w,h:b.tr.h};this.inputFontSize=parseFloat($('<div style="'+b.css+'"></div>').css("font-size"));if(isNaN(this.inputFontSize)){this.inputFontSize=12}this.typingText="";this.prevSubmitedText=undefined;this.prevCorrectText="";this.role=""}$.extend(TxtInputUI.prototype,CtrlUI.prototype,{constructor:TxtInputUI,GetInputHTML:function(){var c="",a=CtrlUI.GenCSSRect(this.ctrl.tr,Prez.Scale);if(Prez.Scale==1){a+=this.ctrl.css}else{var b={html:"",css:this.ctrl.css};ScaleFont(b,Prez.Scale);a+=b.css}if(this.ctrl.flags&TxtInputUI.MULTILINE){c='<textarea id="'+this.textboxId+'" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1"></textarea>'}else{if(this.ctrl.flags&TxtInputUI.PASSWORD){c='<input id="'+this.textboxId+'" type="password" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1" autocomplete="off" />'}else{c='<input id="'+this.textboxId+'" type="text" class="edit" style="'+a+'" '+this.GetARIAAttrs()+' tabindex="-1" autocomplete="off" />'}}return'<div id="'+this.inputId+'" class="evtreceiver">'+c+"</div>"},OnAttached:function(){if(Prez.Session.PMode==PlayModes.DEMO&&this.IsTopLevel()){this.typingText=this.evtMan.GetFirstEventValue(EvtType.TEXT);if(!this.typingText){this.typingText=""}}if(this.typingText.length){var b=this.ctrl.duration;if(b<0){b=this.slideUI.slide.duration-this.ctrl.startTime}b-=TxtInputUI.LASTCHARTIME;this.typingDelay=0;if(this.ctrl.ineff){this.typingDelay=this.ctrl.ineff.duration;b-=this.typingDelay}if(this.ctrl.outeff){b-=this.ctrl.outeff.duration}this.typingInterval=Math.floor(b/this.typingText.length);this.typingTs=0}var e=$("#"+this.inputId),d=$("#"+this.textboxId),c=this;d.focus(function(){$("#"+c.labelId).hide();if(Options.HilightFocus){$("#"+c.id).addClass("focused")}CanvasNav.OnCtrlFocused(c)}).blur(function(){if(!this.value){$("#"+c.labelId).show()}if(Options.HilightFocus){$("#"+c.id).removeClass("focused")}});e.bind("click",function(f){if(c.IsFocusable()){c.Focus()}}).bind("mousedown mouseup",function(f){if(f.type=="mousedown"){Mouse.Norm(f,false);$(document).trigger("feedback",[f])}f.stopPropagation()});var a=this.ctrl.evt.submit;if(a==EvtMan.SubmitCode.AUTO){d.bind("keyup",function(){if(!c.IsEnabled()){return}c.Submit()})}else{if(a>0){d.bind("keydown keyup",function(f){if(!c.IsEnabled()){return}if(f.apWhich===undefined){f.apWhich=Key.ToMozKey(f.which)}if(Key.ShouldHandleKeyUp(f.apWhich)){if(f.type!="keyup"){return EvtMan.StopEvent(f)}}else{if(f.type!="keydown"){return EvtMan.StopEvent(f)}}if(a==InputUI.GetEvtValue(f)){$(document).trigger("feedback",[f]);c.Submit();return EvtMan.StopEvent(f)}})}}CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(c){CtrlUI.prototype._OnShowStart.call(this,c);if(this.IsEnabled(true)){this.slideUI.AddInputUI(this)}if(!CanvasNav.GetFocusedCtrl()&&this.IsFocusable()){this.Focus()}if(this.typingText!=""){var b=0;if(this.typingTs>=this.typingDelay){if(this.typingInterval>0){b=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval)}else{b=this.typingText.length}}this.SetValue(this.typingText.substr(0,b));if(b<this.typingText.length){$(this).stopTime("typing").everyTime(this.typingInterval,"typing",function(){this._SimulateTyping()})}var a=this.GetValue().length;this.SetSelection(a,a)}},_OnHideComplete:function(){if(this.typingText!=""){$(this).stopTime("typing")}this.slideUI.RemoveInputUI(this);CtrlUI.prototype._OnHideComplete.call(this)},Update:function(){if(this.typingText!=""){this.typingTs=this.slideUI.ts-this.ctrl.startTime;if(this.typingTs<0){this.typingTs=0}}this.prevSubmitedText=undefined;this.prevCorrectText="";CtrlUI.prototype.Update.call(this)},UpdatePrezStateChanged:function(){var a=Prez.GetState();if(this.typingText!=""&&(a==States.RUNNING)){$(this).resumeTime("typing")}if(this.typingText!=""&&(a==States.PAUSED||a==States.BUFFERING)){$(this).pauseTime("typing")}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},Zoom:function(d){var e=$("#"+this.textboxId);var a=e[0],b,c;if(a){b=a.style;c=this.ctrl.tr;b.top=(d*c.t)+"px";b.left=(d*c.l)+"px";b.width=(d*c.w)+"px";b.height=(d*c.h)+"px";e.css("font-size",this.inputFontSize*d)}CtrlUI.prototype.Zoom.call(this,d)},Submit:function(f,d,b){if(f===undefined){f=EvtType.TEXT}if(d===undefined){d=this.GetValue()}if(f==EvtType.TEXT&&d==this.prevSubmitedText){return}if(!b){b=this.GetResponse(f,d)}if(b.jud!=Judge.UNEXPECTED&&b.jud!=Judge.PARTIAL_CORRECT){if(b.jud!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}if(!this.parentUI){var a=this.GetSubmitedDataObject();
a.a=this.evtMan.curAtp;a.v=this.GetValue();a.p=b.pt;a.j=b.jud;if(bSendToLMS){try{scormStoreCtrlInteractionData(this,b.jud,b.pt,f,d)}catch(c){if(!bSuppressSCORMException){alert(c.toString())}}}}}if(b.jud==Judge.WRONG&&f==EvtType.TEXT){this.SetSelection(this.prevCorrectText.length,d.length)}EvtMan.DoActions(b.acts,this);CtrlUI.prototype.Submit.call(this)}if(b.jud!=Judge.UNEXPECTED&&f==EvtType.TEXT){this.prevSubmitedText=d;if(b.jud!=Judge.WRONG){this.prevCorrectText=d}}},SetSelection:function(e,c){var a=$("#"+this.textboxId)[0];if(!a){return}if(this.IsFocusable()){this.Focus()}try{if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveStart("character",e);b.moveEnd("character",c-e);b.select()}else{if(a.setSelectionRange){a.setSelectionRange(e,c)}else{if(a.selectionStart){a.selectionStart=e;a.selectionEnd=c}}}}catch(d){}},GetResponse:function(c,b){var a={jud:Judge.UNEXPECTED,pt:0,acts:[]};if(this.showState==CtrlShowState.HIDE||!this.IsEnabled()){return a}if(c===undefined){c=EvtType.TEXT}if(b===undefined){b=this.GetValue()}if(c==EvtType.CLICK&&b==Mouse.CLICK_OUTSIDE){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}return a}if(c==EvtType.TEXT){a=this.evtMan.GetResponse(c,b,this.ctrl.flags&TxtInputUI.CASESENS)}else{if(c==EvtType.KEY_DOWN){if((this.ctrl.evt.mod&EvtMode.SURVEY)==0){a.jud=Judge.WRONG;a.acts=this.evtMan.GetActions(EvtType.WRONG)}}}return a},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled())){return}this.SetValue("")},IsFocusable:function(){return(this.showState!=CtrlShowState.HIDE)&&this.IsEnabled(true)},Focus:function(){$("#"+this.textboxId).focus();if(UI.IEBrowser){var a=this;window.setTimeout(function(){a.slideUI.GetDOM().scrollLeft(0).scrollTop(0)},0)}else{this.slideUI.GetDOM().scrollLeft(0).scrollTop(0)}return true},GetValue:function(){return $("#"+this.textboxId).val()},SetValue:function(a){$("#"+this.textboxId).val(a)},IsCaseSensitive:function(){return this.ctrl.flags&TxtInputUI.CASESENS},LoadSubmitedData:function(b){var a=b[this.ctrl.id];if(!a){return}this.SetValue(a.v);this.evtMan.curAtp=a.a},CleanUp:function(){if(this.showState!=CtrlShowState.HIDE){$("#"+this.inputId).removeClass("evtreceiver")}CtrlUI.prototype.CleanUp.call(this)},_SimulateTyping:function(){this.typingTs+=this.typingInterval;if(this.typingTs<this.typingDelay){return}var a;if(this.typingInterval<=0){a=this.typingText.length}else{a=Math.floor((this.typingTs-this.typingDelay)/this.typingInterval);if(a>this.typingText.length){a=this.typingText.length}}if(this.GetValue().length!=a){this.SetValue(this.typingText.substr(0,a));this.SetSelection(a,a)}if(a>=this.typingText.length){$(this).stopTime("typing")}}});AnswerUI.Type={RADIO:1,CHECK:2,TEXT:3,COMBO:4};function AnswerUI(b,a){CtrlUI.call(this,b,a);this.actUI=a.CreateControl(this.ctrl.act,this);this.noteUI=a.CreateControl(this.ctrl.note,this)}$.extend(AnswerUI.prototype,CtrlUI.prototype,{constructor:AnswerUI,GetHTML:function(){var a='<div id="'+this.id+'" class="comctrl">';if(this.noteUI){a+=this.noteUI.GetHTML()}if(this.actUI){a+=this.actUI.GetHTML()}a+="</div>";return a},GetIniProps:function(){return{left:0,top:0}},OnAttached:function(){if(this.actUI&&this.noteUI&&this.actUI.ctrl.kind==CtrlKind.TOGGLE){var b=this.actUI,a=this.noteUI.id;$('<div id="'+a+'_inp" class="evtreceiver"></div>').appendTo($("#"+a)).click(function(){b.Click();return false}).hover(function(){b.Hover(true)},function(){b.Hover(false)}).bind("mousedown mouseup",function(c){c.stopPropagation()}).css("cursor","pointer")}CtrlUI.prototype.OnAttached.call(this)},Zoom:function(a){}});QuizUI.Type={MULTI_CHOICE:1,MULTI_RESPONSE:2,TRUE_FALSE:3,SINGLELINE_TEXT:4,MULTI_SINGLELINE_TEXT:5,MULTILINE_TEXT:6,DROPDOWN:8,MULTI_DROPDOWN:9,SEQUENCE_DRAGDROP:10};function QuizUI(a,n){function e(q,r){var p=CtrlKind.ANSWER,j=undefined;switch(q.type){case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:p=CtrlKind.TEXTINPUT;break;case QuizUI.Type.DROPDOWN:p=CtrlKind.COMBO;break;case QuizUI.Type.SEQUENCE_DRAGDROP:p=CtrlKind.NOTE;j=NoteType.ANSWER;break}return(r.kind==p)&&(j===undefined||r.type==j)}CtrlUI.call(this,a,n);this.html='<div id="'+this.id+'" class="comctrl">';this.ansUIs=[];var d=this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP&&!this.ctrl.ansPos;var h=[];var c,f=this.ctrl.ctrls,b=f.length,l;for(l=0;l<b;++l){c=n.CreateControl(f[l],this);if(c){if(e(this.ctrl,c.ctrl)){this.ansUIs.push(c);if(d){h.push({top:c.ctrl.rect.t,left:c.ctrl.rect.l})}}this.html+=c.GetHTML()}}if(d){h.sort(function(p,j){return(p.top-j.top)||(p.left-j.left)});this.ctrl.ansPos=h;b=this.ansUIs.length;var m=RandomPermutation(b),g,a;for(l=0;l<b;++l){a=this.ansUIs[l].ctrl;a.curOrder=m[l];for(g=0;g<b;++g){if(h[g].top==a.rect.t&&h[g].left==a.rect.l){a.correctOrder=g;break}}}}var k,o;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){for(l=0,b=this.ansUIs.length;l<b;++l){c=this.ansUIs[l];c.curOrder=c.ctrl.curOrder;k=c.ctrl.rect;o=this.ctrl.ansPos[c.curOrder];k.t=o.top;k.l=o.left}}this.html+="</div>"}$.extend(QuizUI.prototype,CtrlUI.prototype,{constructor:QuizUI,GetHTML:function(){return this.html},GetIniProps:function(){return{left:0,top:0}},OnAttached:function(){var g=this;if(this.ctrl.type==QuizUI.Type.SEQUENCE_DRAGDROP){var a={cursor:"default",zIndex:ZIndexBase.Dragging,start:function(h,k){g.draggingUI=g.slideUI.GetCtrlUI(this.id,false);if(!g.draggingUI||!g.draggingUI.IsEnabled()){g.draggingUI=null;return false}if(g.draggingUI){var j='<div class="ctrl" id="ctrl_placeholder" style="'+CtrlUI.GenCSSRect(g.draggingUI.ctrl.rect,ZoomUI.Scale*Prez.Scale)+'"></div>';g.draggingUI.holder=$(j).appendTo(g.slideUI.GetDOM())}},stop:function(h,j){if(g.draggingUI){var k=g.ctrl.ansPos[g.draggingUI.curOrder];j.helper.animate({top:k.top*ZoomUI.Scale*Prez.Scale,left:k.left*ZoomUI.Scale*Prez.Scale},200,function(){g.draggingUI.holder.remove();delete g.draggingUI.holder;g.draggingUI=null})}},drag:function(h,r){if(!g.draggingUI){return}var o=r.position.left+h.pageX-r.offset.left,l=r.position.top+h.pageY-r.offset.top,m=ZoomUI.Scale*Prez.Scale,q,k;for(q=0,k=g.ansUIs.length;q<k;++q){var j=g.ansUIs[q];if(j==g.draggingUI){continue}var p=j.ctrl.rect;if(IsInside(p.t*m,p.l*m,p.w*m,p.h*m,o,l)){g.draggingUI.holder.css({top:p.t*m,left:p.l*m});g.SortAnswers(g.draggingUI,j);break}}}};if(!$.browser.msie||(parseInt($.browser.version)>=9)){a.opacity=0.8}var d=ZoomUI.Scale*Prez.Scale;for(var b=0,f=this.ansUIs.length;b<f;++b){var c=this.ansUIs[b];var e=this.ctrl.ansPos[c.ctrl.curOrder];c.GetDOM().append('<div id="'+c.id+'_inp" class="evtreceiver"></div>').css({top:e.top*d,left:e.left*d}).bind("mousedown",function(h){h.stopPropagation()}).draggable(a)}}CtrlUI.prototype.OnAttached.call(this)},Zoom:function(c){if(this.draggingUI&&this.draggingUI.holder){var a=this.draggingUI.ctrl.rect;var b={top:a.t*c,left:a.l*c,width:a.w*c,height:a.h*c};this.draggingUI.holder.css(b)}},Submit:function(){if(!this.IsEnabled()){return}var q=this.GetSubmitedDataObject();if(!q.v){q.v={}}var k=!(this.ctrl.evt.mod&EvtMode.SURVEY);var n=(k&&((this.ctrl.evt.mod&EvtMode.PARTIAL_SCORE)==EvtMode.PARTIAL_SCORE)),c=(k&&((this.ctrl.evt.mod&EvtMode.PARTIAL_ACTION)==EvtMode.PARTIAL_ACTION)),l=0,d=[],b=false,a,m;var p=0;var h=0,o=this.ansUIs.length;if(!k){m=Judge.NEUTRAL}else{m=Judge.CORRECT}switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:c=false;case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(h=0;h<o;++h){a=this.ansUIs[h].actUI;if(k){if(a.IsChecked()){++l;if(!a.ctrl.checked){m=Judge.WRONG}if(a.evtMan){if(n){p+=a.evtMan.GetPoints(EvtType.CHECK)}if(c){d=a.evtMan.GetActions(EvtType.CHECK)}}}else{if(a.ctrl.checked&&m!=Judge.WRONG){m=Judge.PARTIAL_CORRECT}}}else{if(a.IsChecked()){++l}}q.v[a.ctrl.id]=a.IsChecked()}if(l==0){d=this.evtMan.GetActions(EvtType.INCOMPLETE);if(d.length){m=Judge.INCOMPLETE;b=true}else{if(k){m=Judge.WRONG}else{m=Judge.NEUTRAL}}}else{if(k){if(m==Judge.CORRECT){if(!n){p=this.ctrl.evt.pt}}else{if(this.ctrl.type==QuizUI.Type.MULTI_RESPONSE&&m==Judge.WRONG){p=0;
d.length=0}m=Judge.WRONG}}else{m=Judge.NEUTRAL;p=0}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(h=0;h<o;++h){a=this.ansUIs[h];a.ctrl.curOrder=a.curOrder;if(m==Judge.CORRECT){if(a.curOrder!=a.ctrl.correctOrder){m=Judge.WRONG}}q.v[a.ctrl.id]=a.curOrder}if(m==Judge.CORRECT){p=this.ctrl.evt.pt}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:a=this.ansUIs[0];if(a&&a.ctrl.kind==CtrlKind.TEXTINPUT){var g=a.evtMan.GetResponse(EvtType.TEXT,a.GetValue(),a.IsCaseSensitive(),this.evtMan,true);m=g.jud;p=g.pt;d=g.acts;b=true;q.v[a.ctrl.id]=a.GetValue()}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:var f=false,g;for(h=0;h<o;++h){a=this.ansUIs[h].actUI;g=a.evtMan.GetResponse(EvtType.TEXT,a.GetValue(),a.IsCaseSensitive(),this.evtMan,false);if(g.jud==Judge.INCOMPLETE){m=Judge.INCOMPLETE;break}else{if(g.jud==Judge.WRONG){f=true}else{if(g.jud==Judge.CORRECT){p+=g.pt}}}q.v[a.ctrl.id]=a.GetValue()}if(m==Judge.INCOMPLETE){p=0}else{if(k){if(f){m=Judge.WRONG}if(!n){p=m==Judge.WRONG?0:this.ctrl.evt.pt}}else{p=0}}break}if(!b){switch(m){case Judge.INCOMPLETE:d=this.evtMan.GetActions(EvtType.INCOMPLETE);break;case Judge.NEUTRAL:d=this.evtMan.GetActions(EvtType.COMPLETE);break;case Judge.CORRECT:d=d.concat(this.evtMan.GetActions(EvtType.CORRECT));break;case Judge.WRONG:d=d.concat(this.evtMan.GetActions(EvtType.WRONG));break}}if(m!=Judge.INCOMPLETE){++this.evtMan.curAtp;if(this.evtMan.IsLastAttempt()){this.doingLastAttempt=true}}q.a=this.evtMan.curAtp;q.p=p;q.j=m;if(bSendToLMS){try{scormStoreQuizInteractionData(this,m,p)}catch(j){if(!bSuppressSCORMException){alert(j.toString())}}}EvtMan.DoActions(d,this)},ClearUserInput:function(a){if(this.showState==CtrlShowState.HIDE||(a&&!this.IsEnabled())){return}var b=0,c=this.ansUIs.length,e=ZoomUI.Scale*Prez.Scale,d,f;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(b=0;b<c;++b){this.ansUIs[b].actUI.Check(false)}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(b=0;b<c;++b){d=this.ansUIs[b];d.curOrder=d.ctrl.curOrder;f=this.ctrl.ansPos[d.curOrder];d.GetDOM().css({top:f.top*e,left:f.left*e});d.ctrl.rect.t=f.top;d.ctrl.rect.l=f.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:d=this.ansUIs[0];if(d&&d.SetValue){d.SetValue("")}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(b=0;b<c;++b){d=this.ansUIs[b].actUI;if(d&&d.SetValue){d.SetValue("")}}break}},RadioChecked:function(c){for(var a=0,d=this.ansUIs.length;a<d;++a){var b=this.ansUIs[a].actUI;if(b!=c&&b.IsChecked&&b.IsChecked()){b.Check(false)}}},SortAnswers:function(b,h){var a,d,j,k,g,c=this.ansUIs.length,l=b.curOrder,f=h.curOrder,e=ZoomUI.Scale*Prez.Scale;for(g=0;g<c;++g){a=this.ansUIs[g];if(a==b){b.curOrder=f;j=this.ctrl.ansPos[f];k=a.ctrl.rect;k.t=j.top;k.l=j.left;continue}d=a.curOrder;if(d>l){--d}if(d>=f){++d}if(d!=a.curOrder){a.curOrder=d;j=this.ctrl.ansPos[d];k=a.ctrl.rect;a.GetDOM().css({top:j.top*e,left:j.left*e});k.t=j.top;k.l=j.left}}},LoadSubmitedData:function(d){var a=d[this.ctrl.id];if(!a){return}if(a.a){this.evtMan.curAtp=a.a}if(!a.v){return}var c,f,h;var b=0,e=this.ansUIs.length,g=ZoomUI.Scale*Prez.Scale;switch(this.ctrl.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.TRUE_FALSE:case QuizUI.Type.MULTI_CHOICE:for(b=0;b<e;++b){c=this.ansUIs[b].actUI;f=a.v[c.ctrl.id];if(f!=undefined){c.Check(f)}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:for(b=0;b<e;++b){c=this.ansUIs[b];c.curOrder=a.v[c.ctrl.id];c.ctrl.curOrder=c.curOrder;h=this.ctrl.ansPos[c.curOrder];c.GetDOM().css({top:h.top*g,left:h.left*g});c.ctrl.rect.t=h.top;c.ctrl.rect.l=h.left}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:c=this.ansUIs[0];if(c&&c.ctrl.kind==CtrlKind.TEXTINPUT){f=a.v[c.ctrl.id];if(f!=undefined){c.SetValue(f)}}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(b=0;b<e;++b){c=this.ansUIs[b].actUI;f=a.v[c.ctrl.id];if(f!=undefined){c.SetValue(f)}}break}}});ToggleUI.State={COUNT:3,CHECKED:1,HOVERED:2,DISABLED:4,PUSHED:8};function ToggleUI(b,a){CtrlUI.call(this,b,a);this.bgId=this.id+"_bg";this.inputId=this.id+"_inp";this.curState=0}$.extend(ToggleUI.prototype,CtrlUI.prototype,{constructor:ToggleUI,GetHTML:function(){var b,a="";if(this.ctrl.acctext){a=this.ctrl.acctext}if(UI.IEBLOW){b='<img id="'+this.bgId+'" class="togglebgimg" src="'+UI.BlankImgUrl()+'" alt="'+a+'" role="presentation" width="200%" height="300%" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src=\''+this.GetImg()+"');\" />"}else{b='<img id="'+this.bgId+'" class="togglebgimg" src="'+this.GetImg()+'" alt="'+a+'" role="presentation" width="200%" height="300%" />'}return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(this.ctrl.rect,Prez.Scale)+'">'+b+'<div id="'+this.inputId+'" class="evtreceiver"></div></div>'},OnAttached:function(){this.UpdateBGPos();var a=this;$("#"+this.inputId).click(function(b){a.Click();return false}).hover(function(){a.Hover(true)},function(){a.Hover(false)}).bind("mousedown mouseup",function(b){b.stopPropagation()}).css("cursor","pointer");CtrlUI.prototype.OnAttached.call(this)},IsEnabled:function(a){if(this.curState&ToggleUI.State.DISABLED){return false}return CtrlUI.prototype.IsEnabled.call(this,a)},GetImg:function(){return Prez.GetResource(this.ctrl.image,"png")},Check:function(a){if(a){this.curState|=ToggleUI.State.CHECKED}else{this.curState&=~ToggleUI.State.CHECKED}this.UpdateBGPos()},IsChecked:function(){return(this.curState&ToggleUI.State.CHECKED)},Click:function(){if(!this.IsEnabled()){return}if(!this.ctrl.radio){this.curState^=ToggleUI.State.CHECKED;this.UpdateBGPos()}else{if((this.curState&ToggleUI.State.CHECKED)==0){this.curState|=ToggleUI.State.CHECKED;this.UpdateBGPos();var a=this.GetTopLevel();if(a.RadioChecked){a.RadioChecked(this)}}}},Hover:function(a){if(!this.IsEnabled()){return}if(a){this.curState|=ToggleUI.State.HOVERED}else{this.curState&=~ToggleUI.State.HOVERED}this.UpdateBGPos()},UpdateBGPos:function(){var a=0,b=0;if(!(this.curState&ToggleUI.State.CHECKED)){a=-100}if(this.curState&ToggleUI.State.DISABLED){b=2}else{if(this.curState&ToggleUI.State.PUSHED){b=3}else{if(this.curState&ToggleUI.State.HOVERED){b=1}}}if(b>ToggleUI.State.COUNT-1){b=0}if(b!=0){b*=-100}$("#"+this.bgId).css({top:b+"%",left:a+"%"})},CleanUp:function(){var a=$("#"+this.inputId);if(this.showState!=CtrlShowState.HIDE){a.removeClass("evtreceiver")}a.unbind();CtrlUI.prototype.CleanUp.call(this)}});function FeedbackUI(b,a){CtrlUI.call(this,b,a);this.keyH=b.rect.h;this.keySpacing=Math.floor(this.keyH/6);this.mouseW=Math.floor((this.keyH-1)*2/3)+1;this.LMBgPos=-(6*this.keyH+2);this.RMBgPos=-(-this.LMBgPos+this.mouseW+2);this.minTextW=this.keyH-2*b.tr.l;if(this.minTextW<0){this.minTextW=0}this.prevModifiers=0}$.extend(FeedbackUI.prototype,CtrlUI.prototype,{constructor:FeedbackUI,GetHTML:function(){var a='<div id="'+this.id+'" class="feedbackctrl" style="top:'+(this.ctrl.rect.t*Prez.Scale)+"px;left:"+(this.ctrl.rect.l*Prez.Scale)+'px;">'+this._GetKeyHTML(this.id+"_c","Ctrl")+this._GetKeyHTML(this.id+"_s","Shift")+this._GetKeyHTML(this.id+"_a","Alt")+this._GetKeyHTML(this.id+"_k","A")+this._GetMouseHTML(this.id+"_m")+"</div>";return a},_GetKeyHTML:function(d,c){var a=" url('"+this.GetImg()+"') no-repeat;";var b='<div id="'+d+'" class="ctrl" style="width:'+this.keyH+"px;height:"+this.keyH+'px;top:0px;left:0px;"><div id="'+d+'_l" style="background:'+a+"width:"+this.keyH+'px;height:100%;"></div><div id="'+d+'_r" style="background:top right'+a+'position:absolute;top:0;left:0;width:100%; height:100%;"><div id="'+d+'_text" style="position:absolute;white-space:nowrap;top:'+this.ctrl.tr.t+"px;margin:0px "+this.ctrl.tr.l+"px;"+this.ctrl.css+'">'+c+"</div></div></div>";return b},_GetMouseHTML:function(b){var a='<div id="'+b+'" class="ctrl" style="width:'+this.mouseW+"px;height:"+this.keyH+"px;top:0px;left:0px;background:"+this.LMBgPos+"px 0px url('"+this.GetImg()+"') no-repeat;\"></div>";return a},_SetKey:function(d,c){var a=this.keyH,b=this._GetTextWidth(c);
if(b>this.minTextW){a+=(b-this.minTextW)}$("#"+d).width(a);$("#"+d+"_l").width(a-Math.floor(this.keyH/2)+3);$("#"+d+"_text").text(c).width(a-2*this.ctrl.tr.l)},_GetTextWidth:function(c){var a=$('<span style="position:absolute;top:-1000px;left:-1000px;'+this.ctrl.css+'"></span>');var b=a.text(c).appendTo(UI.ViewPort()).width();a.remove();return b},OnAttached:function(){this._SetKey(this.id+"_c","Ctrl");this._SetKey(this.id+"_s","Shift");this._SetKey(this.id+"_a","Alt");CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);var b=this;$(document).bind("feedback."+this.id,function(d,c){b.SetValue(c)})},_OnHideComplete:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(e){var c=$("#"+this.id)[0];if(!c){return}var d=$(ZoomUI.GetElement()).position();var a=c.style,b=this.ctrl.rect;a.top=(b.t*Prez.Scale-d.top)+"px";a.left=(b.l*Prez.Scale-d.left)+"px"},CleanUp:function(){$(document).unbind("feedback."+this.id);CtrlUI.prototype.CleanUp.call(this)},SetValue:function(c){$(this).stopTime("hidekeys");var f=0,b=0;if(c.ctrlKey){f+=$("#"+this.id+"_c").show().width()+this.keySpacing;b|=Key.MOD_CTRL}else{$("#"+this.id+"_c").hide()}if(c.shiftKey){f+=$("#"+this.id+"_s").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_SHIFT}else{$("#"+this.id+"_s").hide()}if(c.altKey){f+=$("#"+this.id+"_a").css("left",f+"px").show().width()+this.keySpacing;b|=Key.MOD_ALT}else{$("#"+this.id+"_a").hide()}var d=b!=this.prevModifiers;this.prevModifiers=b;var a=c.apWhich;switch(a){case Key.CTRL:case Key.SHIFT:case Key.ALT:$("#"+this.id+"_k").hide();if(d){$("#"+this.id+"_m").hide()}break;case Mouse.Buttons.LEFT:case Mouse.Buttons.DBLEFT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.LMBgPos+"px 0px"}).show();break;case Mouse.Buttons.RIGHT:case Mouse.Buttons.DBRIGHT:$("#"+this.id+"_k").hide();f+=this.keySpacing;$("#"+this.id+"_m").css({left:f+"px","background-position":this.RMBgPos+"px 0px"}).show();break;default:var e;if((Key.NUMBER0<=a&&a<=Key.NUMBER9)||(Key.A<=a&&a<=Key.Z)){e=String.fromCharCode(a)}else{if(Key.NUMPAD0<=a&&a<=Key.NUMPAD9){e="Numpad "+(a-Key.NUMPAD0)}else{if(Key.F1<=a&&a<=Key.F12){e="F"+(a-Key.F1+1)}else{e=KeyNames[a];if(e===undefined){e="Unrecognized"}}}}$("#"+this.id+"_m").hide();this._SetKey(this.id+"_k",e);$("#"+this.id+"_k").css("left",f+"px").show();break}$(this).oneTime(1000,"hidekeys",function(){$("#"+this.id+"_c").hide();$("#"+this.id+"_s").hide();$("#"+this.id+"_a").hide();$("#"+this.id+"_k").hide();$("#"+this.id+"_m").hide();this.prevModifiers=0})}});function GetMediaAltHTML(){return""}function MediaUI(e,a){CtrlUI.call(this,e,a);if(e.kind==CtrlKind.AUDIO){e.rect={t:0,l:0,w:1,h:1};if(e.audio>0){this.resUrl="data/res_"+e.audio+"."+MediaManager.strAudioExt}this.playerId=a.GetAudioPlayerId()}else{if(e.video>0){this.resUrl="data/res_"+e.video+"."+MediaManager.strVideoExt}this.playerId=a.GetVideoPlayerId();a.lastDOMId=this.playerId}this.id=this.playerId;$("#"+this.id).attr("style",CtrlUI.GenCSSRect(this.ctrl.rect,this.ctrl.kind==CtrlKind.AUDIO?1:Prez.Scale));if(e.kind==CtrlKind.VIDEO){this.vStartFrameId=this.id+"_vstart_frame";this.vEndFrameId=this.id+"_vend_frame";var b="";if(this.ctrl.acctext){b=this.ctrl.acctext}var d="data/vstart_img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".jpg";var c="data/vend_img_"+this.slideUI.slide.idx+"."+this.ctrl.id+".jpg";$("#"+this.vStartFrameId).attr("alt",b).attr("src",d).show();$("#"+this.vEndFrameId).attr("alt",b).attr("src",c).show();this.firstFrameHidden=false}this.player=null;this.bIncBuffCount=false;this.waitForTimeUpdate=false;this.resumeTokenAccepted=false;this.mediaSeeked=true}$.extend(MediaUI.prototype,CtrlUI.prototype,{constructor:MediaUI,GetHTML:function(){return""},InitMediaPlayer:function(){var a={width:this.ctrl.rect.w,height:this.ctrl.rect.h,file:this.resUrl,repeat:(this.ctrl.flags&CtrlFlags.LOOP)?"true":"false",mode:"audio"};if(this.ctrl.kind==CtrlKind.VIDEO){a.width*=Prez.Scale;a.height*=Prez.Scale;a.displayheight=a.height;a.mode="video";a.v_w=this.ctrl.v_w;a.v_h=this.ctrl.v_h}var b={context:this,ready:function(){this._OnPlayerReady()},end:function(){this._OnPlayerEnded()},statechanged:function(){this._OnPlayerStateChanged()},timeupdated:function(c){this._OnPlayerTimeUpdated(c)}};$("#"+this.playerId).show();this.player=MediaManager.CreatePlayer(a,this.playerId,b)},Attach:function(a){if(this.ctrl.kind!=CtrlKind.AUDIO){if(a.lastDOMId===undefined){$("#"+a.id).prepend(this.GetHTML())}else{$("#"+a.lastDOMId).after(this.GetHTML())}a.lastDOMId=this.id}},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this)},_OnShowStart:function(d){CtrlUI.prototype._OnShowStart.call(this,d);if(!this.player){this.InitMediaPlayer()}if(!this.player){return}this.mediaSeeked=true;this.waitForTimeUpdate=false;var c=this.player.GetState();Log(this.id+": _OnShowStart Player State 1: "+c);if(c==MediaStates.BUFFERING||c==MediaStates.PAUSED||c==MediaStates.PLAYING||c==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.player.Play(false,a)}c=this.player.GetState();Log(this.id+": _OnShowStart Player State 2: "+c);if(c==MediaStates.NOT_READY||c==MediaStates.OPENING||c==MediaStates.BUFFERING||c==MediaStates.CLOSED){this.playingPaused=true;this._IncBufCount()}else{if(c!=MediaStates.ERROR){var b=Prez.GetState();if(b==States.PAUSED||b==States.BUFFERING||(b==States.WAITING&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT))){this.player.Play(false);this.playingPaused=true}else{if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){this._IncBufCount();this.player.Play(true);this.playingPaused=false;this.waitForTimeUpdate=true;this.mediaSeeked=false}else{this.player.Play(true);this.playingPaused=false}}}}},_OnHideComplete:function(){if(this.player){var a=this.player.GetState();if(a==MediaStates.BUFFERING||a==MediaStates.PAUSED||a==MediaStates.PLAYING||a==MediaStates.STOPPED){this.player.Play(false)}this.player.SetPlayerReady(false)}CtrlUI.prototype._OnHideComplete.call(this)},Tick:function(){if(this.ctrl.startTime<0){return}var b={},a=this.slideUI.ts;switch(this.showState){case CtrlShowState.SHOW:this.GetShowState(a,b);if(b.value==CtrlShowState.HIDE&&!this.ended){this.hideWhenComplete=true;break}if(b.value!=this.showState){this.Show(b)}break;case CtrlShowState.HIDE:if(!this.ended){this.GetShowState(a,b);if(b.value!=this.showState){this.Show(b)}}break}},Update:function(){if(this.player){this.player.Play(false)}this.playingPaused=false;this.ended=false;this.hideWhenComplete=false;if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).show()}CtrlUI.prototype.Update.call(this)},UpdatePrezStateChanged:function(){var a=Prez.GetState();if(a==States.PAUSED||a==States.BUFFERING||(a==States.WAITING&&!(this.ctrl.flags&CtrlFlags.NOT_WAIT))){if(this.player&&this.showState!=CtrlShowState.HIDE){var b=this.player.GetState();if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.BUFFERING){this.player.Play(false)}else{Log(this.id+": Pause a non ready player, state: "+b)}}this.playingPaused=true}if(a==States.RUNNING||(a==States.WAITING&&(this.ctrl.flags&CtrlFlags.NOT_WAIT))){if(this.playingPaused&&this.player&&this.showState!=CtrlShowState.HIDE){var b=this.player.GetState();if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){this.player.Play(true)}else{Log(this.id+": Resume a non ready player, state: "+b)}}this.playingPaused=false}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},Zoom:function(a){if(this.ctrl.kind!=CtrlKind.AUDIO){CtrlUI.prototype.Zoom.call(this,a)}},CleanUp:function(){if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).hide();$(this).stopTime("hide_vstart_frame")}if(this.player){this.player.CleanUp();this.player=null}CtrlUI.prototype.CleanUp.call(this)},Mute:function(a){if(a===undefined){a=true}this.SetVolume(a?0:Prez.GetVolume())},SetVolume:function(a){if(this.player){this.player.SetVolume(a)
}},AcceptResumeToken:function(){if(!this.player){return false}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying&&this.mediaSeeked){this.playingPaused=false;this.resumeTokenAccepted=true;this.mediaSeeked=false;this.player.Play(true);return true}return false},_OnPlayerReady:function(){if(this.player){this.player.SetVolume(Prez.GetVolume(true));if(this.showState==CtrlShowState.HIDE){return}this.mediaSeeked=true;this.waitForTimeUpdate=false;var b=this.player.GetState();Log(this.id+": _OnPlayerReady Player State 1: "+b);if(b==MediaStates.BUFFERING||b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.STOPPED){var a=this.IsTriggeredByEvent()?0:this._GetTimeStamp()/1000;if(a<0.5){a=0}this.player.Play(false,a)}b=this.player.GetState();Log(this.id+": _OnPlayerReady Player State 2: "+b);if(b==MediaStates.NOT_READY||b==MediaStates.OPENING||b==MediaStates.BUFFERING||b==MediaStates.CLOSED){this._IncBufCount()}else{this._DecBufCount()}}},_OnPlayerEnded:function(){if(this.ctrl.kind==CtrlKind.VIDEO){$("#"+MediaManager.GetPlayerId(this.id,false)).hide()}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){this._OnPlayerTimeUpdated(1)}if(this.player&&this.player.IsReady()){if(!(this.ctrl.flags&CtrlFlags.LOOP)){if(this.hideWhenComplete){this.Hide(false)}this.ended=true}}},_OnPlayerStateChanged:function(){if(this.showState==CtrlShowState.HIDE||!this.player){return}var b=this.player.GetState();if(!this.firstFrameHidden&&MediaManager.ePlayerType!=MediaPlayerTypes.HTML5&&this.ctrl.kind==CtrlKind.VIDEO&&b==MediaStates.PLAYING){this.firstFrameHidden=true;var a=this;$(this).stopTime("hide_vstart_frame");$(this).oneTime(200,"hide_vstart_frame",function(){$("#"+a.vStartFrameId).hide()})}if(!this.bIncBuffCount){if(b==MediaStates.OPENING||b==MediaStates.BUFFERING){this._IncBufCount()}}else{if(b==MediaStates.PAUSED||b==MediaStates.PLAYING||b==MediaStates.ERROR||b==MediaStates.STOPPED){this._DecBufCount()}}},_OnPlayerTimeUpdated:function(a){if(!this.firstFrameHidden&&MediaManager.ePlayerType==MediaPlayerTypes.HTML5&&this.ctrl.kind==CtrlKind.VIDEO&&a>0){this.firstFrameHidden=true;$("#"+this.vStartFrameId).hide()}if(this.ctrl.kind==CtrlKind.VIDEO&&BrowserInfo.fixDelayedPlaying){if(a>0){if(this.waitForTimeUpdate){this.waitForTimeUpdate=false;this._DecBufCount()}if(this.resumeTokenAccepted){this.resumeTokenAccepted=false;Prez.Resume()}}}},_GetTimeStamp:function(){var a=0;if(this.ctrl.startTime>=0){a=this.slideUI.ts-this.ctrl.startTime}if(this.ctrl.flags&CtrlFlags.LOOP){var b=this.ctrl.duration;if(b>0){while(a>=b){a-=b}}}if(a<0){a=0}return a}});CursorUI.State={START:1,MOVING:2,STOP:3};CursorUI.Interval=20;function CursorUI(b,a){CtrlUI.call(this,b,a);this.bgId=this.id+"_bg";this.curIdx=0;if(!b.rect){if(b.cursors[0]){b.rect=b.cursors[0].rect}else{b.rect={t:0,l:0,w:0,h:0}}}this.curCursor=null;this.nextCursor=null;this.cursorTs=0;this.state=CursorUI.State.START;this.timerAnimate=undefined;this.animatePaused=false;this.element=null;this.prevAnimTime=0;this.clicked=false}$.extend(CursorUI.prototype,CtrlUI.prototype,{constructor:CursorUI,GetHTML:function(){var a=this.ctrl.cursors[this.curIdx];if(a){return'<div id="'+this.id+'" class="ctrl" style="'+CtrlUI.GenCSSRect(a.rect,Prez.Scale)+'"><img id="'+this.bgId+'" class="bgimg" src="data/'+a.img+'" alt="'+Lang.Cursor+'" width="100%" height="100%" /></div>'}else{return'<div id="'+this.id+'" class="ctrl" style="width:1px;height:1px;"><img id="'+this.bgId+'" class="bgimg" src="'+UI.BlankImgUrl()+'" alt="'+Lang.Cursor+'" width="100%" height="100%" /></div>'}},GetIniProps:function(){return{}},OnAttached:function(){CtrlUI.prototype.OnAttached.call(this);this.element=$("#"+this.id)[0]},IsTriggeredByEvent:function(){return false},_OnShowStart:function(a){CtrlUI.prototype._OnShowStart.call(this,a);if(Prez.GetState()==States.RUNNING){this._StartAnimate()}else{this.animatePaused=true}},_OnHideComplete:function(){this._StopAnimate();CtrlUI.prototype._OnHideComplete.call(this)},Zoom:function(c){if(this.curCursor&&this.element){var a=this.element.style,b=this.curCursor.rect;if(this.state!=CursorUI.State.MOVING){a.top=(c*b.t)+"px";a.left=(c*b.l)+"px"}a.width=(c*b.w)+"px";a.height=(c*b.h)+"px"}},UpdatePrezStateChanged:function(){var a=Prez.GetState();if(a==States.PAUSED||a==States.BUFFERING||a==States.WAITING){if(this.timerAnimate!==undefined){this._StopAnimate();this.animatePaused=true}}if(a==States.RUNNING){if(this.animatePaused){this._StartAnimate();this.animatePaused=false}}CtrlUI.prototype.UpdatePrezStateChanged.call(this)},_StartAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate)}if(!this.element){return}var a=this;this.timerAnimate=window.setInterval(function(){a._OnInterval()},CursorUI.Interval);this.prevAnimTime=(new Date).getTime()},_StopAnimate:function(){if(this.timerAnimate!==undefined){window.clearInterval(this.timerAnimate);this.timerAnimate=undefined}},Update:function(){if(!this.element){return}this.curIdx=-1;this.curCursor=null;this.nextCursor=null;this.clicked=true;this._StopAnimate();var f,a,g,c=this.slideUI.ts,e,d=this.ctrl.cursors;for(a=0,g=d.length;a<g;++a){f=d[a];e=f.start+f.move+f.stop;if(c<=e||f.start<0){this.cursorTs=c;this.curIdx=a;this.curCursor=f;this.nextCursor=d[a+1];this._UpdateShape(true);if(c<=f.start||f.start<0){this.state=CursorUI.State.START;this._UpdatePos(f.rect)}else{if(c<(f.start+f.move)){this.state=CursorUI.State.MOVING;this._Move()}else{this.state=CursorUI.State.STOP;this._UpdatePos(this.nextCursor.rect)}}break}c-=e}this.showState=CtrlShowState.HIDE;if(this.curCursor){this.Show({value:CtrlShowState.SHOW,ts:0,ctrlTs:0});if(Prez.prjSldUI&&!isNaN(this.curCursor.click)){if(this.cursorTs==this.curCursor.click){if(this.curCursor.sound){Prez.prjSldUI.PlayClickSound(this.curCursor.sound)}if(this.curCursor.click_eff){var b=this.curCursor.click_eff;Prez.prjSldUI.PlayClickEffect(this.curCursor.pos.l,this.curCursor.pos.t,b.w,b.h,b.file,b.fr_dur,b.fr_count)}}else{if(this.cursorTs<this.curCursor.click){this.clicked=false}}}}else{this.Hide(false)}},_UpdateShape:function(b){var d=$("#"+this.bgId)[0],c=this.element.style,e=this.ctrl.cursors,g=ZoomUI.Scale*Prez.Scale,a=this.curIdx,f;while(a>=0){f=e[a];if(f.img){c.width=(g*f.rect.w)+"px";c.height=(g*f.rect.h)+"px";if(d){d.src="data/"+f.img}return}if(!b){return}--a}if(d){d.src=UI.BlankImgUrl()}},_UpdatePos:function(a){this.element.style.left=(ZoomUI.Scale*Prez.Scale*a.l)+"px";this.element.style.top=(ZoomUI.Scale*Prez.Scale*a.t)+"px"},Tick:function(){},_OnInterval:function(){if(this.cleaned){return}var d=this.curCursor,a=(new Date).getTime();this.cursorTs+=(a-this.prevAnimTime);this.prevAnimTime=a;var c=this.cursorTs;while(d){if(!isNaN(d.click)&&!this.clicked&&d.click<=c&&Prez.prjSldUI){if(d.sound){Prez.prjSldUI.PlayClickSound(d.sound)}if(d.click_eff){var b=d.click_eff;Prez.prjSldUI.PlayClickEffect(d.pos.l,d.pos.t,b.w,b.h,b.file,b.fr_dur,b.fr_count)}this.clicked=true}if(c<=d.start||d.start<0){this.state=CursorUI.State.START;if(d.start<0&&(this.clicked||(!d.sound&&!d.click_eff))){this._StopAnimate()}return}if(c<d.start+d.move){this.state=CursorUI.State.MOVING;this._Move();return}c-=(d.start+d.move+d.stop);if(c<0){if(this.state!=CursorUI.State.STOP){this.state=CursorUI.State.STOP;if(this.nextCursor){this._UpdatePos(this.nextCursor.rect)}}return}++this.curIdx;this.curCursor=d=this.nextCursor;this.nextCursor=this.ctrl.cursors[this.curIdx+1];this.cursorTs=c;this.state=CursorUI.State.START;this.clicked=false;if(d){this._UpdateShape(false);this._UpdatePos(d.rect)}}this.Hide(false)},_Move:function(){if(this.nextCursor){var a=$.easing.easeInOutQuad((this.cursorTs-this.curCursor.start)/this.curCursor.move,this.cursorTs-this.curCursor.start,0,1,this.curCursor.move);this.element.style.left=(ZoomUI.Scale*Prez.Scale*((1-a)*(1-a)*this.curCursor.pos.l+2*a*(1-a)*this.curCursor.cpos.l+a*a*this.nextCursor.pos.l-this.curCursor.rpos.l))+"px";this.element.style.top=(ZoomUI.Scale*Prez.Scale*((1-a)*(1-a)*this.curCursor.pos.t+2*a*(1-a)*this.curCursor.cpos.t+a*a*this.nextCursor.pos.t-this.curCursor.rpos.t))+"px"
}},CleanUp:function(){this._StopAnimate();CtrlUI.prototype.CleanUp.call(this);this.element=null}});ZoomUI.Scale=1;ZoomUI.GetElement=function(){return UI.$Slides[0]};ZoomUI.Reset=function(){ZoomUI.Scale=1;var b=ZoomUI.GetElement();if(b){var a=b.style;a.top="0px";a.left="0px";a.width="100%";a.height="100%"}};function ZoomUI(b,a){this.slideUI=a;this.element=ZoomUI.GetElement();this.stateTs=0;this.timerAnimate=undefined;this.animatePaused=false;this.activeIndexChanged=true;this.prevAnimTime=0;this.zoomAreas=[];var d,c;for(d=0,c=b.length;d<c;++d){if((b[d].showMode&Prez.Session.PMode)==Prez.Session.PMode){this.zoomAreas.push(b[d])}}this.activeIndex=-1;this.zooming=false;this.startTime=0}ZoomUI.prototype={constructor:ZoomUI,Update:function(){var c=this.slideUI.ts,b=this.zoomAreas;var a=b.length-1;while(a>=0&&b[a].startTime>c){--a}this._SetActiveZoom(a,c)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Tick:function(){if(this.zooming){return}var d=this.slideUI.ts,b=this.zoomAreas;var c=b.length,a=this.activeIndex+1;while(a<c&&b[a].startTime<=d){++a}--a;if(a!=this.activeIndex){this._SetActiveZoom(a,d)}},Step:function(){if(this.pausedTime!==undefined){return true}var b=+new Date;if(b>=this.startTime+this.duration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false;return false}else{var c=(b-this.startTime)/this.duration;var e=$.easing.easeInOutQuad(c,c,0,1,1);var a=this.preX+(this.X-this.preX)*e;var f=this.preY+(this.Y-this.preY)*e;var d=this.preS/(1-(1-this.preS/this.S)*e);this._DoZoom(a,f,d)}return true},_DoZoom:function(a,f,c){ZoomUI.Scale=c;if(this.element){var b=this.element.style;b.top=(-f*c*Prez.Scale)+"px";b.left=(-a*c*Prez.Scale)+"px";b.width=(100*c)+"%";b.height=(100*c)+"%"}c*=Prez.Scale;var d,e;if(Prez.prjSldUI){Prez.prjSldUI.ZoomClickEffect(c);d=Prez.prjSldUI.allCtrlUIs;for(e in d){d[e].Zoom(c)}}d=this.slideUI.allCtrlUIs;for(e in d){d[e].Zoom(c)}},_SetActiveZoom:function(b,a){EffectMan.StopZoom(this);this.activeIndex=b;var d=this.zoomAreas[b-1];if(d){this.preX=d.pos.l;this.preY=d.pos.t;this.preS=d.scale/100}else{this.preX=this.preY=0;this.preS=1}d=this.zoomAreas[b];if(d){this.duration=d.inDuration;this.X=d.pos.l;this.Y=d.pos.t;this.S=d.scale/100;var c=a-d.startTime;if(c>=d.inDuration){this._DoZoom(this.X,this.Y,this.S);this.zooming=false}else{this.startTime=(new Date).getTime()-c;this.zooming=true;if(this.Step()){EffectMan.StartZoom(this)}}}else{this.X=this.Y=0;this.S=1;this._DoZoom(this.X,this.Y,this.S);this.zooming=false}},CleanUp:function(){this.element=null;EffectMan.StopZoom(this);this._DoZoom(0,0,1)}};var ClosedCaptionUI={FSMARGIN:5,MARGIN:5,Init:function(){if(this.inited){return}this.id=UI.IDs.ClosedCaption;this.bgId=this.id+"_bg";this.textId=this.id+"_txt";this.$CCaption=$("#"+this.id);this.$CCaption.css("z-index",ZIndexBase.ClosedCaption);this.show=false;if(TemplateParams.IniCCShow){this.Show(true)}else{this.Show(false)}if(Options.zoom_percent!=100&&this.MARGIN==this.FSMARGIN){this.MARGIN=Math.floor((this.FSMARGIN*Options.zoom_percent)/100)}if(Params.CC.fscss!==undefined){Params.CC.css=Params.CC.fscss;if(Options.zoom_percent!=100){Params.CC.html="";ScaleFont(Params.CC,Options.zoom_percent/100)}delete Params.CC.fscss;delete Params.CC.html}this.$CCaption.empty();this.$CCaption.append('<img id="'+this.bgId+'" class="bgimg" alt="" src="data/'+Params.CC.bgimg+'" />');this.caption="";this.rect={t:0,l:0,w:2*this.MARGIN+1,h:2*this.MARGIN+1};this.$CCaption.append(this._GetCaptionNodeHTML(Prez.Scale));this.$Text=$("#"+this.textId);this.ClearCaption();this.inited=true},IsShown:function(){return this.show},Show:function(a){if(a===undefined){a=true}this.show=a;if(a){this.$CCaption.css("display","block")}else{this.$CCaption.css("display","none")}if(UI.Toolbar){UI.Toolbar.SetCCaption(a)}},ToggleShow:function(){this.Show(!this.show)},SetCaption:function(a,b){this.rect=b;this.caption=a;this.$Text.html(a);this.$Text.css({width:((b.w-2*this.MARGIN)*Prez.Scale)+"px",height:((b.h-2*this.MARGIN)*Prez.Scale)+"px"});this.$CCaption.css({top:(b.t*Prez.Scale)+"px",left:(b.l*Prez.Scale)+"px",width:(b.w*Prez.Scale)+"px",height:(b.h*Prez.Scale)+"px",visibility:"visible"})},ClearCaption:function(){this.$CCaption.css("visibility","hidden")},Zoom:function(){if(!this.inited){return}this.$Text.replaceWith(this._GetCaptionNodeHTML(Prez.Scale));this.$Text=$("#"+this.textId);this.$CCaption.css({top:(this.rect.t*Prez.Scale)+"px",left:(this.rect.l*Prez.Scale)+"px",width:(this.rect.w*Prez.Scale)+"px",height:(this.rect.h*Prez.Scale)+"px"})},_GetCaptionNodeHTML:function(b){var a={css:Params.CC.css,html:this.caption};if(b!=1){ScaleFont(a,b)}return'<div id="'+this.textId+'" style="position:absolute;top:'+(this.MARGIN*b)+"px;left:"+(this.MARGIN*b)+"px;width:"+((this.rect.w-2*this.MARGIN)*b)+"px;height:"+((this.rect.h-2*this.MARGIN)*b)+"px;"+a.css+'">'+a.html+"</div>"}};function SlideCCaptionUI(c,a){this.caption=c;this.slideUI=a;this.nodes=c.nodes;this.curNode=null;this.curIdx=-1;this.curNodeShow=false;if(!c.inited){var b=c.nodes,e=Options.zoom_percent/100,g=(Options.zoom_percent!=100),f,d,h;for(d=0,h=b.length;d<h;++d){f=b[d];if(f.fshtml!==undefined){f.html=f.fshtml;if(g){f.css="";ScaleFont(f,e)}delete f.fshtml;delete f.css}}c.inited=true}}SlideCCaptionUI.prototype={constructor:SlideCCaptionUI,Update:function(){this.curIdx=-1;this.curNode=null;ClosedCaptionUI.ClearCaption();var c,b,d,a=this.slideUI.ts+Prez.INTERVAL;for(b=0,d=this.nodes.length;b<d;++b){c=this.nodes[b];if((c.startTime+c.duration>=a)&&c.duration!=0){this.curIdx=b;this.curNode=c;this._ShowCurrentNode(c.startTime<a);return}}},Tick:function(){if(!this.curNode){return}var b=this.curNode,a=this.slideUI.ts+Prez.INTERVAL;if(this.curNodeShow){if(b.startTime+b.duration<a){do{++this.curIdx;b=this.nodes[this.curIdx]}while(b&&b.duration==0);this.curNode=b;this._ShowCurrentNode(b&&b.startTime<a)}}else{if(this.curNode.startTime<a){this._ShowCurrentNode(true)}}},UpdatePrezStateChanged:function(){},_ShowCurrentNode:function(a){if(a===undefined){a=true}this.curNodeShow=a;if(a&&this.curNode){ClosedCaptionUI.SetCaption(this.curNode.html,this.curNode.rect)}else{ClosedCaptionUI.ClearCaption()}},CleanUp:function(){}};Effect.Type={NONE:0,FADE:1,FLY:2,PEEK:3,WIPE:4};Effect.Dir={NONE:0,BOTTOM:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM_LEFT:5,BOTTOM_RIGHT:6,TOP_LEFT:7,TOP_RIGHT:8};function Effect(){}Effect.prototype={constructor:Effect,Start:function(b,d,a){a=a||{};this.elem=b;this.callback=a.callback;this.secondStream=a.secondStream;if(!d){if(a.callback){window.setTimeout(function(){a.callback.call(b)},1)}return false}if(a.exitEffect){this.starts=d.ends;this.ends=d.starts;this.mStarts=d.mEnds;this.mEnds=d.mStarts}else{this.starts=d.starts;this.ends=d.ends;this.mStarts=d.mStarts;this.mEnds=d.mEnds}this.duration=d.duration;var c=a.startTime;if(isNaN(c)||c<0){c=0}this.startTime=(new Date).getTime()-c;return this.Step(false,true,true)},Pause:function(){if(this.pausedTime===undefined){this.pausedTime=+new Date}},Resume:function(){if(this.pausedTime!==undefined){this.startTime+=(new Date).getTime()-this.pausedTime;this.pausedTime=undefined}},Step:function(e,h,o){if(this.pausedTime!==undefined&&!e){return true}if(!this.elem){return false}var l,a,p,d,m,g={},b=+new Date,c=ZoomUI.Scale*Prez.Scale;if(e||b>=this.duration+this.startTime){m=this.ends;if(m){for(a in m){g[a]=m[a];if((c!=1)&&(a=="left"||a=="top"||a=="width"||a=="height")){g[a]*=c}}}if(g.opacity==1){g.opacity=""}if(this.mEnds){if(UI.IEBrowser){var j=$(this.elem).attr("style");if(j){$(this.elem).attr("style",j.replace(/clip[^;]+;?/gi,""))}$(this.elem).css(g)}else{g.clip="";$(this.elem).css(g)}}else{$(this.elem).css(g)}if(this.callback&&(h||h===undefined)){if(o){var f=this;window.setTimeout(function(){if(f&&f.callback&&f.elem){f.callback.call(f.elem)}},1)}else{this.callback.call(this.elem)}}return false}else{var n=(b-this.startTime)/this.duration;l=$.easing.easeInOutQuad(n,n,0,1,1);
d=this.mStarts;m=this.mEnds;if(d){var k={};for(a in d){p=d[a];k[a]=c*(p+(m[a]-p)*l)}g.clip="rect("+k.t+"px "+(k.l+k.w)+"px "+(k.t+k.h)+"px "+k.l+"px)"}d=this.starts;m=this.ends;if(d){for(a in d){p=d[a];g[a]=p+(m[a]-p)*l;if((c!=1)&&(a=="left"||a=="top"||a=="width"||a=="height")){g[a]*=c}}}$(this.elem).css(g)}return true},CleanUp:function(){this.elem=undefined},_Callback:function(){if(this.callback&&this.elem){this.callback.call(this.elem);this.callback=undefined}}};var EffectMan={INTERVAL:40,effects:[],timerId:undefined,zoomUI:null,StartZoom:function(a){this.zoomUI=a;if(Prez.GetState()!=States.RUNNING){a.Pause()}else{this._CreateTimer()}},StopZoom:function(a){if(this.zoomUI==a){this.zoomUI=null;if(!this.effects.length){this._DeleteTimer()}}},Start:function(b,d,a){var c=new Effect();if(c.Start(b,d,a)){this.effects.push(c);switch(Prez.GetState()){case States.PAUSED:case States.BUFFERING:c.Pause();break;case States.WAITING:if(c.secondStream){this._CreateTimer()}else{c.Pause()}break;default:this._CreateTimer();break}}},Stop:function(c,b,e){if(!e){e=false}var d=this.effects;for(var a=d.length-1;a>=0;--a){if(d[a].elem==c){if(b){d[a].Step(true,e)}d[a].CleanUp();d.splice(a,1)}}if(!d.length&&!this.zoomUI){this._DeleteTimer()}},Reset:function(c,b){var a={opacity:""};if(b.top!==undefined){a.top=b.top*ZoomUI.Scale*Prez.Scale}if(b.left!==undefined){a.left=b.left*ZoomUI.Scale*Prez.Scale}if(UI.IEBrowser){var d=$(c).attr("style");if(d){$(c).attr("style",d.replace(/clip[^;]+;?/gi,""))}$(c).css(a)}else{a.clip="";$(c).css(a)}},UpdatePrezStateChanged:function(){var a=Prez.GetState();if(a==States.PAUSED||a==States.BUFFERING){this.Pause(null)}else{if(a==States.RUNNING){this.Resume()}else{if(a==States.WAITING){this.Pause(null,true);this.Resume(null,true)}}}},Pause:function(c,e){var d=this.effects;var b=0,f=d.length,a=0;if(c){for(b=0;b<f;++b){if(d[b].elem==c){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}}else{if(this.zoomUI){this.zoomUI.Pause();++a}for(b=0;b<f;++b){if(e&&d[b].secondStream){continue}d[b].Pause();++a}}if(this.zoomUI){++f}if(a==f){this._DeleteTimer()}},Resume:function(d,b){var e=this.effects,a=false;var c=0,f=e.length;if(d){for(c=0;c<f;++c){if(e[c].elem==d){if(b&&!e[c].secondStream){continue}e[c].Resume();a=true}}}else{if(this.zoomUI&&!b){this.zoomUI.Resume();a=true}for(c=0;c<f;++c){if(b&&!e[c].secondStream){continue}e[c].Resume();a=true}}if(a){this._CreateTimer()}},CleanUp:function(){if(this.zoomUI){this.zoomUI.CleanUp();this.zoomUI=null}var b=this.effects;for(var a=0,c=b.length;a<c;++a){b[a].CleanUp()}b.length=0;this._DeleteTimer()},InitEffect:function(j,c,d){var g,e,a,f,h,b;switch(j.type){case Effect.Type.FADE:j.starts={opacity:0};j.ends={opacity:1};break;case Effect.Type.FLY:case Effect.Type.PEEK:case Effect.Type.WIPE:if(j.type==Effect.Type.FLY){a=f=0;h=UI.slideW;b=UI.slideH}else{a=c.l;f=c.t;h=a+c.w;b=f+c.h}switch(j.dir){case Effect.Dir.TOP:g=c.l;e=f-c.h;break;case Effect.Dir.BOTTOM:g=c.l;e=b;break;case Effect.Dir.RIGHT:g=h;e=c.t;break;case Effect.Dir.TOP_LEFT:g=a-c.w;e=f-c.h;break;case Effect.Dir.TOP_RIGHT:g=h;e=f-c.h;break;case Effect.Dir.BOTTOM_LEFT:g=a-c.w;e=b;break;case Effect.Dir.BOTTOM_RIGHT:g=h;e=b;break;default:g=a-c.w;e=c.t;break}if(j.type!=Effect.Type.WIPE){if(d){j.ends={left:0,top:0};g-=c.l;e-=c.t}else{j.ends={left:c.l,top:c.t}}j.starts={left:g,top:e};if(j.type==Effect.Type.PEEK){j.mStarts={t:c.t-j.starts.top,l:c.l-j.starts.left,w:c.w,h:c.h};j.mEnds={t:c.t-j.ends.top,l:c.l-j.ends.left,w:c.w,h:c.h}}}else{if(d){j.mStarts={t:e,l:g,w:c.w,h:c.h};j.mEnds={t:c.t,l:c.l,w:c.w,h:c.h}}else{j.mStarts={t:e-c.t,l:g-c.l,w:c.w,h:c.h};j.mEnds={t:0,l:0,w:c.w,h:c.h}}}break}},_Step:function(){if(this.zoomUI&&!this.zoomUI.Step()){this.zoomUI=null}var b=this.effects;for(var a=0;a<b.length;++a){if(!b[a].Step()){b[a].CleanUp();b.splice(a--,1)}}if(!b.length&&!this.zoomUI){this._DeleteTimer()}},_CreateTimer:function(){var a=this;if(!this.timerId){this.timerId=window.setInterval(function(){a._Step()},this.INTERVAL)}},_DeleteTimer:function(){if(this.timerId){window.clearInterval(this.timerId);this.timerId=undefined}}};function InitHandlers(){RemoveHandlers();Key.InitHandlers();Mouse.InitHandlers()}function RemoveHandlers(){Key.RemoveHandlers();Mouse.RemoveHandlers()}var Mouse={CLICK_OUTSIDE:-1,Buttons:{NONE:0,LEFT:1,MIDDLE:2,RIGHT:3,DBLEFT:4,DBRIGHT:5,SCROLLUP:6,SCROLLDOWN:7},DClickDelay:400,clkTimer:undefined,target:null,targetCtrlUI:null,time:undefined,value:undefined,fromTouchEvent:false,_handledTouchEvents:"touchstart pointerdown MSPointerDown",Norm:function(b,a){b.apWhich=b.which;if(a){switch(b.apWhich){case this.Buttons.LEFT:b.apWhich=this.Buttons.DBLEFT;break}}},InitHandlers:function(){Mouse.fromTouchEvent=(BrowserInfo.iDevice||BrowserInfo.android);$(document).bind(Mouse._handledTouchEvents,function(b){var a=b.originalEvent||b;if(a.pointerType!="mouse"&&a.pointerType!=4){Mouse.fromTouchEvent=true;$(document).unbind(Mouse._handledTouchEvents)}else{Mouse.fromTouchEvent=false}});$(document).bind("mousedown",Mouse.OnMouseDown);$(document).bind("mouseup",Mouse.OnMouseUp);$(document).bind("contextmenu",EvtMan.StopEvent)},RemoveHandlers:function(){this.CleanUp();this.fromTouchEvent=false;$(document).unbind(Mouse._handledTouchEvents);$(document).unbind("mousedown",Mouse.OnMouseDown);$(document).unbind("mouseup",Mouse.OnMouseUp);$(document).unbind("contextmenu",EvtMan.StopEvent)},ClickOnSlide:function(a){var b=a.target.id;return b.substr(0,4)=="sld_"||b.substr(0,5)=="ctrl_"||b.substr(0,6)=="appwmk"||b.substr(0,UI.IDs.ClosedCaption.length)==UI.IDs.ClosedCaption},OnMouseDown:function(a){a.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.Session.state==States.PAUSED||Prez.Session.state==States.BUFFERING||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(a)}if(!Mouse.ClickOnSlide(a)){return}Mouse.Norm(a,false);$(document).trigger("feedback",[a]);if(Mouse.clkTimer===undefined){Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}else{if(a.target!=Mouse.target){Mouse._Submit();Mouse.target=a.target;Mouse.targetCtrlUI=null;Mouse.time=a.timeStamp}}return EvtMan.StopEvent(a)},OnMouseUp:function(c){c.timeStamp=(new Date()).getTime();if((Prez.Session.PMode&PlayModes.DEMO)||Prez.Session.state==States.PAUSED||Prez.Session.state==States.BUFFERING||!Prez.slideUI){Mouse.CleanUp();return EvtMan.StopEvent(c)}if(!Mouse.target){return EvtMan.StopEvent(c)}if(c.target!=Mouse.target){if(Mouse.clkTimer===undefined){Mouse.target={};Mouse.targetCtrlUI=null;Mouse._Submit()}}else{if(Mouse.clkTimer!==undefined){if(Mouse.targetCtrlUI){Mouse.Norm(c,true);Mouse.value=InputUI.GetEvtValue(c)}Mouse._Submit()}else{Mouse.targetCtrlUI=null;var e=Prez.slideUI.inputUIs,a;var b=e.length;while(b>0){--b;a=e[b].id;if(c.target.id.substr(0,a.length)==a){Mouse.targetCtrlUI=e[b];Mouse.Norm(c,false);Mouse.value=InputUI.GetEvtValue(c);break}}var d=c.timeStamp-Mouse.time;if(d>=Mouse.DClickDelay){Mouse._Submit()}else{Mouse.clkTimer=window.setTimeout(function(){Mouse._Submit()},Mouse.DClickDelay-d)}}}return EvtMan.StopEvent(c)},CleanUp:function(){window.clearTimeout(this.clkTimer);this.target=this.targetCtrlUI=null;this.clkTimer=this.time=this.value=undefined},_Submit:function(){if(this.target){if(this.targetCtrlUI){this.targetCtrlUI.Submit(EvtType.CLICK,this.value)}else{var b=Prez.slideUI.inputUIs;for(var a=0,c=b.length;a<c;++a){b[a].Submit(EvtType.CLICK,this.CLICK_OUTSIDE)}}}this.CleanUp()}};var KeyNames={"2":"Middle Click","8":"Backspace","9":"Tab","12":"Clear","13":"Enter","19":"Pause/Break","20":"Caps Lock","27":"Esc","32":"Space","33":"Page Up","34":"Page Down","35":"End","36":"Home","37":"Left Arrow","38":"Up Arrow","39":"Right Arrow","40":"Down Arrow","44":"Print Screen","45":"Insert","46":"Delete","91":"Left Windows","92":"Right Windows","93":"Windows Menu","106":"Numpad *","107":"+","108":"Separator","109":"-","110":"Numpad .","111":"Numpad /","144":"Num Lock","145":"Scroll Lock","59":";","188":",","190":".","191":"/","192":"`","219":"[","220":"\\","221":"]","222":"'"};
var Key={MOD_ALT:1,MOD_CTRL:2,MOD_SHIFT:4,SHIFT:16,CTRL:17,ALT:18,F1:112,F12:123,PRTSCR:44,CANCEL:3,PAUSE:19,TAB:9,NUMBER0:48,NUMBER9:57,A:65,Z:90,NUMPAD0:96,NUMPAD9:105,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,UseMozKey:false,ToMozKey:function(a){if(a==this.CANCEL){return this.PAUSE}if(this.UseMozKey){return a}if(!this.IE2MOZ){this.IE2MOZ=[{ie:186,moz:59},{ie:187,moz:107},{ie:189,moz:109}]}for(var b=0,c=this.IE2MOZ.length;b<c;++b){if(this.IE2MOZ[b].ie==a){return this.IE2MOZ[b].moz}}return a},InitHandlers:function(){$(document).bind("keydown",Key.OnKeyDown);$(document).bind("keyup",Key.OnKeyUp);window.onhelp=EvtMan.StopEvent;document.onhelp=EvtMan.StopEvent;if($.browser.mozilla||$.browser.opera){this.UseMozKey=true}},RemoveHandlers:function(){$(document).unbind("keydown",Key.OnKeyDown);$(document).unbind("keyup",Key.OnKeyUp);window.onhelp=null;document.onhelp=null},ShouldHandleKeyUp:function(a){if(a==this.PRTSCR){return true}return false},OnKeyDown:function(a){if(a.apWhich===undefined){a.apWhich=Key.ToMozKey(a.which)}if(Key.ShouldHandleKeyUp(a.apWhich)){return EvtMan.StopEvent(a)}return Key.HandleKey(a)},OnKeyUp:function(a){if(a.apWhich===undefined){a.apWhich=Key.ToMozKey(a.which)}if(!Key.ShouldHandleKeyUp(a.apWhich)){return EvtMan.StopEvent(a)}return Key.HandleKey(a)},HandleKey:function(b){if(Options.AllowNavigate){if(b.apWhich==Key.TAB&&UI.MoveFocus(b.shiftKey)){return EvtMan.StopEvent(b)}if(b.apWhich==Key.TAB||b.apWhich==Key.SHIFT||b.shiftKey){return}}if((Prez.Session.PMode&PlayModes.DEMO)||Prez.Session.state==States.PAUSED||Prez.Session.state==States.BUFFERING||!Prez.slideUI){return EvtMan.StopEvent(b)}$(document).trigger("feedback",[b]);var f=InputUI.GetEvtValue(b);var d=false;var a=Prez.slideUI.inputUIs;var c=a.length;if(c==1){if(a[0].ctrl.kind==CtrlKind.TEXTINPUT){if(b.target){var h=b.target.nodeName.toLowerCase();d=(h=="textarea")||(h=="input")}}if(!d){a[0].Submit(EvtType.KEY_DOWN,f)}}else{if(c>1){var e=0;var k=new Array(c);for(e=0;e<c;++e){k[e]=a[e].GetResponse(EvtType.KEY_DOWN,f)}var j=true;for(e=0;e<c;++e){var g=k[e].jud;if(g==Judge.CORRECT||g==Judge.NEUTRAL){a[e].Submit(EvtType.KEY_DOWN,f,k[e]);j=false;break}if(g==Judge.PARTIAL_CORRECT){j=true}}if(j){if(b.target){var h=b.target.nodeName.toLowerCase();d=(h=="textarea")||(h=="input")}if(!d){for(e=0;e<c;++e){if(k[e].jud==Judge.WRONG){if(a[e].Submit(EvtType.KEY_DOWN,f,k[e])===false){break}}}}}}}if(!d||b.altKey||b.ctrlKey||(b.apWhich>=Key.F1&&b.apWhich<=Key.F12)){return EvtMan.StopEvent(b)}}};var MediaPlayerTypes={HTML5:0,FLASH:1,SILVERLIGHT:2};var MediaManager={ePlayerType:MediaPlayerTypes.HTML5,strAudioExt:"mp3",strVideoExt:"mp4",arrPlayerIDs:[],arrPlayerTypes:[],requireAction:true,hasSilverlight:false,hasFlashPlayer:false,Init:function(){if(!Options.ExportHTML5){this.ePlayerType=Options.UseSilverlight?MediaPlayerTypes.SILVERLIGHT:MediaPlayerTypes.FLASH;if(this.ePlayerType==MediaPlayerTypes.SILVERLIGHT){this.hasSilverlight=Silverlight.isInstalled(silverlightVer)}else{this.hasFlashPlayer=swfobject.hasFlashPlayerVersion(flashPlayerVer)}return}var e={ogg:'audio/ogg; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"'};var a={mp4:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',webm:'video/webm; codecs="vp8, vorbis"'};var d;var c=document.createElement("audio");if(!c.canPlayType){e={}}else{for(d in e){if(!c.canPlayType(e[d]).replace(/^no$/,"")){delete e[d]}}}var b=document.createElement("video");if(!b.canPlayType){a={}}else{for(d in a){if(!b.canPlayType(a[d]).replace(/^no$/,"")){delete a[d]}}}if((!e.mp3&&!e.ogg)||(!a.webm&&!a.mp4)){this.ePlayerType=Options.UseSilverlight?MediaPlayerTypes.SILVERLIGHT:MediaPlayerTypes.FLASH;if(this.ePlayerType==MediaPlayerTypes.SILVERLIGHT){this.hasSilverlight=Silverlight.isInstalled(silverlightVer)}else{this.hasFlashPlayer=swfobject.hasFlashPlayerVersion(flashPlayerVer)}}else{if(e.mp3){this.strAudioExt="mp3"}else{if(e.ogg){this.strAudioExt="ogg"}}if(a.mp4){this.strVideoExt="mp4"}else{if(a.webm){this.strVideoExt="webm"}}}},CreatePlayer:function(a,b,c){if(this.ePlayerType==MediaPlayerTypes.HTML5){return new MediaPlayerHTML5(a,b,c)}else{return new MediaPlayer(a,b,c)}},GetPlayerContainerId:function(a,b,c){return"ctrl_"+(c?"audio_":"video_")+b+"_"+a},GetPlayerId:function(a,b){if(this.ePlayerType==MediaPlayerTypes.HTML5){return a+(b?"_audio_player":"_video_player")}else{return a+"_plugin_player"}},CreatePlayerElements:function(b,c,d){var a=this.GetPlayerContainerId(b,c,d);return this.CreatePlayerElements2(a,d)},CreatePlayerElements2:function(a,c){var b="";b+='<div class="ctrl ap-ctrl-media" id="'+a+'" tabindex="-1">';if(this.ePlayerType==MediaPlayerTypes.HTML5){if(c){b+='<audio class="ap-audio-player" id="'+MediaManager.GetPlayerId(a,true)+'" tabindex="-1"></audio>'}else{b+='<img src="'+UI.BlankImgUrl()+'" class="bgimg" id="'+a+'_vend_frame" role="presentation" width="100%" height="100%" />';b+='<video class="ap-video-player" id="'+MediaManager.GetPlayerId(a,false)+'" tabindex="-1"></video>';b+='<img src="'+UI.BlankImgUrl()+'" class="bgimg" id="'+a+'_vstart_frame" role="presentation" width="100%" height="100%" />'}}b+="</div>";this.arrPlayerIDs.push(a);this.arrPlayerTypes.push(c);return b},ClearPlayerIDs:function(){this.arrPlayerIDs=[];this.arrPlayerTypes=[]},InitPlayers:function(k,c){if(!BrowserInfo.android&&!BrowserInfo.iDevice){this.requireAction=false;k.call(c);return}this.players=new Array(this.arrPlayerIDs.length);for(var e=0,b=this.players.length;e<b;++e){this.players[e]=null;var d={context:this,ready:function(){this._OnInitPlayerUpdate(k,c)},end:function(){},statechanged:function(){this._OnInitPlayerUpdate(k,c)}};var f;if(this.arrPlayerTypes[e]){f={mode:"audio",init:true}}else{f={mode:"video",init:true,width:1,height:1,displayheight:1}}this.players[e]=this.CreatePlayer(f,this.arrPlayerIDs[e],d)}var h=$("#StageDiv");h.append('<img id="UserActionReceiver" src="player/images/play.png"/ style="z-index:100000;cursor:pointer;position:absolute;">');var a=$("#UserActionReceiver");var l=(h.width()-128)/2;var j=(h.height()-128)/2;a.css({top:j+"px",left:l+"px"});var g=this;a.click(function(){g._DispatchUserAction()});this.requireAction=true;this._OnInitPlayerUpdate(k,c)},_OnInitPlayerUpdate:function(e,c){if(!this.requireAction){$("#APInitBuffImg").remove();return}for(var b=0,a=this.players.length;b<a;++b){if(this.players[b].IsRequireUserAction()==true){return}}$("#UserActionReceiver").remove();var d=this;$(this).oneTime(100,function(){for(var h=0,f=d.players.length;h<f;++h){var g=d.players[h];if(g){g.CleanUp()}}d.players=[];d.requireAction=false;if(e){e.call(c)}})},_DispatchUserAction:function(){for(var c=0,a=this.players.length;c<a;++c){var b=this.players[c];if(b.IsRequireUserAction()){b.DispatchUserAction()}}}}
/*!
 * Atomi Ajax Player - UI Implementations
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Created: 2008/01/20
 * Modified: 2014/03/10
 */
;var UI={IDs:{ViewPort:"ViewPortDiv",Stage:"StageDiv",Canvas:"CanvasDiv",ClosedCaption:"CCaptionDiv",Slides:"SlidesDiv"},IEBrowser:false,IEBLOW:false,SlideList:null,Toolbar:null,$Slides:null,slideW:0,slideH:0,AutoFitWindow:TemplateParams.IniAutoFit,dockables:[],focusedPane:null,GetSlideLayerID:function(a){if(a==1){return"sld_layer1"}else{return"sld_layer2"}},IsAutoFit:function(){return this.AutoFitWindow},EnableAutoFit:function(a){if(a!=this.AutoFitWindow){this.AutoFitWindow=a;this.Layout()}},ToggleAutoFit:function(){this.EnableAutoFit(!this.AutoFitWindow)},BlankImgUrl:function(){return"player/images/blank.gif"},ViewPort:function(){return $("#"+this.IDs.ViewPort)},Stage:function(){return $("#"+this.IDs.Stage)},Canvas:function(){return $("#"+this.IDs.Canvas)},FindDockable:function(b){for(var a=0;a<this.dockables.length;++a){if(this.dockables[a].GetId()==b){return this.dockables[a]}}return null},LayoutDockPane:function(g,j){var f=(g.attr("id")=="DockPaneLeft"||g.attr("id")=="DockPaneRight");var c=g.children();var b=c.length;var a=TemplateParams.DockPaneSize||250;g.css(f?"width":"height",b<=0?0:a);
if(b<=0){return}var k=(j!==undefined);var d=0;var o=0;c.each(function(h,l){var q=$(l);d+=q.outerWidth(true);o+=q.outerHeight(true)});if(d<1){d=1}if(o<1){o=1}if(f){var m=g.height();var n=g.width();var p=0;c.each(function(h,s){var u=$(s);var l=n-parseInt(u.css("border-left-width"))-parseInt(u.css("border-right-width"));u.css("position","absolute").width(l).css("left",0);var r=(h==b-1)?m-p:(k?m/b:u.outerHeight(true)/o*m);var q=r-(parseInt(u.css("border-top-width"))+parseInt(u.css("border-bottom-width")));u.height(q).css("top",p);p+=r;var t=UI.FindDockable(u.attr("id"));if(t){t.LayoutContent();t.EnableMinimize(b>1);if(k){t.ClearMinimizedState()}}})}else{var m=g.height();var n=g.width();var e=0;c.each(function(h,s){var u=$(s);var r=m-parseInt(u.css("border-top-width"))-parseInt(u.css("border-bottom-width"));u.css("position","absolute").height(r).css("top",0);var q=(h==b-1)?n-e:(k?n/b:u.outerWidth(true)/d*n);var l=q-(parseInt(u.css("border-left-width"))+parseInt(u.css("border-right-width")));u.width(l).css("left",e);e+=q;var t=UI.FindDockable(u.attr("id"));if(t){t.LayoutContent();t.EnableMinimize(b>1);if(k){t.ClearMinimizedState()}}})}},Layout:function(){if(!UI.Toolbar){return}var u=UI.Toolbar.GetPadding();var e=UI.Toolbar.GetMinPlayerSize();var f=UI.IsAutoFit();var v=1;var p={w:$(window).innerWidth()-2*v,h:$(window).innerHeight()-2*v};var k=PrezInfo.ViewPort.width,r=PrezInfo.ViewPort.height;var b=$("#DockPaneLeft");var a=$("#DockPaneRight");var y=$("#DockPaneTop");var j=$("#DockPaneBottom");var s=UI.Stage();var d=UI.Canvas();var t=UI.ViewPort();var c=Math.max(e.w-b.width()-a.width()-u.l-u.r,1);var l=Math.max(e.h-y.height()-j.height()-u.t-u.b,1);if(f){var x=Math.max(p.w-b.width()-a.width()-u.l-u.r,1);var g=Math.max(p.h-y.height()-j.height()-u.t-u.b,1);if(x/g<k/r){g=Math.floor(r*x/k)}else{x=Math.floor(k*g/r)}if(x<c||g<l){if(x/g<c/l){x=c;g=r*x/k}else{g=l;x=k*g/r}}s.css("overflow","hidden").width(x).height(g);d.width(x).height(g)}else{var x=Math.min(k,p.w-b.width()-a.width()-u.l-u.r);var g=Math.min(r,p.h-y.height()-j.height()-u.t-u.b);if(x<c){x=c}if(g<l){g=l}s.css("overflow","auto").width(x).height(g);d.width(k-40).height(r-40);d.width(k).height(r)}var n=$("#UserActionReceiver");if(n.length){var m=(x-n.width())/2;var o=(g-n.height())/2;n.css({top:o+"px",left:m+"px"})}t.width(b.width()+s.width()+a.width()+u.l+u.r);t.height(y.height()+s.height()+j.height()+u.t+u.b);t.css("left",Math.floor((p.w-t.width())/2)+v).css("top",0);b.css("left",u.l).css("top",u.t).height(t.height()-u.t-u.b);a.css("left",u.l+b.width()+s.width()).css("top",u.t).height(t.height()-u.t-u.b);y.css("left",u.l+b.width()).css("top",u.t).width(s.width());j.css("left",u.l+b.width()).css("top",u.t+y.height()+s.height()).width(s.width());s.css("left",u.l+b.width()).css("top",u.t+y.height());UI.LayoutDockPane(b);UI.LayoutDockPane(a);UI.LayoutDockPane(y);UI.LayoutDockPane(j);UI.Toolbar.Layout();for(var q=0;q<this.dockables.length;++q){if(this.dockables[q].IsFloating()){this.dockables[q].EnsureInsideStage()}}if(f){Prez.Zoom(s.width()/k)}else{Prez.Zoom(1)}},Init:function(){if(UI.Toolbar){return}var a=location.href;a.toLowerCase();if(a.indexOf("autofit=false")!=-1){this.AutoFitWindow=false}else{if(a.indexOf("autofit=true")!=-1){this.AutoFitWindow=true}}UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlide.duration,sliderVal:0});$(window).unbind("resize").resize(this.OnResizeWindow);UI.IEBrowser=$.browser.msie;UI.IEBLOW=(UI.IEBrowser&&(parseInt($.browser.version)<=7));UI.slideW=PrezInfo.ViewPort.width;UI.slideH=PrezInfo.ViewPort.height;UI.Layout()},OnPrezStart:function(a){CanvasNav.Init();$(window).unbind("resize").resize(this.OnResizeWindow);if(a){if(this.SlideList){this.SlideList.Hide();this.SlideList=null}if(this.SlideNotes){this.SlideNotes.Hide();this.SlideNotes=null}}this.$Slides=$("#"+this.IDs.Slides).empty();MediaManager.ClearPlayerIDs();var d=this.GetSlideLayerID(1);var g=this.GetSlideLayerID(2);var l="";for(var c=1;c<=2;++c){var b=(c==1?d:g);l+='<div class="slide" id="'+b+'" style="z-index:'+(c==1?ZIndexBase.SlideCtrlsOld:ZIndexBase.SlideCtrlsNew)+';" onclick="void(0)">';for(var e=0;e<mediaStats.nMaxSlideVideo;++e){l+=MediaManager.CreatePlayerElements(e,b,false)}l+="</div>"}this.$Slides.append(l);if(Prez.prjSlide.wmd){var j="da";j+="ta";j+=":i";j+="ma";j+="ge";j+="/p";j+="ng";j+=";b";j+="as";j+="e6";j+="4,";var h='<img id="appwmk1" class="bgimg ap-wmk" style="display:none;" src="'+j+Prez.prjSlide.wmd+'" alt="'+Params.Generator+'" width="100%" height="100%" />';var f='<img id="appwmk2" class="bgimg ap-wmk" style="display:none;" src="'+j+Prez.prjSlide.wmd+'" alt="'+Params.Generator+'" width="100%" height="100%" />';$(h).error(function(){$("#appwmk1").remove()}).appendTo($("#"+d));$(f).error(function(){$("#appwmk2").remove()}).appendTo("#"+g)}this.Toolbar.Show();this.Toolbar.SetListener("onSeeking",UI,"OnSeeking");this.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging");ClosedCaptionUI.Init();if(!this.SlideList&&TemplateParams.IniSlideListShow&&this.HasSlideList()){this.ShowSlideList()}if(!this.SlideNotes&&TemplateParams.IniSlideNotesShow&&this.HasSlideNotes()){this.ShowSlideNotes()}this.Layout()},HasSlideList:function(){if(TemplateParams.SlideListPos==UIPos.NONE){return false}if(TemplateParams.AlwaysShowSlideList){return true}if(Prez.Session.PMode!=PlayModes.PRAC&&Prez.Session.PMode!=PlayModes.TEST){return true}return false},HasSlideNotes:function(){return false;if(TemplateParams.SlideNotesPos==UIPos.NONE){return false}if(TemplateParams.AlwaysShowSlideNotes){return true}if(Prez.Session.PMode!=PlayModes.PRAC&&Prez.Session.PMode!=PlayModes.TEST){return true}return false},OnResizeWindow:function(a){if(!$(a.target).hasClass("ui-resizable")){UI.Layout()}},CleanUp:function(){CanvasNav.CleanUp();$(window).unbind("resize")},ShowSlideList:function(){if(!this.SlideList){this.SlideList=new SlideListUI();this.SlideList.Show();var a=Prez.GetSlideCompletions();this.SlideList.MarkComplete(a);if(Prez.slideUI){this.SlideList.SetCurrentSlide(Prez.slideUI&&Prez.slideUI.GetIndex())}else{this.SlideList.SetCurrentSlide(-1)}}},ShowSlideNotes:function(){if(!this.SlideNotes){this.SlideNotes=new SlideNotesUI();this.SlideNotes.Show();var a=Prez.GetSlideCompletions();this.SlideNotes.MarkComplete(a);if(Prez.slideUI){this.SlideNotes.SetCurrentSlide(Prez.slideUI&&Prez.slideUI.GetIndex())}else{this.SlideNotes.SetCurrentSlide(-1)}}},OnSeeking:function(g,c,b,f){if(!UI.SlideNavigationEnabled()){return false}var d,a,e=Prez.GetSlides();for(d=e.length-1;d>=0;--d){a=e[d];if(b>=a.startTime){this.Toolbar.SetSliderTip(d+1);if(f){Prez.ShowSlide(a,b-a.startTime,false)}return}}},OnVolumeChanging:function(d,b,a,c){Prez.SetVolume(a)},ShowMsg:function(b,f,c,a){if(a==undefined){a=[]}if(f==undefined){f=true}if(c==undefined){c=false}var e=Prez.Pause(States.WAITING);$(document).bind("reveal.facebox",function(){Key.RemoveHandlers();Mouse.RemoveHandlers();$(document).unbind("reveal.facebox");$.facebox.showClose(f);var j=-1;if(f){var h="facebox_close";a.push(h);j=a.length-1;$("#facebox .close").attr({id:h,title:Lang.Close,role:"button",tabindex:"0"}).focus();$("#facebox .close_image").attr("title",Lang.Close)}$("#facebox").attr("role","dialog");$(document).bind("keydown.facebox",function(l){var n=l.which;if(n==Key.TAB){var p=false;if(j>=0&&j<=a.length-1){var o=$("#"+a[j]);if(o.attr("tabindex")==0){p=true;o.attr("tabindex","-1");o.blur()}}if(j<0||j>a.length-1){j=0}else{j+=p?(l.shiftKey?-1:1):0;if(j<0){j=a.length-1}else{if(j>a.length-1){j=0}}}var k=$("#"+a[j]);k.attr("tabindex","0");k.focus()}else{if(n==Key.ESCAPE){$.facebox.trigger("close.facebox")}else{if(n==13||n==32){for(var m=0;m<a.length;++m){if(l.target.id==a[m]){l.stopPropagation();return true}}}}}return false}).bind("focus.facebox",function(l){if(j<0||j>a.length-1){j=0}var k=$("#"+a[j]);k.attr("tabindex","0");k.focus()}).bind("mousedown.facebox",function(k){$(this).focus();return false});for(var g=0;g<a.length;++g){$("#"+a[g]).focus(function(k){j=$.inArray($(this).attr("id"),a);
$(this).attr("tabindex","0")}).blur(function(k){$(this).attr("tabindex","-1")})}$(document).focus()});var d=function(){$(document).unbind("mousedown.facebox").unbind("focus.facebox").unbind("keydown.facebox").unbind("close.facebox",d);Key.InitHandlers();Mouse.InitHandlers();if(c==true){Prez.Close(false)}else{if(e){Prez.Resume()}}};$(document).bind("close.facebox",d);$.facebox(b)},ShowAbout:function(){var b=[];var a="";if(PrezInfo.Homepage!=""){a="<a id='about_homepage' href='"+PrezInfo.Homepage.quoteHTML()+"' target='_blank' tabindex='-1'>"+PrezInfo.Homepage.quoteHTML()+"</a>";b.push("about_homepage")}var c="<div style='font-family:verdana;font-size:90%;color:green'>";c+="<b>"+PrezInfo.Name.quoteHTML()+"</b><br>"+Lang.Author+": <b>"+PrezInfo.Author.quoteHTML()+"</b><br>"+Lang.Copyright+": <b>"+PrezInfo.Copyright.quoteHTML()+"</b><br>"+Lang.Homepage+": <b>"+a+"</b><hr/>"+Lang.BuiltWith+"<br><img id='aplogo' src='"+UI.BlankImgUrl()+"'/><b>"+Params.Generator.quoteHTML()+"</b><br><a id ='about_app_home' href='"+PrezInfo.AppHomePage+"' title='"+PrezInfo.AppHomePage+"' target='_blank' tabindex = '-1'>Atomi Systems, Inc.</a></div>";b.push("about_app_home");UI.ShowMsg(c,true,false,b)},UpdateTemplateParamsChanged:function(){if(UI.Toolbar){UI.Toolbar.Hide();UI.Toolbar=new APToolbar({sliderMin:0,sliderMax:Prez.prjSlide.duration,sliderVal:0});UI.Toolbar.Show();UI.Toolbar.SetListener("onSeeking",UI,"OnSeeking");UI.Toolbar.SetListener("onVolumeChanging",UI,"OnVolumeChanging")}if(UI.SlideList){UI.SlideList.Hide();UI.SlideList=undefined}if(UI.SlideNotes){UI.SlideNotes.Hide();UI.SlideNotes=undefined}if(!UI.SlideList&&TemplateParams.IniSlideListShow&&UI.HasSlideList()){UI.ShowSlideList()}if(!UI.SlideNotes&&TemplateParams.IniSlideNotesShow&&UI.HasSlideNotes()){UI.ShowSlideNotes()}UI.Layout()},AddDockable:function(a){this.dockables.push(a)},RemoveDockable:function(a){this.dockables=jQuery.grep(this.dockables,function(b){return b!=a})},MoveFocus:function(e){var b=[CanvasNav];if(this.Toolbar){b.push(this.Toolbar)}if(this.SlideList){b.push(this.SlideList)}if(this.SlideNotes){b.push(this.SlideNotes)}var c=$.inArray(this.focusedPane,b),a=b.length,d=null;if(c<0){if(e){c=a}else{c=-1}}while(true){if(e){--c}else{++c}d=b[c];if(!d){this.focusedPane=null;return false}if(this.FocusPane(d)){return true}}return false},FocusPane:function(a){if(a&&a.Focus&&a.Focus()){this.focusedPane=a;return true}return false},OnPaneFocused:function(a){UI.focusedPane=a},SlideNavigationEnabled:function(){if(Prez.Session.PMode==PlayModes.PRAC){return(TemplateParams.NavInPractice==1)}else{if(Prez.Session.PMode==PlayModes.TEST){return false}}return true}};var CanvasNav={_focusedCtrlUI:null,Init:function(){UI.Canvas().bind("focusin.nav",function(){UI.OnPaneFocused(CanvasNav)});this._focusedCtrlUI=null;if(!Options.AllowNavigate){return}UI.Canvas().bind("keydown.nav",function(c){if(c.which!=Key.TAB){return}if((Prez.Session.PMode&PlayModes.DEMO)||!Prez.slideUI){return}var d=Prez.slideUI.ctrlUIs;var a=$.inArray(CanvasNav._focusedCtrlUI,d),e=null;if(c.shiftKey){if(a<0){a=d.length}e=CanvasNav._GetNextFocusedCtrl(a-1,true)}else{if(a<0){a=-1}e=CanvasNav._GetNextFocusedCtrl(a+1,false)}var b=CanvasNav._focusedCtrlUI;if(e&&e.Focus()){if(b&&b!=e&&b.IsShown()){b.MouseLeave()}e.MouseEnter();CanvasNav._focusedCtrlUI=e;return EvtMan.StopEvent(c)}if(b&&b.IsShown()){b.MouseLeave()}}).bind("mousedown",function(){CanvasNav.Focus(false)})},CleanUp:function(){UI.Canvas().unbind(".nav");this._focusedCtrlUI=null},Focus:function(a){if(a===undefined){a=true}var b=this._focusedCtrlUI;if(!b||!b.IsFocusable()){b=this._GetNextFocusedCtrl(0,false)}this._focusedCtrlUI=null;if(b&&b.Focus()){if(a){b.MouseEnter()}this._focusedCtrlUI=b}else{UI.Canvas().focus()}return true},GetFocusedCtrl:function(){return this._focusedCtrlUI},OnCtrlFocused:function(a){CanvasNav._focusedCtrlUI=a},_GetNextFocusedCtrl:function(c,e){if(!Prez.slideUI){return null}var a,d,b=Prez.slideUI.ctrlUIs;if(e){for(a=c;a>=0;--a){if(b[a].IsFocusable()){return b[a]}}}else{for(a=c,d=b.length;a<d;++a){if(b[a].IsFocusable()){return b[a]}}}return null}};var DockPosition={LEFT:UIPos.LEFT,TOP:UIPos.TOP,RIGHT:UIPos.RIGHT,BOTTOM:UIPos.BOTTOM};var nDockableOffset=0;function DockableUI(a){this.id=a;this.rect={x:100+nDockableOffset*20,y:100+nDockableOffset*20,w:300,h:200};this.nSavedDockedSize=100;nDockableOffset++;this.eDockPos=DockPosition.RIGHT;this.nDockIndex=0;this.bFloat=true;this.bMinimized=false;this.eDockHintPos=null;this.nDockZIndex=ZIndexBase.SlideList+1;this.nHintZIndex=ZIndexBase.SlideList+2;this.nFloatZIndex=ZIndexBase.SlideList+3;this.bKeyNavEnabled=Options.AllowNavigate;this.bHighConstrastSupport=true;this.arrNavItems=[];this.nFocusedItemIndex=-1;this.bMoveOrResizeByKey=false}$.extend(DockableUI.prototype,{constructor:DockableUI,GetId:function(){return this.id},IsFloating:function(){return this.bFloat},GetDockPos:function(){return this.eDockPos},GetBestMinSize:function(){var c=$("#"+this.id+"_title");var a=c.find(".ap-dockable-title-bar-text");var b=c.find(".ap-dockable-button-pane");return{w:a.width()+b.width()+20,h:c.height()}},_GetContent:function(){},_GetTitle:function(){},_GetButtonHTML:function(){var a='<div class="ap-dockable-button-pane"><span id="'+this.id+'_minimize_restore" class="ap-dockable-button ap-dockable-button-minimize" title="'+Lang.Minimize+'" role="button" tabindex="-1" aria-pressed="'+this.bMinimized+'" aria-disabled="false"></span><span id="'+this.id+'_toogle_dock" class="ap-dockable-button" role="button" tabindex="-1" aria-pressed="'+this.bFloat+'"></span><span id="'+this.id+'_close" class="ap-dockable-button ap-dockable-button-close" title="'+Lang.Close+'" role="button" tabindex="-1"></span></div>';return a},_GetHTML:function(){var a='<div id="'+this.id+'" class="ap-dockable" tabindex="-1"><div id="'+this.id+'_title" class="ap-dockable-title-bar"><div class="ap-dockable-title-bar-text">'+this._GetTitle()+"</div>"+this._GetButtonHTML()+'</div><div id="'+this.id+'_content" class="ap-dockable-content"><div id="'+this.id+'_content_inner" class="ap-dockable-content-inner">'+this._GetContent()+"</div></div></div>";return a},_GetDockPane:function(a){if(a===undefined){return null}switch(a){case DockPosition.LEFT:return $("#DockPaneLeft");case DockPosition.RIGHT:return $("#DockPaneRight");case DockPosition.TOP:return $("#DockPaneTop");case DockPosition.BOTTOM:return $("#DockPaneBottom")}return null},_GetSuggestedDockPos:function(){var e=5;var l=$("#"+this.id);var g=UI.Stage();var c=l.offset();var h=g.offset();var f=c.left-h.left;var a=c.top-h.top;var b=(h.left+g.width())-(c.left+l.width());var k=(h.top+g.height())-(c.top+l.height());var d=Math.min(f,a,b,k);var j=null;if(d<e){if(d==f){j=DockPosition.LEFT}else{if(d==b){j=DockPosition.RIGHT}else{if(d==a){j=DockPosition.TOP}else{if(d==k){j=DockPosition.BOTTOM}}}}}return j},_InitHighConstrastSupport:function(){$("#"+this.id).find(".ap-dockable-button").each(function(){$(this).append('<img src="player/images/icons.png" alt="'+$(this).attr("title")+'"/>');$(this).css("background","none")});$("#"+this.id).find(".ap-icon").each(function(){$(this).append('<img src="player/images/icons.png" alt="'+$(this).attr("title")+'"/>');$(this).css("background","none")})},_InitKeyNavSupport:function(){var b=this;$("#"+this.id).mousedown(function(c){c.stopPropagation();return true}).keydown(function(f){var n=f.which;if(n==Key.TAB){var g=b.nFocusedItemIndex;var d=b.arrNavItems;if(g>=0&&g<d.length){var o=$("#"+d[g]);o.attr("tabindex","-1");o.blur()}if((f.shiftKey&&g==0)||(!f.shiftKey&&g>=d.length-1)){b.nFocusedItemIndex=-1;return true}b.nFocusedItemIndex=g<0?0:g+(f.shiftKey?-1:1);var o=$("#"+d[b.nFocusedItemIndex]);o.attr("tabindex","0");o.focus()}else{if(n==32||n==13){var h=$(f.target);if(h.hasClass("ap-dockable-button")){h.trigger("click")}}else{if((n==37||n==38||n==39||n==40)&&(f.shiftKey||f.altKey)){if(!b.bFloat){return false}if(!b.bMoveOrResizeByKey){b.bMoveOrResizeByKey=true;b._SavePosAndSize()}var p=$("#"+this.id);var l=UI.Canvas();
var k={l:parseInt(l.css("left")),t:parseInt(l.css("top")),w:l.width(),h:l.height()};var c={l:parseInt(p.css("left")),t:parseInt(p.css("top")),w:p.width(),h:p.height()};var j=5;if(f.shiftKey){c.w+=(n==37?-j:(n==39?j:0));c.h+=(n==38?-j:(n==40?j:0));if(c.w<1){c.w=1}if(c.h<1){c.h=1}if(c.l+c.w>k.l+k.w){c.w=k.l+k.w-c.l}if(c.t+c.h>k.t+k.h){c.h=k.t+k.h-c.t}}else{c.l+=(n==37?-j:(n==39?j:0));c.t+=(n==38?-j:(n==40?j:0));if(c.l<k.l){c.l=k.l}if(c.t<k.t){c.t=k.t}if(c.l+c.w>k.l+k.w){c.l=k.l+k.w-c.w}if(c.t+c.h>k.t+k.h){c.t=k.t+k.h-c.h}}var m=b._GetSuggestedDockPos();if(m==null){b._HideDockHint()}else{b._ShowDockHint(m)}var e=(c.w!=p.width()||c.h!=p.height());p.css({left:c.l+"px",top:c.t+"px",width:c.w+"px",height:c.h+"px"});if(e){b.LayoutContent()}}else{return true}}}return false}).keyup(function(c){if(b.bMoveOrResizeByKey){b.bMoveOrResizeByKey=false;b._HideDockHint();var d=b._GetSuggestedDockPos();if(d!=null){b.Dock(d)}}}).focus(function(c){$(this).attr("tabindex","-1");if(b.nFocusedItemIndex<0||b.nFocusedItemIndex>=b.arrNavItems.length){b.nFocusedItemIndex=0}var d=$("#"+b.arrNavItems[b.nFocusedItemIndex]);d.attr("tabindex","0");d.focus();return false});$("#"+this.id+"_title").mousedown(function(c){if(b.nFocusedItemIndex<0||b.nFocusedItemIndex>=b.arrNavItems.length){b.nFocusedItemIndex=0}var d=$("#"+b.arrNavItems[b.nFocusedItemIndex]);d.attr("tabindex","0");d.focus()}).find(".ap-dockable-button").mousedown(function(c){$(this).focus()});for(var a=0;a<b.arrNavItems.length;++a){$("#"+b.arrNavItems[a]).focus(function(c){b.nFocusedItemIndex=$.inArray($(this).attr("id"),b.arrNavItems);$(this).attr("tabindex","0")}).blur(function(c){$(this).attr("tabindex","-1")})}if(b.nFocusedItemIndex>=0&&b.nFocusedItemIndex<b.arrNavItems.length){$("#"+b.arrNavItems[b.nFocusedItemIndex]).focus()}},_Init:function(){if(this.bKeyNavEnabled){this._InitKeyNavSupport()}if(this.bHighConstrastSupport){this._InitHighConstrastSupport()}var a=this;$("#"+this.id+"_minimize_restore").click(function(b){if(a.bMinimized){a.Restore()}else{a.Minimize()}return false});$("#"+this.id+"_toogle_dock").click(function(b){a.ToggleDock();return false});$("#"+this.id+"_close").click(function(b){a.Hide();return false});$("#"+this.id+"_title").attr("unselectable","on").css("user-select","none").on("selectstart",false);$("#"+this.id).css("z-index",this.bFloat?this.nFloatZIndex:this.nDockZIndex)},_IsVerDocked:function(){return(this.eDockPos==DockPosition.RIGHT||this.eDockPos==DockPosition.LEFT)},_IsHozDocked:function(){return(this.eDockPos==DockPosition.TOP||this.eDockPos==DockPosition.BOTTOM)},LayoutContent:function(){var c=$("#"+this.id);var b=$("#"+this.id+"_title");var a=$("#"+this.id+"_content");a.height(c.height()-b.height()-parseInt(b.css("border-bottom-width")));a.width(c.width())},EnsureInsideStage:function(){if(!this.bFloat){return}var d=$("#"+this.id);if(d.length==0){return}var b=UI.Stage();var a={x:parseInt(b.css("left")),y:parseInt(b.css("top")),w:b.width(),h:b.height()};var c={x:parseInt(d.css("left")),y:parseInt(d.css("top")),w:d.width(),h:d.height()};c.w=Math.max(Math.min(b.width(),c.w),1);c.h=Math.max(Math.min(b.height(),c.h),1);c.x=Math.max(Math.min(c.x,a.x+a.w-c.w),a.x);c.y=Math.max(Math.min(c.y,a.y+a.h-c.h),a.y);d.css("left",c.x).css("top",c.y).width(c.w).height(c.h)},_OnStartResizing:function(c,e){var g=$("#"+this.id);var b=g.prev();var d;if(b){d=UI.FindDockable(b.attr("id"))}if(d){if(this._IsVerDocked()){var a=g.height();a-=(parseInt(g.css("border-top-width"))+parseInt(g.css("border-bottom-width")));a+=(b.height()-b.resizable("option","minHeight"));g.resizable("option","maxHeight",a)}else{var f=g.width();f-=(parseInt(g.css("border-left-width"))+parseInt(g.css("border-right-width")));f+=(b.width()-1);g.resizable("option","maxWidth",f);g.resizable("option","minWidth",1)}}else{g.resizable("option","minHeight",g.height());g.resizable("option","maxHeight",g.height());g.resizable("option","minWidth",g.width());g.resizable("option","maxWidth",g.width())}},_OnUpdateResizing:function(c,e){this.LayoutContent();var g=$("#"+this.id);var b=g.prev();if(!b){return}var d=UI.FindDockable(b.attr("id"));if(!d){return}if(this._IsVerDocked()){var f=parseInt(g.css("top"))-parseInt(b.css("top"));f-=(parseInt(b.css("border-top-width"))+parseInt(b.css("border-bottom-width")));b.height(f)}else{if(this._IsHozDocked()){var a=parseInt(g.css("left"))-parseInt(b.css("left"));a-=(parseInt(b.css("border-left-width"))+parseInt(b.css("border-right-width")));b.width(a)}}d.LayoutContent();d.ClearMinimizedState()},_SavePosAndSize:function(){var a=$("#"+this.id);if(a.length==0){return}this.rect.x=parseInt(a.css("left"));this.rect.y=parseInt(a.css("top"));if(!this.bMinimized){this.rect.w=a.width();this.rect.h=a.height()}},Dock:function(c){this._CleanUp();var b=this._GetDockPane(c);if(b){this.eDockPos=c}else{b=this._GetDockPane(this.eDockPos)}this.bFloat=false;if(b){b.append(this._GetHTML());UI.LayoutDockPane(b,true);var a=this;$("#"+this.id).resizable({containment:b,minHeight:$("#"+this.id+"_title").height(),handles:(a._IsVerDocked()?"n":"w"),start:function(d,e){a._OnStartResizing(d,e)},resize:function(d,e){a._OnUpdateResizing(d,e);a.ClearMinimizedState()},stop:function(d,e){a._OnUpdateResizing(d,e)}})}$("#"+this.id+"_toogle_dock").attr({title:Lang.Float,"aria-pressed":this.bFloat}).addClass("ap-dockable-button-dock");UI.AddDockable(this);UI.Layout();this._Init();this.LayoutContent();if(this.bMinimized){this.bMinimized=false;this.Minimize()}},UnDock:function(){this._CleanUp();this.bFloat=true;var c=this;var b=UI.Stage();var a=UI.ViewPort();a.append(this._GetHTML());var d=$("#"+this.id);d.resizable({containment:a,handles:"all",minHeight:$("#"+this.id+"_title").height(),resize:function(e,f){c.LayoutContent();c.ClearMinimizedState()}}).draggable({handle:$("#"+this.id+"_title"),cursor:"move",containment:a,start:function(e,f){c._SavePosAndSize()},drag:function(e,f){var g=c._GetSuggestedDockPos();if(g==null){c._HideDockHint()}else{c._ShowDockHint(g)}},stop:function(e,f){var g=c._GetSuggestedDockPos();c._HideDockHint();if(g!=null){c.Dock(g)}}});$("#"+this.id+"_toogle_dock").attr({title:Lang.Dock,"aria-pressed":this.bFloat}).addClass("ap-dockable-button-float");d.css("position","absolute").css("left",this.rect.x).css("top",this.rect.y).width(this.rect.w).height(this.rect.h);this._Init();this.LayoutContent();if(this.bMinimized){this.bMinimized=false;this.Minimize()}UI.AddDockable(this)},ToggleDock:function(){if(this.bFloat){this._SavePosAndSize();this.Dock()}else{this.UnDock();this.EnsureInsideStage()}},Show:function(){if(!this.bFloat){this.Dock()}else{this.UnDock()}if(UI.Toolbar){UI.Toolbar.UpdateState()}},_CleanUp:function(){$("#"+this.id).remove();UI.RemoveDockable(this);if(!this.bFloat){var a=this._GetDockPane(this.eDockPos);if(a){UI.LayoutDockPane(a,true);UI.Layout()}}},Hide:function(){if(this.bFloat){this._SavePosAndSize()}this._CleanUp();if(UI.Toolbar){UI.Toolbar.UpdateState()}},IsShown:function(){return UI.ViewPort().find("#"+this.id).length>0},ToggleShow:function(){if(this.IsShown()){this.Hide()}else{this.Show()}},Minimize:function(){if(this.bMinimized){return}if(this.bFloat){this._SavePosAndSize();var o=$("#"+this.id+"_title");var r=o.find(".ap-dockable-title-bar-text");var k=o.find(".ap-dockable-button-pane");var q=$("#"+this.id);q.width(r.width()+k.width()+20);q.height(o.height());this.LayoutContent();this.SetMinimizedState()}else{var q=$("#"+this.id);var o=$("#"+this.id+"_title");var d=this._IsVerDocked();this.nSavedDockedSize=d?q.height():q.width();var m=q.next();var h;if(m){h=UI.FindDockable(m.attr("id"))}if(h){if(d){var e=q.height()-o.height();q.height(o.height());var l=parseInt(m.css("top"))-e;var j=m.height()+e;m.css("top",l).height(j)}else{var n=this.GetBestMinSize();var e=q.width()-n.w;q.width(n.w);var p=parseInt(m.css("left"))-e;var g=m.width()+e;m.css("left",p).width(g)}this.LayoutContent();this.SetMinimizedState();h.LayoutContent();h.ClearMinimizedState();return}var f=q.prev();var b;if(f){b=UI.FindDockable(f.attr("id"))}if(b){if(d){var e=q.height()-o.height();
var c=parseInt(q.css("top"))+e;q.height(o.height()).css("top",c);f.height(f.height()+e)}else{var n=this.GetBestMinSize();var e=q.width()-n.w;var a=parseInt(q.css("left"))+e;q.width(n.w).css("left",a);f.width(f.width()+e)}this.LayoutContent();this.SetMinimizedState();b.LayoutContent();b.ClearMinimizedState();return}}},Restore:function(){if(!this.bMinimized){return}if(this.bFloat){var f=$("#"+this.id);f.width(this.rect.w);f.height(this.rect.h);this.LayoutContent();this.ClearMinimizedState()}else{var f=$("#"+this.id);var w=$("#"+this.id+"_title");var q=this._IsVerDocked();var g=f.next();var j;if(g){j=UI.FindDockable(g.attr("id"))}if(j){var p=false;if(q){var c=$("#"+j.id+"_title");var o=Math.min(this.nSavedDockedSize-f.height(),g.height()-c.height());f.height(f.height()+o);var v=parseInt(g.css("top"))+o;var l=g.height()-o;g.css("top",v).height(l);if(j.GetBestMinSize().h==l){p=true}}else{var m=j.GetBestMinSize();var o=Math.min(this.nSavedDockedSize-f.width(),g.width()-m.w);f.width(f.width()+o);var n=parseInt(g.css("left"))+o;var s=g.width()-o;g.css("left",n).width(s);if(j.GetBestMinSize().w==s){p=true}}this.LayoutContent();this.ClearMinimizedState();j.LayoutContent();if(p){j.SetMinimizedState()}else{j.ClearMinimizedState()}return}var u=f.prev();var r;if(u){r=UI.FindDockable(u.attr("id"))}if(r){var b=false;if(q){var a=$("#"+r.id+"_title");var o=Math.min(this.nSavedDockedSize-f.height(),u.height()-a.height());var t=f.height()+o;var d=parseInt(f.css("top"))-o;f.height(t).css("top",d);u.height(u.height()-o);if(r.GetBestMinSize().h==u.height()){b=true}}else{var k=r.GetBestMinSize();var o=Math.min(this.nSavedDockedSize-f.width(),u.width()-k.w);var h=f.width()+o;var e=parseInt(f.css("left"))-o;f.width(h).css("left",e);u.width(u.width()-o);if(r.GetBestMinSize().w==u.width()){b=true}}this.LayoutContent();this.ClearMinimizedState();r.LayoutContent();r.ClearMinimizedState();if(b){r.SetMinimizedState()}else{r.ClearMinimizedState()}return}}},ClearMinimizedState:function(){if(!this.bMinimized){return}this.bMinimized=false;var a=$("#"+this.id+"_minimize_restore");a.removeClass("ap-dockable-button-restore").addClass("ap-dockable-button-minimize").attr({title:Lang.Minimize,"aria-pressed":this.bMinimized});if(this.bHighConstrastSupport){a.find("img").attr("alt",a.attr("title"))}},SetMinimizedState:function(){if(this.bMinimized){return}this.bMinimized=true;var a=$("#"+this.id+"_minimize_restore");a.removeClass("ap-dockable-button-minimize").addClass("ap-dockable-button-restore").attr({title:Lang.Restore,"aria-pressed":this.bMinimized});if(this.bHighConstrastSupport){a.find("img").attr("alt",a.attr("title"))}},EnableMinimize:function(a){$("#"+this.id+"_minimize_restore").css("opacity",a?1:0.35).attr("aria-disabled",""+!a)},_ShowDockHint:function(g){if(this.eDockHintPos==g){return}var f=this._GetDockPane(g);if(!f){this.eDockHintPos=null;$("#"+this.id+"_dock_hint").remove();return}var a=UI.ViewPort();var e=UI.Stage();$("#"+this.id+"_dock_hint").remove();this.eDockHintPos=g;var d='<div id="'+this.id+'_dock_hint" class="ap-dockable-hint"></div>';a.append(d);var c=$("#"+this.id+"_dock_hint");c.css("opacity",0.25).css("z-index",this.nHintZIndex);if(f.width()>0&&f.height()>0){c.css("left",f.css("left")).css("top",f.css("top")).width(f.width()).height(f.height());return}var b=Math.min(e.width()/2,e.height()/2,200);switch(g){case DockPosition.LEFT:c.css("left",e.css("left")).css("top",e.css("top")).width(b).height(e.height());break;case DockPosition.RIGHT:c.css("left",(parseInt(e.css("left"))+e.width()-b)+"px").css("top",e.css("top")).width(b).height(e.height());break;case DockPosition.TOP:c.css("left",e.css("left")).css("top",e.css("top")).width(e.width()).height(b);break;case DockPosition.BOTTOM:c.css("left",e.css("left")).css("top",(parseInt(e.css("top"))+e.height()-b)+"px").width(e.width()).height(b);break;default:break}},_HideDockHint:function(){this._ShowDockHint(null)},Focus:function(){var b=this.arrNavItems[this.nFocusedItemIndex];if(!b){this.nFocusedItemIndex=0;b=this.arrNavItems[0]}var a=$("#"+b);if(a.length){a.attr("tabindex","0");a.focus();return true}return false}});SlideListUI.MS2STR=function(a){var e=Math.round(a/1000);var c=Math.floor(e/3600);var b=Math.floor(e%3600/60);var d=Math.round(e%60*10)/10;var f="";if(c>0){f+=(c+":")}if(c>0&&b<10){f+="0"}f+=(b+":");if(d<10){f+="0"}f+=d;return f};function SlideListUI(){DockableUI.call(this);if(TemplateParams.SlideListPos==UIPos.FLOATING){this.bFloat=true}else{this.bFloat=false;this.eDockPos=TemplateParams.SlideListPos}this.id="SlideList";this.bShowInGroup=TemplateParams.ShowSlideAsGroup;this.mapStates={};this.nCurIndex=-1;this.arrGroups=[];this.mapSlideGroup={};this.strClassIncomplete="ap-slide-list-item-incomplete";this.strClassCurrent="ap-slide-list-item-current";this.strClassCompleted="ap-slide-list-item-completed";this.strClassExpanded="ap-slide-group-expanded";this.strClassCollapsed="ap-slide-group-collapsed";this.strItemPrefix="slide_list_item_slide_";this.strGroupPrefix="slide_list_item_group_";this.strTableId=this.id+"_table";this.nFocusedRow=-1;this.arrNavItems=[this.id+"_minimize_restore",this.id+"_toogle_dock",this.id+"_close",this.strTableId];this.nShowDetailedSteps=2;var h=false;if(Prez.Session.PMode==PlayModes.PRAC||Prez.Session.PMode==PlayModes.TEST){this.nShowDetailedSteps=TemplateParams.ShowDetailedStepsInPractice;h=(TemplateParams.HighLevelStepText==1)}this.strContent="";this.strContent+='<p class="ap-slide-list-title">';switch(Prez.Session.PMode){case PlayModes.DEMO:this.strContent+=Lang.Demo;break;case PlayModes.TUT:this.strContent+=Lang.Tutorial;break;case PlayModes.PRAC:this.strContent+=Lang.Practice;break;case PlayModes.TEST:this.strContent+=Lang.Test;break;default:break}this.strContent+=": "+PrezInfo.Name+"</p>";if(h){this.strContent+='<p class="ap-slide-list-title">'+Lang.HighLevelSteps.format(SlideListUI.MS2STR(Prez.prjSlide.duration))+"</p>"}this.strContent+='<table id="'+this.strTableId+'" width="100%" cellspacing="0" cellpadding="2" role="treegrid" aria-readonly="true" tabindex="-1">';var n="";var m=0;var e=(TemplateParams.ShowDuration==1||TemplateParams.ShowDuration==3);var j=(TemplateParams.ShowDuration==2||TemplateParams.ShowDuration==3);for(var g=0,f=g_arrSlides.length;g<f;g++){var d=g_arrSlides[g];var a=d.name;if(a==""){a=Lang.Slide+" "+(g+1)}if(!this.bShowInGroup){this.strContent+='<tr id="'+this.strItemPrefix+g+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="1"><td style="vertical-align:top;padding-left:10px;">'+(g+1)+". "+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>";continue}if(d.group==""){n="";this.strContent+='<tr id="'+this.strItemPrefix+g+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="1"><td style="width:16px;vertical-align:top;"></td><td colspan="2" style="vertical-align:top">'+(g+1)+". "+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>";continue}if(d.group!=n){n=d.group;var b=0;for(var c=g;c<f;++c){if(g_arrSlides[c].group==n){b+=g_arrSlides[c].duration}else{break}}this.strContent+='<tr id="'+this.strGroupPrefix+m+'" class="'+this.strClassIncomplete+" "+this.strClassExpanded+'" role="row" tabindex="-1" aria-level="1" aria-expanded="true"><td id="'+this.strGroupPrefix+m+'_collapse_expand" class="collapsed-expanded-state"  style="width:1px;white-space:nowrap;vertical-align:top"><span class="ap-icon" title="'+Lang.Expanded+'" aria-label="'+Lang.Expanded+'"></span></td><td colspan="2" style="vertical-align:top">'+n+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="" aria-label=""></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(j?SlideListUI.MS2STR(b):"")+"</span></td></tr>";
this.arrGroups.push({slide_indices:[],collapsed:(this.nShowDetailedSteps!=2)});m++}if(this.nShowDetailedSteps!=0){var l=(g==g_arrSlides.length-1)||(g_arrSlides[g+1].group!=n);this.strContent+='<tr id="'+this.strItemPrefix+g+'" class="'+this.strClassIncomplete+'" role="row" tabindex="-1" aria-level="2"><td style="width:16px;vertical-align:top;"></td><td class="'+(l?"ap-slide-group-last-item":"ap-slide-group-item")+'" style="width:16px;vertical-align:top;"></td><td style="vertical-align:top;">'+(g+1)+". "+a+'</td><td style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-completion-state"><span class="ap-icon" title="'+Lang.NotVisited+'" aria-label="'+Lang.NotVisited+'"></span></td><td align="right" style="width:1px;white-space:nowrap;vertical-align:bottom" class="ap-time"><span>'+(e?SlideListUI.MS2STR(d.duration):"")+"</span></td></tr>"}this.arrGroups[m-1].slide_indices.push(g);this.mapSlideGroup[g]=m-1}this.strContent+="</table>"}$.extend(SlideListUI.prototype,DockableUI.prototype,{constructor:SlideListUI,_GetContent:function(){return this.strContent},_GetTitle:function(){return Lang.StepsPaneTitle},_SetGroupCollapsed:function(k,h){var j,f,c,b,d,a,g;j=this.arrGroups[k];f=h?"none":"";for(var e=0;e<j.slide_indices.length;++e){$("#"+this.strItemPrefix+j.slide_indices[e]).css("display",f)}j.collapsed=h;c=h?this.strClassExpanded:this.strClassCollapsed;b=h?this.strClassCollapsed:this.strClassExpanded;d=$("#"+this.strGroupPrefix+k);d.removeClass(c).addClass(b).attr("aria-expanded",""+!h);a=d.find(".collapsed-expanded-state").find(".ap-icon");g=h?Lang.Collapsed:Lang.Expanded;a.attr({title:g,"aria-label":g});if(this.bHighConstrastSupport){a.find("img").attr("alt",g)}this._UpdateCompletionStateARIA(d,true)},_UpdateCompletionStateARIA:function(d,c){var b=d.find(".ap-completion-state").find(".ap-icon");var a="";if(!c||(c&&d.hasClass(this.strClassCollapsed))){if(d.hasClass(this.strClassCompleted)){a=Lang.Completed}else{if(d.hasClass(this.strClassIncomplete)){a=Lang.Incomplete}else{if(d.hasClass(this.strClassCurrent)){a=Lang.Current}else{a=Lang.NotVisited}}}}b.attr({title:a,"aria-label":a});if(this.bHighConstrastSupport){b.find("img").attr("alt",a)}},_InitKeyNavSupport:function(){DockableUI.prototype._InitKeyNavSupport.call(this);var b=this;var d=$("#"+this.strTableId);var c=d.find("tr");var a=c.length;d.keydown(function(e){var l=e.which;if((l==38||l==40)&&!e.shiftKey&&!e.ctrlKey&&!e.altKey){if(b.nFocusedRow>=0&&b.nFocusedRow<a){var o=c.eq(b.nFocusedRow);o.attr("tabindex","-1");o.blur()}else{b.nFocusedRow=-1}var h=b.nFocusedRow;var f=false;while(h>=0&&h<a){h+=(l==38?-1:1);var j=c.eq(h);if(j.length==0){break}if(j.css("display")!="none"){f=true;break}}if(!f){h=b.nFocusedRow}if(h<0){h=0}b.nFocusedRow=h;var m=c.eq(b.nFocusedRow);m.attr("tabindex","0");m.focus();return false}if((l==37||l==39)&&e.ctrlKey&&!e.shiftKey&&!e.altKey){if(b.nShowDetailedSteps==0){return false}if(!e.target){return false}var g=e.target.id;if(g.indexOf(b.strGroupPrefix)!=0){return false}g=g.replace(b.strGroupPrefix,"");var n=parseInt(g);if(isNaN(n)||n<0||n>=b.arrGroups.length){return false}var k=b.arrGroups[n];if((l==37&&!k.collapsed)||(l==39&&k.collapsed)){return false}b._SetGroupCollapsed(n,!k.collapsed);return false}if(l==32||l==13){var o=$(e.target);if(o.prop("tagName").toLowerCase()=="tr"){o.trigger("click")}return false}}).focus(function(e){$(this).attr("tabindex","-1");if(b.nFocusedRow<0||b.nFocusedRow>=a){b.nFocusedRow=0}var f=c.eq(b.nFocusedRow);if(f.css("display")=="none"){b.nFocusedRow=0;f=c.eq(b.nFocusedRow)}f.attr("tabindex","0");f.focus();return false});c.focus(function(e){b.nFocusedRow=this.rowIndex;$(this).attr("tabindex","0")}).blur(function(e){$(this).attr("tabindex","-1")})},_Init:function(){DockableUI.prototype._Init.call(this);var c=this;$("#"+this.id).bind("focusin.nav",function(){UI.OnPaneFocused(c)});for(var b=0;b<g_arrSlides.length;b++){$("#"+this.strItemPrefix+b).attr("class",this.mapStates[b]?this.strClassCompleted:this.strClassIncomplete).css("cursor","pointer").click(function(){var f=$(this).attr("id");f=f.replace(c.strItemPrefix,"");var e=parseInt(f);if(isNaN(e)||e<0||e>=g_arrSlides.length){return false}if(UI.SlideNavigationEnabled()){Prez.ShowSlideByIndex(e,false)}return false})}for(var a=0;a<this.arrGroups.length;a++){$("#"+this.strGroupPrefix+a+"_collapse_expand").click(function(){if(c.nShowDetailedSteps==0){return false}var g=$(this).attr("id");g=g.replace(c.strGroupPrefix,"");g=g.replace("_collapse_expand","");var e=parseInt(g);if(isNaN(e)||e<0||e>=c.arrGroups.length){return false}var f=c.arrGroups[e];c._SetGroupCollapsed(e,!f.collapsed);return false});$("#"+this.strGroupPrefix+a).css("cursor","pointer").click(function(){var h=$(this).attr("id");h=h.replace(c.strGroupPrefix,"");var f=parseInt(h);if(isNaN(f)||f<0||f>=c.arrGroups.length){return false}var g=c.arrGroups[f];if(UI.SlideNavigationEnabled()){var e=g.slide_indices[0];if(e!==undefined){Prez.ShowSlideByIndex(e,false)}}return false})}this.SetCurrentSlide(this.nCurIndex);if(this.bShowInGroup){if(this.nShowDetailedSteps==0){for(var b=0,d=this.arrGroups.length;b<d;++b){this._SetGroupCollapsed(b,true)}}else{for(var b=0,d=this.arrGroups.length;b<d;++b){this._SetGroupCollapsed(b,this.arrGroups[b].collapsed)}}}},MarkComplete:function(b,g){var e=b?this.strClassCompleted:this.strClassIncomplete;if(g!==undefined){this.mapStates[g]=b;var c=$("#"+this.strItemPrefix+g);c.attr("class",e);this._UpdateCompletionStateARIA(c,false);var k=this.mapSlideGroup[g];if(k!==undefined&&k>=0&&k<this.arrGroups.length){var h=this.arrGroups[k];var j=true;for(var f=0;f<h.slide_indices.length;++f){if(!this.mapStates[h.slide_indices[f]]){j=false;break}}var d=(j?this.strClassCompleted:this.strClassIncomplete)+" "+(h.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+k);a.attr("class",d);this._UpdateCompletionStateARIA(a,true)}}else{for(var f=0;f<g_arrSlides.length;f++){this.MarkComplete(b[f]===undefined?false:b[f],f)}}},SetCurrentSlide:function(f){if(typeof(f)!=="number"){f=-1}if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var d=this.mapStates[this.nCurIndex]?this.strClassCompleted:this.strClassIncomplete;var b=$("#"+this.strItemPrefix+this.nCurIndex);b.attr("class",d);this._UpdateCompletionStateARIA(b,false);var j=this.mapSlideGroup[this.nCurIndex];if(j!==undefined&&j>=0&&j<this.arrGroups.length){var g=this.arrGroups[j];var h=true;for(var e=0;e<g.slide_indices.length;++e){if(!this.mapStates[g.slide_indices[e]]){h=false;break}}var c=(h?this.strClassCompleted:this.strClassIncomplete)+" "+(g.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+j);a.attr("class",c);this._UpdateCompletionStateARIA(a,true)}}this.nCurIndex=f;if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var b=$("#"+this.strItemPrefix+f);b.attr("class",this.strClassCurrent);this._UpdateCompletionStateARIA(b,false);var j=this.mapSlideGroup[this.nCurIndex];if(j!==undefined&&j>=0&&j<this.arrGroups.length){var g=this.arrGroups[j];var c=this.strClassCurrent+" "+(g.collapsed?this.strClassCollapsed:this.strClassExpanded);var a=$("#"+this.strGroupPrefix+j);a.attr("class",c);this._UpdateCompletionStateARIA(a,true)}}}});function SlideNotesUI(){DockableUI.call(this);if(TemplateParams.SlideNotesPos==UIPos.FLOATING){this.bFloat=true}else{this.bFloat=false;this.eDockPos=TemplateParams.SlideNotesPos}this.id="SlideNotes";this.strCurGroup="";this.mapStates={};this.nCurIndex=-1;this.nGroupStart=-1;this.nGroupEnd=-1;this.strClassIncomplete="ap-slide-notes-item-incomplete";this.strClassCurrent="ap-slide-notes-item-current";this.strClassCompleted="ap-slide-notes-item-completed";this.strItemPrefix="slide_notes_item_";this.arrNavItems=[this.id+"_minimize_restore",this.id+"_toogle_dock",this.id+"_close"]}$.extend(SlideNotesUI.prototype,DockableUI.prototype,{constructor:SlideNotesUI,_GetContent:function(){return""},_GetTitle:function(){return Lang.SlideNotes},_Init:function(){DockableUI.prototype._Init.call(this);
var b=this;$("#"+this.id).bind("focusin.nav",function(){UI.OnPaneFocused(b)});var a=this.nCurIndex;this.SetCurrentSlide(-1);this.SetCurrentSlide(a)},MarkComplete:function(a,b){var d=a?this.strClassCompleted:this.strClassIncomplete;if(b!==undefined){$("#"+this.strItemPrefix+b).attr("class",d);this.mapStates[b]=a}else{for(var c=0;c<g_arrSlides.length;c++){this.MarkComplete(a[c]===undefined?false:a[c],c)}}},GetSlideNoteHTML:function(b,a){var c=a.description;if(c==""){c=a.name}var d='<tr id="'+this.strItemPrefix+b+'" class="'+this.strClassIncomplete+'"><td style="width:1px;white-space:nowrap;vertical-align:top"><span class="ap-icon"></span></td><td style="vertical-align:top">'+c+"</td></tr>";return d},SetCurrentSlide:function(c){if(typeof(c)!=="number"){c=-1}if(this.nCurIndex>=0&&this.nCurIndex<g_arrSlides.length){var f=this.mapStates[this.nCurIndex]?this.strClassCompleted:this.strClassIncomplete;$("#"+this.strItemPrefix+this.nCurIndex).attr("class",f)}this.nCurIndex=c;if(c<0||c>=g_arrSlides.length){this.nGroupStart=this.nGroupEnd=-1;this.strCurGroup="";return}var a=g_arrSlides[c];if(!a){this.nGroupStart=this.nGroupEnd=-1;this.strCurGroup="";return}if(a.group==""||a.group!=this.strCurGroup){this.strCurGroup=a.group;var e="";this.nGroupStart=c;this.nGroupEnd=c;for(var d=c-1;d>=0;d--){var b=g_arrSlides[d];if(b&&b.group!=""&&b.group==this.strCurGroup){e=this.GetSlideNoteHTML(d,b)+e;this.nGroupStart=d}else{break}}for(var d=c;d<g_arrSlides.length;d++){var b=g_arrSlides[d];if(b&&b.group!=""&&b.group==this.strCurGroup){e=e+this.GetSlideNoteHTML(d,b);this.nGroupEnd=d}else{break}}e='<table width="100%">'+e+"</table>";$("#"+this.id+"_content_inner").html(e);for(var d=this.nGroupStart;d<=this.nGroupEnd;d++){$("#"+this.strItemPrefix+d).attr("class",this.mapStates[d]?this.strClassCompleted:this.strClassIncomplete)}}$("#"+this.strItemPrefix+this.nCurIndex).attr("class",this.strClassCurrent)}});ReportUI={OnSendReport:function(){Prez.SendReport()},OnFinish:function(){ReportUI.Close();Prez.Close(false)},OnRestart:function(){ReportUI.Close();Prez.Restart()},OnShow:function(){$(document).unbind("reveal.facebox");$.facebox.footer(ReportUI.GetBtns());if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){$("#SendReportButton").click(function(){ReportUI.OnSendReport()})}$("#ReportRestartButton").click(function(){ReportUI.OnRestart()});$("#ReportFinishButton").click(function(){ReportUI.OnFinish()})},Close:function(){$(document).trigger("close.facebox");Prez.Resume()},GetSummaryInfo:function(){var c=Prez.GetPoints();var a=Prez.GetMaxPoints();var e=new Date();var b="<div class='reporthinfo'>";b+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'>";b+="<tbody>";b+="<tr><td width='30%'>"+Lang.Presentation+"</td><td>"+PrezInfo.Name.quoteHTML()+"</td></tr>";b+="<tr><td>"+Lang.Description+"</td><td>"+PrezInfo.Description.quoteHTML()+"</td></tr>";b+="<tr><td>"+Lang.Date1+"</td><td>"+e.toUTCString()+"</td></tr>";b+="<tr><td>"+Lang.TotalTime+"</td><td>"+SlideListUI.MS2STR(Prez.Session.Elapsed)+"</td></tr>";b+="<tr><td>"+Lang.TakenSlides+"</td><td>"+Prez.GetTakenSlideCount()+" / "+Prez.GetSlideCount()+"</td></tr>";b+="<tr><td>"+Lang.TakenInteractions+"</td><td>"+Prez.GetTakenInteractionCount()+" / "+Prez.GetInteractionCount()+"</td></tr>";b+="<tr><td>"+Lang.CorrectCount+"</td><td>"+Prez.GetTakenInteractionCount(Judge.CORRECT)+"</td></tr>";b+="<tr><td>"+Lang.Points+"</td><td>"+c+"/"+a+"</td></tr>";b+="<tr><td>"+Lang.Percentage+"</td><td>"+parseInt(c*100/a)+" %</td></tr>";b+="<tr><td>"+Lang.Result+"</td><td>"+(Prez.GetResult()?Lang.Passed:Lang.Failed)+" - "+Prez.GetRequirements()+"</td></tr>";b+="</tbody></table>";b+="</div><hr>";return b},GetDetailInfo:function(){var d="<div class='reportrinfo'>";d+="<table width='100%' border='1px' bordercolor='#808080' bordercolordark='#808080' bordercolorlight='#C0C0C0' cellspacing='0px' rules='all' frame='box' cellpadding='0px'><thead><tr>";d+="<th width='10%' align='center'>#</th>";d+="<th width='15%' align='center'>"+Lang.SlideIndex+"</th>";d+="<th width='15%' align='center'>ID</th>";d+="<th width='15%' align='center'>"+Lang.Attempts+"</th>";d+="<th width='15%' align='center'>"+Lang.Points+"</th>";d+="<th width='15%' align='center'>"+Lang.MaxPoints+"</th>";d+="<th width='15%' align='center'>"+Lang.Result+"</th>";d+="</tr></thead><tbody>";var b=this.GetReportResult();var c=b.length;for(var e=0;e<c;++e){var a=b[e];d+="<tr>";d+="<td align='center'>"+(e+1)+"</td>";d+="<td align='center'>"+(parseInt(a.slideidx)+1)+"</td>";d+="<td align='center'>"+a.reportid+"</td>";d+="<td align='center'>"+a.attempts+"</td>";d+="<td align='center'>"+a.points+"</td>";d+="<td align='center'>"+a.maxPoints+"</td>";d+="<td align='center'>"+a.judge+"</td>";d+="</tr>"}d+="</tbody></table>";d+="</div>";return d},GetBtns:function(){var a="<div>";a+="<div align='center'>";if(Options.report_method!==undefined&&Options.report_method!=ReportMethod.NONE){a+="<input style='cursor:pointer;' type='button' id='SendReportButton' value='"+Lang.SendReport+"'>"}if(Prez.Session.PMode&(PlayModes.DEMO|PlayModes.PRAC|PlayModes.TUT)){a+="<input style='cursor:pointer;' type='button' id='ReportRestartButton' value='"+Lang.Restart+"'>"}a+="<input style='cursor:pointer;' type='button' id='ReportFinishButton' value='"+Lang.Finish+"'>";a+="</div></div>";return a},GetHTML:function(){var c={w:$(window).innerWidth(),h:$(window).innerHeight()};var b={w:Math.min(600,c.w-80),h:Math.min(450,9*c.h/10-100)};if(b.w<50){b.w=50}if(b.h<50){b.h=50}var a="<div class='reportcontent' style='width:"+b.w+"px; height:"+b.h+"px'>";a+=this.GetSummaryInfo()+this.GetDetailInfo();a+="</div>";return a},Show:function(){var a=this;$(document).bind("reveal.facebox",a.OnShow);$.facebox(this.GetHTML())},GetReportResult:function(){var g=[];var h=Prez.Session.RestoreData.slides;var k=h.length;for(var j=0;j<k;++j){var m=h[j];if(!m){continue}for(var f in m){var l=m[f];if(!l){continue}var n={slideidx:"",reportid:"",attempts:0,judge:"",answers:"",points:0,maxPoints:0,type:"Unknown"};var e=Prez.GetSlideAt(j);var c=e.ctrls;var b=c.length;for(var d=0;d<b;++d){var a=c[d];if(a.id!=f){continue}n.slideidx=j;n.reportid=a.reportid;n.attempts=l.a||0;n.judge=this.GetJudgeString(l.j);n.points=l.p||0;n.maxPoints=Prez.GetCtrlMaxPoints(a);switch(a.kind){case CtrlKind.INPUT:if(a.type==InputUI.MOUSE){n.type=Lang.MouseClick}else{if(a.type==InputUI.KEY){n.type=Lang.KeyStroke}}break;case CtrlKind.TEXTINPUT:n.answers=l.v;n.type=Lang.TextBox;break;case CtrlKind.QUIZ:n.answers=this.GetQuizAnswers(a,l);switch(a.type){case QuizUI.Type.MULTI_RESPONSE:n.type=Lang.MultipleResponse;break;case QuizUI.Type.TRUE_FALSE:n.type=Lang.TrueFalse;break;case QuizUI.Type.MULTI_CHOICE:n.type=Lang.MultipleChoice;break;case QuizUI.Type.SEQUENCE_DRAGDROP:n.type=Lang.Sequence;break;case QuizUI.Type.SINGLELINE_TEXT:n.type=Lang.FillBlank;break;case QuizUI.Type.MULTILINE_TEXT:n.type=Lang.Essay;break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:n.type=Lang.FillMultipleBlank;break;default:break}break;case CtrlKind.BUTTON:n.type=Lang.Button;break;default:break}break}g.push(n)}}return g},GetQuizAnswers:function(c,f){var e=c.ctrls;var b=e.length;var d="";var g;switch(c.type){case QuizUI.Type.MULTI_RESPONSE:case QuizUI.Type.MULTI_CHOICE:case QuizUI.Type.TRUE_FALSE:for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.ANSWER){continue}if(f.v[e[g].act.id]==true){if(d!=""){d+=", "}d+=e[g].reportid}}break;case QuizUI.Type.SEQUENCE_DRAGDROP:var a={};var j;var h=0;for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.NOTE&&e[g].type!=NoteType.ANSWER){continue}j=f.v[e[g].id];if(j===undefined){continue}a[j]=e[g].reportid;h++}for(g=0;g<h;++g){if(!a[g]){continue}if(d!=""){d+=", "}d+=a[g]}break;case QuizUI.Type.SINGLELINE_TEXT:case QuizUI.Type.MULTILINE_TEXT:for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.TEXTINPUT){continue}d=f.v[e[g].id];break}break;case QuizUI.Type.MULTI_SINGLELINE_TEXT:for(g=0;g<b;++g){if(e[g].kind!=CtrlKind.ANSWER){continue
}if(d!=""){d+=", "}d+=e[g].reportid+"."+f.v[e[g].act.id]}break;default:break}return d},GetJudgeString:function(a){if(!a){return"Unknown"}else{if(a==Judge.CORRECT){return Lang.Correct}else{if(a==Judge.WRONG){return Lang.Incorrect}else{if(a==Judge.PARTIAL_CORRECT){return Lang.PartialCorrect}else{if(a==Judge.INCOMPLETE){return Lang.Incomplete}else{if(a==Judge.NEUTRAL){return""}}}}}}return"Unknown"}};
/*!
 * Atomi Ajax Player - Toolbar UI Implementations
 * Copyright (c) Atomi Systems, Inc. All rights reserved.
 * http://atomisystems.com
 * Modified: 2014/05/10
 */
var bKeyNavEnabled=Options.AllowNavigate;function APSlider(b){this._dragging=false;this.minVal=0;this.maxVal=100;this.val=0;this._width=1;this.handleHW=4;this.tooltip="";this.tooltipEnabled=true;this.id=b.attr("id");this.handleId=this.id+"_handle";this.tooltipId=this.id+"_tooltip";this.handleContainmentId=this.id+"_handle_containment";var a=this;var c='<img src="player/images/tb_slider_handle.png" id="'+this.handleId+'" style="position:absolute;top:0px;left:0px;cursor:pointer;" alt="" />';b.append('<div id="'+this.handleContainmentId+'"></div>').append(c);b.attr({"aria-valuemin":this.minVal,"aria-valuemax":this.maxVal,"aria-valuenow":this.val});var d='<div 	id="'+this.tooltipId+'" style="display:none;position:absolute;top:-30px;left:150px;width:40px;height:29px;"></div>';b.append(d);$("#"+this.tooltipId).css({"background-image":"url('player/images/tb_hover.gif')","background-repeat":"no-repeat","font-family":"Serif","font-size":"14px",color:"#656565","text-align":"center","padding-top":"2px"});$("#"+this.handleId).mouseenter(function(){if(a.tooltipEnabled){$("#"+a.tooltipId).show()}}).mouseleave(function(){$("#"+a.tooltipId).hide()}).draggable({containment:$("#"+a.handleContainmentId),axis:"x",start:function(){a._dragging=true},drag:function(){var e=parseInt($(this).css("left"))+a.handleHW;a._Seek(e)},stop:function(){a._dragging=false;var e=parseInt($(this).css("left"))+a.handleHW;a._Seek(e,true)}}).mousedown(function(e){b.focus();e.stopPropagation();return true});b.mousedown(function(e){a._Seek(e.pageX-$(this).offset().left,true);e.stopPropagation();return true}).keydown(function(e){if(!bKeyNavEnabled){return true}var k=a._ValToPos(a.val);var h=37;var f=39;var j=36;var g=35;if(e.which==h){k+=-5}else{if(e.which==f){k+=5}else{if(e.which==j){k=0}else{if(e.which==g){k=a._width}else{return true}}}}a._Seek(k,true);return false});$("#"+a.handleContainmentId).css("position","absolute").css("left",-this.handleHW).css("top",0).width(b.width()+2*this.handleHW).height(b.height())}APSlider.prototype={constructor:APSlider,SetTooltip:function(a){if(a!=this.tooltip){this.tooltip=a;$("#"+this.tooltipId).text(a)}},ShowTooltip:function(a){if(a===undefined){a=true}if(a){$("#"+this.tooltipId).show()}else{$("#"+this.tooltipId).hide()}},GetVal:function(){return this.val},SetVal:function(a){if(this._dragging){return false}if(a<this.minVal){a=this.minVal}else{if(a>this.maxVal){a=this.maxVal}}this.val=a;$("#"+this.id).attr("aria-valuenow",this.val);var b=this._ValToPos(a)||0;this._UpdateHandle(b);return true},GetMinVal:function(){return this.minVal},SetMinVal:function(a){this.minVal=a;$("#"+this.id).attr("aria-valuemin",this.minVal)},GetMaxVal:function(){return this.maxVal},SetMaxVal:function(a){this.maxVal=a;$("#"+this.id).attr("aria-valuemax",this.maxVal)},GetWidth:function(){return this._width},SetWidth:function(a){this._width=a;$("#"+this.id).width(a);$("#"+this.handleContainmentId).width(a+2*this.handleHW);var b=this._ValToPos(this.val)||0;this._UpdateHandle(b)},SetListener:function(b,a,c){this[b]={listener:a,methodName:c}},EnableTooltip:function(a){this.tooltipEnabled=a},_UpdateHandle:function(a){$("#"+this.handleId).css("left",(a-this.handleHW)+"px");$("#"+this.tooltipId).css("left",(a-$("#"+this.tooltipId).width()/2)+"px")},_Seek:function(d,b){if(d<0){d=0}else{if(d>this._width){d=this._width}}var a=this._PosToVal(d),c=false;if(!isNaN(a)){if(a!=this.val){if(!this.onChanging||this.onChanging.listener[this.onChanging.methodName](this,this.val,a,b)!==false){this.val=a;$("#"+this.id).attr("aria-valuenow",this.val);c=true}}}if(!this._dragging&&!c){d=this._ValToPos(this.val)||0}this._UpdateHandle(d)},_PosToVal:function(b){var a=Math.round(this.minVal+b*(this.maxVal-this.minVal)/this._width);if(a<this.minVal){a=this.minVal}else{if(a>this.maxVal){a=this.maxVal}}return a},_ValToPos:function(b){var a=Math.round((b-this.minVal)*this._width/(this.maxVal-this.minVal));if(a<0){a=0}else{if(a>this._width){a=this._width}}return a}};function APToolbar(q){var o=365;var p=23;var j=o;var g=0;var e=0;var l=false;var c=true;var f=true;var b=true;var n=false;var m=false;var a="APToolbar";var h=true;var d=["btfirst","btprev","btplay","btnext","btlast","slider_rail","volume_slider","btsound","btclosedcaption","btautofit","btinfo","btslidelist"];var k=-1;this.options={sliderMin:0,sliderMax:100,sliderVal:0};$.extend(this.options,q);this.GetPadding=function(){return{t:0,l:0,r:0,b:p}};this.GetMinPlayerSize=function(){return{w:o,h:p}};this.GetHTML=function(){var r="<div id="+a+" style='position:absolute;top:0px;left:0px;' role='toolbar' tabindex='-1'><div id='tbleft' style='position:absolute;top:0px;left:0px;width:133px;height:23px;z-index:1;'><img src='player/images/tb_left.png' class='ap-toolbar-bg' alt=''/><div id='btfirst' class='ap-toolbar-btn' style='left:24px;' role='button' tabindex='-1'></div><div id='btprev' class='ap-toolbar-btn' style='left:43px;' role='button' tabindex='-1'></div><div id='btplay' class='ap-toolbar-btn' style='left:62px;' role='button' aria-pressed='false' tabindex='-1'></div><div id='btnext' class='ap-toolbar-btn' style='left:81px;' role='button' tabindex='-1'></div><div id='btlast' class='ap-toolbar-btn' style='left:100px;' role='button' tabindex='-1'></div></div><div id='slider_rail' style='position:absolute;top:0px;left:133px;width:32px;height:23px;z-index:2;' role='slider' tabindex='-1'><img src='player/images/tb_slider_rail.png' class='ap-toolbar-bg' alt=''/></div><div id='tbright' style='position:absolute;top:0px;left:165px;width:200px;height:23px;z-index:1;'><img src='player/images/tb_right.png' class='ap-toolbar-bg' alt=''/><div id='volume_slider' style='position:absolute;top:0px;left:22px;width:53px;height:23px;' role='slider' tabindex='-1'><img src='player/images/blank.gif' class='ap-toolbar-bg' alt=''/></div><div id='btsound' class='ap-toolbar-btn' style='left:82px;' role='button' tabindex='-1'></div><div id='btclosedcaption' class='ap-toolbar-btn' style='left:101px;' role='button' aria-pressed='false' tabindex='-1'></div><div id='btautofit' class='ap-toolbar-btn' style='left:120px;' role='button' aria-pressed='false' tabindex='-1'></div><div id='btinfo' class='ap-toolbar-btn' style='left:139px;' role='button' tabindex='-1'></div><div id='btslidelist' class='ap-toolbar-btn' style='left:158px;' role='button' tabindex='-1'></div></div></div>";return r};this._InitButtonIcon=function(s,r,t){if(h){s.css("background","none");s.append("<img src='player/images/tb_btns.png' style='position:absolute;' alt='"+s.attr("title")+"'/>")}this._SetButtonIconPos(s,r,t)};this._SetButtonIconPos=function(s,r,t){if(h){s.find("img").css("left",r).css("top",t)}else{s.css("background-position",r+"px "+t+"px")}};this._SetButtonTitle=function(r,s){r.attr("title",s);if(h){r.find("img").attr("alt",s)}};this._SetToolbarWidth=function(r){if(r<o){r=o}j=r;this._LayoutInternal()};this._SetToolbarPosition=function(r,s){g=r;e=s;this._LayoutInternal()};this.SetListener=function(s,r,t){switch(s){case"onSeeking":this.slider.SetListener("onChanging",r,t);break;case"onVolumeChanging":this.volume_slider.SetListener("onChanging",r,t);break}};this.GetSliderPosition=function(){return this.slider.GetVal()};this.SetSliderPosition=function(r){return this.slider.SetVal(r)};this.SetSliderTip=function(r){this.slider.SetTooltip(r)};this.GetVolumeValue=function(){return this.volume_slider.GetVal()};this.SetVolumeValue=function(r){return this.volume_slider.SetVal(r)
};this.SetPause=function(s){c=s;var r=$("#btplay");r.attr("aria-pressed",s);this._SetButtonIconPos(r,s?-152:-133,0);this._SetButtonTitle(r,s?Lang.PlayPrez:Lang.PausePrez)};this.SetMute=function(s){n=s;var r=$("#btsound");r.attr("aria-pressed",s);this._SetButtonIconPos(r,s?-228:-209,0);this._SetButtonTitle(r,s?Lang.Unmute:Lang.Mute)};this.SetCCaption=function(s){b=s;var r=$("#btclosedcaption");r.attr("aria-pressed",s);this._SetButtonIconPos(r,s?0:-19,0);this._SetButtonTitle(r,s?Lang.HideCC:Lang.ShowCC)};this.SetAutoFit=function(s){f=s;var r=$("#btautofit");r.attr("aria-pressed",s);this._SetButtonIconPos(r,s?-190:-38,0);this._SetButtonTitle(r,s?Lang.ActualSize:Lang.AutoFit)};this.SetSlideListShown=function(s){m=s;var r=$("#btslidelist");r.attr("aria-pressed",s);this._SetButtonIconPos(r,s?-266:-285,0);this._SetButtonTitle(r,s?Lang.HideSlideList:Lang.ShowSlideList)};this.UpdateState=function(){if(!l){return}this.SetPause(!Prez.IsRunning());if(Prez.prjSldUI){this.SetSliderPosition(Prez.prjSldUI.ts)}this.SetSliderTip(Prez.Session.SlideIndex+1);this.SetVolumeValue(Prez.GetVolume(false));this.SetMute(Prez.IsMuted());this.SetCCaption(ClosedCaptionUI.IsShown());this.SetAutoFit(UI.IsAutoFit());this.SetSlideListShown((UI.SlideList!=null)&&(UI.SlideList.IsShown()==true))};this.Show=function(){$("#"+a).remove();UI.ViewPort().append(this.GetHTML());this.slider=new APSlider($("#slider_rail"));this.slider.SetMinVal(this.options.sliderMin);this.slider.SetMaxVal(this.options.sliderMax);this.slider.SetVal(this.options.sliderVal);this.volume_slider=new APSlider($("#volume_slider"));this.volume_slider.SetMinVal(0);this.volume_slider.SetMaxVal(100);this.volume_slider.SetVal(0);this.volume_slider.EnableTooltip(false);$("#btfirst").attr("title",Lang.FirstSlide);$("#btlast").attr("title",Lang.LastSlide);$("#btnext").attr("title",Lang.NextSlide);$("#btprev").attr("title",Lang.PreviousSlide);$("#btplay").attr("title",Lang.PlayPrez);$("#slider_rail").attr("title",Lang.PrezProgress);$("#volume_slider").attr("title",Lang.AdjustVolume);$("#btsound").attr("title",Lang.Mute);$("#btclosedcaption").attr("title",Lang.HideCC);$("#btautofit").attr("title",Lang.AutoFit);$("#btinfo").attr("title",Lang.About);$("#btslidelist").attr("title",Lang.SlideList);$("#"+a).show().attr("unselectable","on").css("user-select","none").on("selectstart",false);var r=this._InitButtonIcon;r.call(this,$("#btfirst"),-57,0);r.call(this,$("#btprev"),-171,0);r.call(this,$("#btplay"),c?-152:-133,0);r.call(this,$("#btnext"),-114,0);r.call(this,$("#btlast"),-95,0);r.call(this,$("#btsound"),n?-228:-209,0);r.call(this,$("#btclosedcaption"),b?0:-19,0);r.call(this,$("#btautofit"),f?-190:-38,0);r.call(this,$("#btinfo"),-76,0);r.call(this,$("#btslidelist"),m?-266:-285,0);this._InitHandlers();l=true;this._LayoutInternal()};this.Hide=function(){$("#"+a).hide();l=false};this.Layout=function(){var r=UI.ViewPort();$("#"+a).css("z-index",ZIndexBase.Dialog);this._SetToolbarPosition(0,r.height()-p);this._SetToolbarWidth(r.width());this.UpdateState()};this._LayoutInternal=function(){if(!l){return}$("#"+a).css("left",g).css("top",e);var r=j-o;this.slider.SetWidth(32+r);this.volume_slider.SetWidth(53);$("#tbright").css("left",165+r)};this._InitKeyNavSupport=function(){$("#"+a).mousedown(function(s){s.stopPropagation();return true}).keydown(function(t){if(t.which==Key.TAB){if(k>=0&&k<d.length){var s=$("#"+d[k]);s.attr("tabindex","-1");s.blur()}if((t.shiftKey&&k==0)||(!t.shiftKey&&k>=d.length-1)){k=-1;return true}k=k<0?0:k+(t.shiftKey?-1:1);var s=$("#"+d[k]);s.attr("tabindex","0");s.focus()}else{if(t.which==32||t.which==13){var u=$(t.target);if(u.hasClass("ap-toolbar-btn")){u.trigger("click")}else{return true}}else{return true}}return false});$("#"+a+", #tbleft, #tbright").focus(function(t){$(this).attr("tabindex","-1");if(k<0||k>=d.length){k=0}var s=$("#"+d[k]);s.attr("tabindex","0");s.focus()});for(var r=0;r<d.length;++r){$("#"+d[r]).focus(function(s){k=$.inArray($(this).attr("id"),d);$(this).attr("tabindex","0")}).blur(function(s){$(this).attr("tabindex","-1")})}};this._InitHandlers=function(){var r=this;$("#"+a).bind("focusin.nav",function(){UI.OnPaneFocused(r)});if(bKeyNavEnabled){this._InitKeyNavSupport()}var s=this._SetButtonIconPos;$("#btfirst").mouseleave(function(){s.call(r,$(this),-57,0)}).mouseenter(function(){s.call(r,$(this),-57,-36)}).mouseup(function(){s.call(r,$(this),-57,-36)}).mousedown(function(){s.call(r,$(this),-57,-18)}).click(function(){if(UI.SlideNavigationEnabled()){Prez.GoFirst()}});$("#btprev").mouseleave(function(){s.call(r,$(this),-171,0)}).mouseenter(function(){s.call(r,$(this),-171,-36)}).mouseup(function(){s.call(r,$(this),-171,-36)}).mousedown(function(){s.call(r,$(this),-171,-18)}).click(function(){if(UI.SlideNavigationEnabled()){Prez.GoPrev()}});$("#btplay").mouseleave(function(){s.call(r,$(this),c?-152:-133,0)}).mouseenter(function(){s.call(r,$(this),c?-152:-133,-36)}).mouseup(function(){s.call(r,$(this),c?-152:-133,-36)}).mousedown(function(){s.call(r,$(this),c?-152:-133,-18)}).click(function(){if(UI.SlideNavigationEnabled()){Prez.TogglePause()}});$("#btnext").mouseleave(function(){s.call(r,$(this),-114,0)}).mouseenter(function(){s.call(r,$(this),-114,-36)}).mouseup(function(){s.call(r,$(this),-114,-36)}).mousedown(function(){s.call(r,$(this),-114,-18)}).click(function(){if(UI.SlideNavigationEnabled()){Prez.GoNext()}});$("#btlast").mouseleave(function(){s.call(r,$(this),-95,0)}).mouseenter(function(){s.call(r,$(this),-95,-36)}).mouseup(function(){s.call(r,$(this),-95,-36)}).mousedown(function(){s.call(r,$(this),-95,-18)}).click(function(){if(UI.SlideNavigationEnabled()){Prez.GoLast()}});$("#btsound").mouseleave(function(){s.call(r,$(this),n?-228:-209,0)}).mouseenter(function(){s.call(r,$(this),n?-228:-209,-36)}).mouseup(function(){s.call(r,$(this),n?-228:-209,-36)}).mousedown(function(){s.call(r,$(this),n?-228:-209,-18)}).click(function(){Prez.Mute(!n)});$("#btclosedcaption").mouseleave(function(){s.call(r,$(this),b?0:-19,0)}).mouseenter(function(){s.call(r,$(this),b?0:-19,-36)}).mouseup(function(){s.call(r,$(this),b?0:-19,-36)}).mousedown(function(){s.call(r,$(this),b?0:-19,-18)}).click(function(){Prez.ToggleClosedCaption()});$("#btautofit").mouseleave(function(){s.call(r,$(this),f?-190:-38,0)}).mouseenter(function(){s.call(r,$(this),f?-190:-38,-36)}).mouseup(function(){s.call(r,$(this),f?-190:-38,-36)}).mousedown(function(){s.call(r,$(this),f?-190:-38,-18)}).click(function(){UI.ToggleAutoFit()});$("#btinfo").mouseleave(function(){s.call(r,$(this),-76,0)}).mouseenter(function(){s.call(r,$(this),-76,-36)}).mouseup(function(){s.call(r,$(this),-76,-36)}).mousedown(function(){s.call(r,$(this),-76,-18)}).click(function(){UI.ShowAbout()});$("#btslidelist").mouseleave(function(){s.call(r,$(this),m?-266:-285,0)}).mouseenter(function(){s.call(r,$(this),m?-266:-285,-36)}).mouseup(function(){s.call(r,$(this),m?-266:-285,-36)}).mousedown(function(){s.call(r,$(this),m?-266:-285,-18)}).click(function(){if(!UI.HasSlideList()){return}if(UI.SlideList){UI.SlideList.ToggleShow()}else{UI.ShowSlideList()}})};this.Focus=function(){var s=d[k];if(!s){k=0;s=d[0]}var r=$("#"+s);r.attr("tabindex","0");r.focus();return true}}APToolbar.GetImages=function(a){a.push("player/images/tb_btns.png");a.push("player/images/tb_slider_handle.png");a.push("player/images/tb_hover.gif","player/images/tb_slider_rail.png");a.push("player/images/tb_left.png","player/images/tb_right.png")};